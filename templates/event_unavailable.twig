{% extends 'layout.twig' %}

{% block title %}{{ event.name }} â€“ {{ t('event_unavailable_heading') }}{% endblock %}

{% block body_theme %}{% set cfg = config is defined ? config : {} %}{% set theme = attribute(cfg, 'startTheme')|default('light')|lower %}{{ theme == 'dark' ? 'dark' : 'light' }}{% endblock %}

{% block head %}
  <meta name="csrf-token" content="{{ csrf_token }}">
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  {% set cfg = config is defined ? config : {} %}
  {% set theme = attribute(cfg, 'startTheme')|default('light')|lower %}
  {% set prefersDark = theme == 'dark' %}
  {% set darkMedia = prefersDark ? 'all' : '(prefers-color-scheme: dark)' %}
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css" media="{{ darkMedia }}"{% if not prefersDark %} disabled{% endif %}>
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/calhelp.css">
{% endblock %}

{% block body_class %}event-unavailable-page uk-padding@m uk-padding-remove-top{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}{% endembed %}
  <div class="uk-container uk-container-large uk-text-center uk-margin-medium-top">
    <h1 class="uk-heading-medium uk-text-light">{{ event.name }}</h1>
    <p class="uk-text-lead">{{ t('event_unavailable_heading') }}</p>
    <p class="uk-text-large">
      {% if status == 'upcoming' %}
        {{ t('event_unavailable_intro_upcoming') }}
        {% if startFormatted %}<strong>{{ startFormatted }}</strong>{% endif %}
      {% elseif status == 'finished' %}
        {{ t('event_unavailable_intro_finished') }}
        {% if endFormatted %}<strong>{{ endFormatted }}</strong>{% endif %}
      {% else %}
        {{ t('event_unavailable_intro_generic') }}
      {% endif %}
    </p>
  </div>

  <div class="uk-container uk-width-1-1 uk-width-2-3@m uk-margin-large-top">
    <div class="uk-card uk-card-default uk-card-body uk-box-shadow-large">
      <div class="uk-text-center uk-margin">
        <img
          src="{% if config.logoPath %}{{ basePath ~ config.logoPath }}{% else %}{{ basePath }}/logo-160.svg{% endif %}"
          {% if not config.logoPath %}
          srcset="{{ basePath }}/logo-160.svg 160w, {{ basePath }}/logo-320.svg 320w"
          sizes="(max-width: 600px) 160px, 320px"
          {% endif %}
          alt="{{ t('event_unavailable_logo_alt') }}"
          width="160"
          height="240"
          loading="lazy">
      </div>
      <dl class="uk-description-list uk-description-list-divider">
        {% if startFormatted %}
          <div>
            <dt class="uk-text-bold">{{ t('event_unavailable_start_label') }}</dt>
            <dd>{{ startFormatted }}</dd>
          </div>
        {% endif %}
        {% if endFormatted %}
          <div>
            <dt class="uk-text-bold">{{ t('event_unavailable_end_label') }}</dt>
            <dd>{{ endFormatted }}</dd>
          </div>
        {% endif %}
      </dl>
      {% if event.description %}
        <p class="uk-text-lead uk-margin-top">{{ event.description }}</p>
      {% endif %}
      {% if config.inviteText %}
        <article class="uk-article uk-margin-top">{{ config.inviteText|uikitify|raw }}</article>
      {% endif %}
    </div>
  </div>

  <div class="uk-container uk-width-1-1 uk-width-2-3@m uk-margin-large-top uk-margin-large-bottom">
    <div class="uk-card uk-card-default uk-card-body uk-box-shadow-medium">
      <h2 class="uk-heading-bullet">{{ t('event_preview_heading') }}</h2>
      <p class="uk-text-meta uk-margin-small-bottom">{{ t('event_preview_description') }}</p>
      {% if previewError == 'invalid' %}
        <div class="uk-alert uk-alert-danger" uk-alert>{{ t('event_preview_error_invalid') }}</div>
      {% elseif previewError == 'missing' %}
        <div class="uk-alert uk-alert-warning" uk-alert>{{ t('event_preview_error_missing') }}</div>
      {% endif %}
      {% if previewPasswordEnabled %}
        <form method="post" action="{{ basePath }}/events/{{ eventUid }}/preview-unlock" class="uk-form-stacked uk-margin-top">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          <div class="uk-margin">
            <label class="uk-form-label" for="previewPassword">{{ t('event_preview_password_label') }}</label>
            <div class="uk-form-controls">
              <input
                id="previewPassword"
                class="uk-input"
                type="password"
                name="preview_password"
                placeholder="{{ t('event_preview_password_placeholder') }}"
                autocomplete="off"
                required>
            </div>
          </div>
          <button class="uk-button uk-button-primary" type="submit">{{ t('event_preview_unlock_button') }}</button>
        </form>
      {% else %}
        <p class="uk-text-meta uk-margin-remove">{{ t('event_preview_password_missing_hint') }}</p>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    window.csrfToken = '{{ csrf_token|e('js') }}';
  </script>
{% endblock %}
