{% extends 'layout.twig' %}

{% block title %}Onboarding{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <style>
    .btn {
      font-size: 1rem;
      font-weight: 500;
      letter-spacing: .04em;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-family: 'Poppins',sans-serif;
    }
    .btn-black {
      background: #232323 !important;
      color: #fff !important;
      border: 2px solid #232323;
      transition: all 0.18s;
    }
    .btn-black:hover {
      background: #fff !important;
      color: #232323 !important;
    }
    .btn-transparent {
      background: transparent !important;
      color: #0c86d0 !important;
      border: 2px solid #0c86d0;
      transition: all 0.18s;
    }
    .btn-transparent:hover {
      background: #0c86d0 !important;
      color: #fff !important;
    }
    .uk-card-quizrace {
      border-radius: 14px;
      box-shadow: 0 6px 22px 0 rgba(18,32,73,.06);
      padding: 32px 24px;
      background: #fff;
    }
    .uk-label-large {
      font-size: 1.1rem;
      padding: 0.55em 1.3em;
      border-radius: 22px;
      letter-spacing: 0.03em;
    }
    .uk-card-price {
      border: 2px solid #0c86d0;
      background: #fff;
    }
    .uk-card-popular {
      border: 2px solid #232323;
      background: #0c86d0;
      color: #fff;
      transform: scale(1.05);
      z-index: 1;
      position: relative;
    }
    .uk-card-popular .uk-label {
      background: #232323;
      color: #fff;
    }
    .uk-card-price .uk-text-meta, .uk-text-meta {
      color: #7b7b7b;
      font-size: 0.95rem;
    }
    .uk-card-popular .btn-black {
      background: #fff !important;
      color: #0c86d0 !important;
      border: 2px solid #fff;
    }
    .pricing-grid .uk-card-quizrace {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .pricing-grid .uk-card-quizrace .btn {
      margin-top: auto;
    }
  </style>
{% endblock %}

{% block body_class %}uk-padding{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}
    {% block left %}
      <a href="{{ basePath }}/landing" class="uk-icon-button" uk-icon="icon: arrow-left; ratio: 2" title="Zurück" aria-label="Zurück"></a>
    {% endblock %}
  {% endembed %}
  <div class="uk-container uk-margin-large-top">
    {% if stripe_error %}
      <div class="uk-alert-danger" uk-alert>
        <p>{{ stripe_error }}</p>
      </div>
    {% endif %}

    {% if not stripe_configured %}
      <div class="uk-alert-danger" uk-alert>
        <p>Stripe ist unvollständig konfiguriert.</p>
        <ul>
          {% for key in stripe_missing %}
            <li>{{ key }} fehlt</li>
          {% endfor %}
        </ul>
      </div>
    {% elseif stripe_warnings|length %}
      <div class="uk-alert-warning" uk-alert>
        <p>Stripe-Warnungen:</p>
        <ul>
          {% for w in stripe_warnings %}
            <li>{{ w }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
    <ul class="onboarding-timeline uk-flex uk-flex-center uk-margin-bottom" id="stepTimeline">
      <li class="timeline-step active" data-step="1">1. E-Mail</li>
      <li class="timeline-step" data-step="2">2. Subdomain</li>
      <li class="timeline-step" data-step="3">3. Impressum</li>
      <li class="timeline-step inactive" data-step="4">4. Tarif</li>
      <li class="timeline-step inactive" data-step="5">5. App erstellen</li>
    </ul>
    <div class="uk-text-center uk-margin">
      <button class="uk-button uk-button-default" id="restartOnboarding">Neu starten</button>
    </div>
    <div class="uk-card uk-card-default uk-card-body onboarding-step uk-width-1-1 uk-width-1-2@m uk-margin-auto" id="step1">
      <h3 class="uk-card-title">1. E-Mail eingeben und bestätigen</h3>
      <div class="uk-margin">
        <input id="email" class="uk-input" type="email" placeholder="E-Mail-Adresse" required>
      </div>
      <p>Nach Klick auf die Schaltfläche verschicken wir eine E-Mail mit einem Bestätigungslink. Öffne diesen Link, um deine Adresse zu verifizieren und die Registrierung fortzusetzen.</p>
      <button class="uk-button uk-button-primary" id="sendEmail">Bestätigung senden</button>
      <div id="emailStatus" class="uk-margin-small-top uk-text-success" hidden></div>
    </div>

    <div class="uk-card uk-card-default uk-card-body onboarding-step uk-width-1-1 uk-width-1-2@m uk-margin-auto" id="step2" hidden>
      <h3 class="uk-card-title">2. Subdomain wählen</h3>
      <div id="verifiedHint" class="uk-alert-success" uk-alert hidden>
        <p>Deine E-Mail-Adresse wurde erfolgreich bestätigt.</p>
      </div>
      <div class="uk-margin">
        <label for="subdomain" class="uk-form-label">Subdomain</label>
        <input id="subdomain" class="uk-input" type="text" placeholder="gewünschte Subdomain" maxlength="63" required>
        <div id="subdomainStatus" class="uk-margin-small-top" hidden></div>
        <div class="uk-margin-small-top uk-text-meta">Die vollständige Adresse lautet: <span id="subdomainPreview"></span>.{{ main_domain }}</div>
      </div>
      <p>Gib eine gewünschte Subdomain ein (z.&nbsp;B. <code>meine-seite</code>) und bestätige mit der Schaltfläche. Wir prüfen die Verfügbarkeit und reservieren sie für dich.</p>
      <button class="uk-button uk-button-primary" id="saveSubdomain">Subdomain speichern</button>
    </div>

    <div class="uk-card uk-card-default uk-card-body onboarding-step uk-width-1-1 uk-margin-auto" id="step3" hidden>
      <h3 class="uk-card-title">3. Rechnungsdaten</h3>
      <div class="uk-margin"><input id="imprintName" class="uk-input" type="text" placeholder="Name/Firma" required></div>
      <div class="uk-margin"><input id="imprintStreet" class="uk-input" type="text" placeholder="Straße und Hausnummer" required></div>
      <div class="uk-margin"><input id="imprintZip" class="uk-input" type="text" placeholder="PLZ" required></div>
      <div class="uk-margin"><input id="imprintCity" class="uk-input" type="text" placeholder="Ort" required></div>
      <div class="uk-margin"><input id="imprintEmail" class="uk-input" type="email" placeholder="E-Mail" required></div>
      <div class="uk-margin"><label><input class="uk-checkbox" type="checkbox" id="useAsImprint"> Als Impressum verwenden</label></div>
      <button class="uk-button uk-button-primary" id="saveImprint">Weiter</button>
    </div>

    <div class="uk-card uk-card-default uk-card-body onboarding-step uk-width-1-1 uk-margin-auto" id="step4" hidden>
      <h3 class="uk-card-title">4. Tarif wählen</h3>
      {% if stripe_configured %}
      <p>Wähle einen Tarif und schließe die Zahlung über Stripe ab. Du kannst jeden kostenpflichtigen Tarif 7 Tage lang kostenlos testen.</p>
      {% else %}
      <p class="uk-text-danger">Zahlungsdienstleister nicht konfiguriert. Nur der Starter-Tarif ist verfügbar.</p>
      {% if stripe_missing %}
      <p class="uk-text-meta">Fehlende Variablen: {{ stripe_missing|join(', ') }}</p>
      {% endif %}
      {% endif %}
      <div class="pricing-grid uk-child-width-1-1 uk-child-width-1-3@m" uk-grid>
        <div>
          <div class="uk-card uk-card-price uk-card-quizrace uk-text-center">
            <span class="uk-label uk-label-success uk-label-large">Kostenlos testen</span>
            <h3 class="uk-card-title uk-text-primary uk-margin-small-top">Starter</h3>
            <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700;">9&nbsp;€/Monat</div>
            <div class="uk-text-meta uk-margin-small-bottom">Für kleine Events &amp; Einsteiger</div>
            <ul class="uk-list uk-list-large uk-text-left uk-margin-small-bottom">
              <li><b>7 Tage kostenlos testen</b></li>
              <li><b>1 Event gleichzeitig</b></li>
              <li>5 Teams &amp; 5 Kataloge à 5 Fragen</li>
              <li>Unbegrenzte Teilnehmende pro Team¹</li>
              <li>Live-Ranking &amp; Basis-PDF-Export²</li>
              <li>Alle Fragetypen &amp; QR-Codes</li>
              <li>Backup &amp; editierbare Texte³</li>
            </ul>
            <button class="btn btn-transparent uk-width-1-1 uk-button-large uk-margin-small-top plan-select" data-plan="starter">Tarif wählen</button>
          </div>
        </div>
        {% if stripe_configured %}
        <div>
          <div class="uk-card uk-card-popular uk-card-quizrace uk-text-center">
            <span class="uk-label uk-label-large">Meist gewählt</span>
            <h3 class="uk-card-title uk-margin-small-top" style="color:#fff;">Standard</h3>
            <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700; color:#fff;">39&nbsp;€/Monat</div>
            <div class="uk-text-meta uk-margin-small-bottom" style="color:#fff;">Beliebt bei Schulen &amp; Teams</div>
            <ul class="uk-list uk-list-large uk-text-left uk-margin-small-bottom" style="color:#fff;">
              <li><b>7 Tage kostenlos testen</b></li>
              <li><b>Alle Starter-Funktionen</b></li>
              <li>Bis zu 3 Events gleichzeitig</li>
              <li>10 Teams &amp; 10 Kataloge à 10 Fragen</li>
              <li>Eigene Subdomain</li>
              <li>Vollständiger PDF-Export</li>
            </ul>
            <button class="btn btn-black uk-width-1-1 uk-button-large plan-select" data-plan="standard">Tarif wählen</button>
          </div>
        </div>
        <div>
          <div class="uk-card uk-card-price uk-card-quizrace uk-text-center">
            <span class="uk-label uk-label-primary uk-label-large">Professional</span>
            <h3 class="uk-card-title uk-text-primary uk-margin-small-top">Professional</h3>
            <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700;">79&nbsp;€/Monat</div>
            <div class="uk-text-meta uk-margin-small-bottom">Für Agenturen &amp; Unternehmen</div>
            <ul class="uk-list uk-list-large uk-text-left uk-margin-small-bottom">
              <li><b>7 Tage kostenlos testen</b></li>
              <li><b>Alle Standard-Funktionen</b></li>
              <li>20 Events gleichzeitig (mehr auf Anfrage)</li>
              <li>100 Teams &amp; 50 Kataloge à 50 Fragen</li>
              <li>White-Label &amp; Rollenverwaltung</li>
            </ul>
            <button class="btn btn-transparent uk-width-1-1 uk-button-large plan-select" data-plan="professional">Tarif wählen</button>
          </div>
        </div>
        {% endif %}
      </div>
      <p class="uk-text-meta uk-text-center uk-margin-large-top">Alle Preise zzgl. MwSt. – individuelle Lösungen auf Anfrage.</p>
      <p class="uk-text-meta uk-margin-top">1 (Die Teamgröße ist nicht technisch limitiert und kann bedarfsgerecht festgelegt werden.)</p>
      <p class="uk-text-meta uk-margin-top">2 (Im Starter-Paket mit Wasserzeichen oder ohne individuelles Layout/Logo)</p>
      <p class="uk-text-meta uk-margin-top">3 (z.&nbsp;B. Datenschutz, AGB, Einladung, FAQ, Spielanleitung – alles eigenständig editierbar)</p>
    </div>

      <div class="uk-card uk-card-default uk-card-body onboarding-step uk-width-1-1 uk-width-1-2@m uk-margin-auto" id="step5" hidden>
        <h3 class="uk-card-title">5. App erstellen</h3>
        <p>Deine App wird erstellt. Bitte warten …</p>
        <ul id="task-status" class="uk-list uk-text-left uk-margin"></ul>
        <ul id="task-log" class="uk-list uk-text-left uk-text-meta uk-margin"></ul>
      </div>
    </div>
  {% endblock %}

{% block scripts %}
  <script>
    window.mainDomain = '{{ main_domain }}';
    window.csrfToken = '{{ csrf_token|e('js') }}';
    window.stripeConfigured = {{ stripe_configured ? 'true' : 'false' }};
  </script>
  <script src="{{ basePath }}/js/onboarding.js"></script>
{% endblock %}

