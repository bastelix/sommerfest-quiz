{% extends 'layout.twig' %}

{% block title %}Event konfigurieren{% endblock %}

{% block head %}
  <meta name="csrf-token" content="{{ csrf_token }}">
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/admin-config.css">
{% endblock %}

{% block body_class %}uk-background-muted uk-padding admin-page{% endblock %}

{% block body %}
  <div class="uk-section uk-section-xsmall uk-padding-small uk-section-default" uk-sticky="offset:0">
    <div class="uk-container uk-container-large">
      <div class="uk-flex uk-flex-between uk-flex-middle">
        <div>
          <h1 class="uk-heading-bullet uk-margin-remove">Event konfigurieren</h1>
          <div class="uk-text-meta">ID: {{ event.uid|default('—') }} · letzte Änderung: {{ event.updated_at|default('—') }}</div>
          <div class="uk-text-meta">Änderungen werden automatisch gespeichert.</div>
        </div>
        <div>
          <a class="uk-button uk-button-default" href="{{ basePath }}/?event={{ event.slug|default('demo') }}" target="_blank">Vorschau</a>
        </div>
      </div>
      <div class="uk-margin-top">
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: event.uid|default(''),
          currentEventName: event.name|default('')
        } %}
      </div>
    </div>
  </div>

  <div class="uk-container uk-container-large uk-margin-top">
    <div class="uk-grid-large" uk-grid>
      <div class="uk-width-expand@m">
        <ul uk-tab>
          <li><a href="#">Basis</a></li>
          <li><a href="#">Login &amp; Zugang</a></li>
          <li><a href="#">Spielregeln</a></li>
          <li><a href="#">Extras</a></li>
          <li><a href="#">Integrationen</a></li>
          <li><a href="#">Dashboard</a></li>
          <li><a href="#">Freigabe</a></li>
        </ul>
        <ul class="uk-switcher uk-margin">
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="pageTitle">Titel</label>
                <div class="uk-form-controls">
                    <input class="uk-input" id="pageTitle" name="pageTitle" type="text" placeholder="Modernes Quiz mit UIkit" value="{{ config.pageTitle|default('') }}">
                </div>
                <div class="uk-text-meta">Titel des Events für Teilnehmende.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="logo">Logo</label>
                <div class="uk-form-controls">
                  <div uk-form-custom="target: #logo-filename">
                    <input type="file" id="logo" name="logo" accept="image/*">
                    <button class="uk-button uk-button-default" type="button">Datei wählen</button>
                  </div>
                  <input class="uk-input uk-form-width-medium uk-margin-small-top" id="logo-filename" type="text" placeholder="Keine Datei ausgewählt" disabled>
                  <img id="logoPreview" class="uk-margin-top" hidden alt="Logo Vorschau">
                </div>
                <div class="uk-text-meta">Optionales Logo für das Event.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="buttonColor">Primärfarbe</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="buttonColor" name="buttonColor" type="color" value="{{ config.buttonColor|default('#1e87f0') }}">
                </div>
                <div class="uk-text-meta">Steuert Buttons und Highlights.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="QRUser">Login erforderlich</label>
                <div class="uk-form-controls">
                    <input class="uk-checkbox" id="QRUser" name="QRUser" type="checkbox">
                </div>
                <div class="uk-text-meta">Teilnehmende m&uuml;ssen sich anmelden.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="whitelist">Whitelist</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="whitelist" name="whitelist" rows="3" placeholder="user@example.com"></textarea>
                </div>
                <div class="uk-text-meta">Zugelassene E-Mail-Adressen, eine pro Zeile.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="competitionMode">Wettkampfmodus</label>
                <div class="uk-form-controls">
                  <input class="uk-checkbox" id="competitionMode" name="competitionMode" type="checkbox">
                </div>
                <div class="uk-text-meta">Vergibt Punkte und erstellt ein Ranking.</div>
              </div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" id="puzzleWordEnabled" name="puzzleWordEnabled" type="checkbox"> R&auml;tselwort aktivieren</label>
                <div class="uk-text-meta">Erfordert die Eingabe eines R&auml;tselworts zum Abschluss.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="puzzleWord">R&auml;tselwort</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="puzzleWord" name="puzzleWord" type="text" disabled>
                </div>
                <div class="uk-text-meta">Geheimes Wort, das Teams finden m&uuml;ssen.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="puzzleFeedback">Feedback</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="puzzleFeedback" name="puzzleFeedback" rows="3" disabled></textarea>
                </div>
                <div class="uk-text-meta">Nachricht bei richtigem R&auml;tselwort.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label>
                  <input class="uk-checkbox" id="countdownEnabled" name="countdownEnabled" type="checkbox" {% if config.countdownEnabled %}checked{% endif %}>
                  Countdown aktivieren
                </label>
                <div class="uk-text-meta">Zeigt einen Timer bei Fragen mit hinterlegter Zeitvorgabe.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="countdown">Standard-Zeitlimit (Sekunden)</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="countdown" name="countdown" type="number" min="0" placeholder="0" value="{{ config.countdown|default('') }}">
                </div>
                <div class="uk-text-meta">Leer lassen oder 0 für kein globales Limit. Einzelne Fragen können ein eigenes Zeitlimit setzen.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="webhookUrl">Webhook URL</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="webhookUrl" name="webhookUrl" type="url" placeholder="https://">
                </div>
                <div class="uk-text-meta">Wird bei wichtigen Ereignissen aufgerufen.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="analyticsId">Analytics ID</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="analyticsId" name="analyticsId" type="text">
                </div>
                <div class="uk-text-meta">z.B. Google Analytics Tracking-ID.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="dashboardRefreshInterval">Aktualisierungsintervall (Sekunden)</label>
                <div class="uk-form-controls">
                  <input class="uk-input" id="dashboardRefreshInterval" name="dashboardRefreshInterval" type="number" min="5" max="300" value="{{ config.dashboardRefreshInterval|default(15) }}">
                </div>
                <div class="uk-text-meta">Legt fest, wie oft das Dashboard neue Daten lädt.</div>
              </div>
              <input type="hidden" id="dashboardModules" name="dashboardModules" value="">
              <div class="uk-margin">
                <label class="uk-form-label">Module &amp; Reihenfolge</label>
                <div class="uk-text-meta">Aktivierte Module erscheinen im Dashboard. Die Reihenfolge lässt sich per Drag &amp; Drop verändern.</div>
                <ul class="uk-list uk-list-divider uk-margin-small-top" data-dashboard-modules uk-sortable="handle: .module-handle">
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="header">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Header</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Zeigt Eventtitel, Logo und Countdown.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutHeader">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutHeader" data-module-layout data-default-layout="full">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="rankings">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Ranking-Kacheln</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Top-Kennzahlen aus computeRankings ("Katalogmeister" nach kürzester Gesamtdauer).</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutRankings">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutRankings" data-module-layout data-default-layout="wide">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                    <div class="uk-margin-small-top" data-module-options>
                      <div class="uk-text-meta">Kennzahlen</div>
                      <label class="uk-margin-small-right"><input class="uk-checkbox" type="checkbox" value="points" data-module-metric> Punkte</label>
                      <label class="uk-margin-small-right"><input class="uk-checkbox" type="checkbox" value="puzzle" data-module-metric> Rätselwort</label>
                      <label class="uk-margin-small-right"><input class="uk-checkbox" type="checkbox" value="catalog" data-module-metric> Katalogmeister</label>
                      <label class="uk-margin-small-right"><input class="uk-checkbox" type="checkbox" value="accuracy" data-module-metric> Trefferquote</label>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="results">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Ergebnisliste</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Tabelle mit allen Versuchen.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutResults">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutResults" data-module-layout data-default-layout="full">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="wrongAnswers">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Falsch beantwortete Fragen</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Liste zur Analyse von Stolpersteinen.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutWrong">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutWrong" data-module-layout data-default-layout="auto">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="infoBanner">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Infobanner</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Freier Text für Sponsoren oder Programmhinweise.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutInfo">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutInfo" data-module-layout data-default-layout="auto">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="qrCodes">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">QR-Kataloge</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Zeigt QR-Codes für ausgewählte Kataloge an.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutQr">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutQr" data-module-layout data-default-layout="auto">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                    <div class="uk-margin-small-top" data-module-options>
                      <div class="uk-text-meta">Katalogauswahl</div>
                      <div class="uk-grid-small uk-child-width-1-2@m" uk-grid data-module-catalogs></div>
                      <div class="uk-text-meta uk-margin-small-top" data-module-catalogs-empty>Keine Kataloge verfügbar.</div>
                    </div>
                  </li>
                  <li class="uk-card uk-card-default uk-card-small uk-card-body" data-module-id="media">
                    <div class="uk-flex uk-flex-between uk-flex-middle">
                      <div>
                        <h4 class="uk-margin-remove">Medienbereich</h4>
                        <p class="uk-text-meta uk-margin-remove-top">Highlight-Fotos oder Livestream-Links.</p>
                      </div>
                      <div class="uk-flex uk-flex-middle">
                        <span class="module-handle uk-margin-small-right" uk-icon="icon: table"></span>
                        <label class="uk-margin-remove"><input class="uk-checkbox" type="checkbox" data-module-toggle> Anzeigen</label>
                      </div>
                    </div>
                    <div class="uk-margin-small-top">
                      <label class="uk-form-label" for="dashboardLayoutMedia">Layout</label>
                      <select class="uk-select uk-form-small" id="dashboardLayoutMedia" data-module-layout data-default-layout="auto">
                        <option value="auto">Automatisch (eine Spalte)</option>
                        <option value="wide">Breit (zwei Spalten)</option>
                        <option value="full">Volle Breite</option>
                      </select>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="dashboardInfoText">Infobanner-Inhalt</label>
                <textarea class="uk-textarea" id="dashboardInfoText" name="dashboardInfoText" rows="4" placeholder="Sponsorenhinweis oder Programm">{{ config.dashboardInfoText|default('') }}</textarea>
                <div class="uk-text-meta">Unterstützt einfache HTML-Auszeichnungen wie &lt;p&gt;, &lt;br&gt;, &lt;strong&gt;.</div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="dashboardMediaEmbed">Medien-Links (ein Eintrag pro Zeile)</label>
                <textarea class="uk-textarea" id="dashboardMediaEmbed" name="dashboardMediaEmbed" rows="4" placeholder="https://beispiel.de/foto.jpg&#10;https://youtube.com/embed/...">{{ config.dashboardMediaEmbed|default('') }}</textarea>
                <div class="uk-text-meta">Erlaubt http/https-Links zu Bildern oder Streams. Jeder Link erscheint als Karte.</div>
              </div>
            </form>
          </li>
          <li>
            <form class="uk-form-stacked">
              <fieldset class="uk-fieldset">
                <legend>Öffentliches Dashboard</legend>
                <label>
                  <input class="uk-checkbox" id="dashboardShareEnabled" name="dashboardShareEnabled" type="checkbox" {% if config.dashboardShareEnabled %}checked{% endif %}>
                  Dashboard aktivieren
                </label>
                <div class="uk-margin">
                  <label class="uk-form-label" for="dashboardPublicLink">Freigabelink</label>
                  <div class="uk-form-controls uk-flex">
                    <input class="uk-input uk-flex-1" id="dashboardPublicLink" type="text" readonly data-share-link="public" data-skip-save>
                    <button class="uk-button uk-button-default uk-margin-small-left" type="button" data-copy-link="public">Kopieren</button>
                    <button class="uk-button uk-button-secondary uk-margin-small-left" type="button" data-rotate-token="public">Token neu</button>
                  </div>
                  <div class="uk-text-meta">Der Link enthält ein zufälliges Token. Beim Rotieren werden alte Links ungültig.</div>
                </div>
              </fieldset>
              <fieldset class="uk-fieldset uk-margin">
                <legend>Sponsor &amp; Moderation</legend>
                <label>
                  <input class="uk-checkbox" id="dashboardSponsorEnabled" name="dashboardSponsorEnabled" type="checkbox" {% if config.dashboardSponsorEnabled %}checked{% endif %}>
                  Erweiterte Ansicht aktivieren
                </label>
                <div class="uk-margin">
                  <label class="uk-form-label" for="dashboardSponsorLink">Freigabelink</label>
                  <div class="uk-form-controls uk-flex">
                    <input class="uk-input uk-flex-1" id="dashboardSponsorLink" type="text" readonly data-share-link="sponsor" data-skip-save>
                    <button class="uk-button uk-button-default uk-margin-small-left" type="button" data-copy-link="sponsor">Kopieren</button>
                    <button class="uk-button uk-button-secondary uk-margin-small-left" type="button" data-rotate-token="sponsor">Token neu</button>
                  </div>
                </div>
              </fieldset>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-2@s">
                  <label class="uk-form-label" for="dashboardVisibilityStart">Sichtbar ab</label>
                  <input class="uk-input" id="dashboardVisibilityStart" name="dashboardVisibilityStart" type="datetime-local" value="{{ config.dashboardVisibilityStart|default('') }}">
                </div>
                <div class="uk-width-1-2@s">
                  <label class="uk-form-label" for="dashboardVisibilityEnd">Sichtbar bis</label>
                  <input class="uk-input" id="dashboardVisibilityEnd" name="dashboardVisibilityEnd" type="datetime-local" value="{{ config.dashboardVisibilityEnd|default('') }}">
                </div>
              </div>
              <div class="uk-text-meta uk-margin-small-top">Leer lassen, um das Dashboard dauerhaft freizugeben.</div>
            </form>
          </li>
        </ul>
      </div>
      <aside class="uk-width-1-4@m event-config-sidebar">
        <div uk-sticky="offset: 20; bottom: true">
          <div class="uk-card uk-card-default uk-card-body">
            <h3 class="uk-card-title uk-margin-remove">Vorschau</h3>
            <div class="uk-text-center uk-margin-small-top">
              <img id="preview-logo" src="{{ basePath }}/logo-160.svg" alt="Logo" class="uk-margin-small-bottom">
              <div>
                <button class="uk-button uk-button-primary uk-margin-small-right">Primär</button>
                <button class="uk-button uk-button-default">Standard</button>
              </div>
            </div>
          </div>
          <div class="uk-card uk-card-default uk-card-body uk-margin-small-top">
            <h3 class="uk-card-title uk-margin-remove">Status</h3>
            <p class="uk-text-meta uk-margin-small">Entwurf</p>
            <button class="uk-button uk-button-primary uk-width-1-1">Veröffentlichen</button>
          </div>
          <div class="uk-card uk-card-default uk-card-body uk-margin-small-top">
            <h3 class="uk-card-title uk-margin-remove">Presets</h3>
            <div class="uk-margin-small-top">
              <button class="uk-button uk-button-default uk-width-1-1 uk-margin-small-bottom" data-preset="simple">Simple</button>
              <button class="uk-button uk-button-default uk-width-1-1 uk-margin-small-bottom" data-preset="rallye">Rallye</button>
              <button class="uk-button uk-button-default uk-width-1-1" data-preset="competitive">Competitive</button>
            </div>
          </div>
          <div class="uk-card uk-card-default uk-card-body uk-margin-small-top">
            <h3 class="uk-card-title uk-margin-remove">QR-Links</h3>
            <div class="uk-margin-small-top">
              <a class="uk-button uk-button-default uk-width-1-1 uk-margin-small-bottom" href="{{ basePath }}/qr/event?event={{ (event.slug|default('demo')) }}&t={{ ('?event=' ~ (event.slug|default('demo')))|url_encode }}" target="_blank">Event‑QR</a>
              <a class="uk-button uk-button-default uk-width-1-1 uk-margin-small-bottom" href="{{ basePath }}/qr/catalog?t={{ (baseUrl ~ '/?event=' ~ (event.slug|default('demo')) ~ '&katalog=' ~ (catalog.slug|default('default')))|url_encode }}" target="_blank">Katalog‑QR</a>
              <a class="uk-button uk-button-default uk-width-1-1" href="{{ basePath }}/qr/team?t={{ (team|default('team-1'))|url_encode }}" target="_blank">Team‑QR</a>
            </div>
          </div>
        </div>
      </aside>
  </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ basePath }}/js/event-config.js" data-event-id="{{ event.uid }}" data-csrf="{{ csrf_token }}"></script>
{% endblock %}

