{# Menus Tab: Menu definitions, menu selector, locale filter, and menu editor (tree or table) #}
{% set activePageNamespace = pageNamespace|default('default') %}
{% set menuDefinitions = menu_definitions|default([]) %}
{% set hasMenus = menuDefinitions is not empty %}
{% set selectedMenuId = selected_menu_id|default('') %}

<div
  class="uk-card uk-card-default uk-card-body uk-margin-small"
  data-marketing-menu-overview
  data-base-path="{{ basePath }}"
  data-menus="{{ menuDefinitions|json_encode|e('html_attr') }}"
>
  <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap">
    <div>
      <div class="uk-text-meta uk-text-uppercase">{{ t('label_navigation_menus') }}</div>
      <h3 class="uk-card-title uk-margin-remove">{{ t('label_navigation_menu_overview') }}</h3>
    </div>
    <span class="uk-text-meta">{{ t('label_navigation_menus_scope') }}</span>
  </div>
  <form class="uk-form-stacked uk-margin-small-top" data-menu-create-form>
    <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-3@s uk-flex-middle" uk-grid>
      <div>
        <label class="uk-form-label" for="newMenuLabel">{{ t('label_navigation_new_menu') }}</label>
        <div class="uk-form-controls">
          <input
            id="newMenuLabel"
            class="uk-input"
            type="text"
            name="label"
            maxlength="64"
            placeholder="z. B. Hauptnavigation"
            required
          >
        </div>
      </div>
      <div>
        <label class="uk-form-label" for="newMenuLocale">Locale</label>
        <div class="uk-form-controls">
          <input
            id="newMenuLocale"
            class="uk-input"
            type="text"
            name="locale"
            maxlength="8"
            value="{{ locale()|default('de') }}"
          >
        </div>
      </div>
      <div class="uk-flex uk-flex-middle">
        <label class="uk-flex uk-flex-middle uk-margin-small-right">
          <input class="uk-checkbox" type="checkbox" name="isActive" checked>
          <span class="uk-margin-small-left">Aktiv</span>
        </label>
        <button type="submit" class="uk-button uk-button-primary">Anlegen</button>
      </div>
    </div>
  </form>
  <div class="uk-overflow-auto admin-table-wrapper uk-margin-small-top">
    <table class="uk-table uk-table-divider uk-table-small uk-table-middle">
      <thead>
        <tr>
          <th>Menü</th>
          <th class="uk-table-shrink">Locale</th>
          <th class="uk-table-shrink">Status</th>
          <th class="uk-table-shrink uk-text-center">In Verwendung</th>
          <th class="uk-table-shrink">Aktualisiert</th>
          <th class="uk-table-shrink uk-text-right">Aktionen</th>
        </tr>
      </thead>
      <tbody data-menu-overview-items>
        <tr data-menu-overview-loading>
          <td colspan="6">Lädt…</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="uk-alert uk-alert-primary uk-margin-small" data-menu-overview-feedback hidden role="status"></div>
</div>
<div id="menuDefinitionModal" uk-modal>
  <div class="uk-modal-dialog uk-modal-body">
    <h2 class="uk-modal-title" data-menu-modal-title>Menü bearbeiten</h2>
    <form class="uk-form-stacked" data-menu-modal-form>
      <input type="hidden" name="menuId">
      <input type="hidden" name="mode" value="rename">
      <div class="uk-margin">
        <label class="uk-form-label" for="menuModalLabel">Menü-Label</label>
        <div class="uk-form-controls">
          <input
            id="menuModalLabel"
            class="uk-input"
            type="text"
            name="label"
            maxlength="64"
            required
          >
        </div>
      </div>
      <div class="uk-margin">
        <label class="uk-form-label" for="menuModalLocale">Locale</label>
        <div class="uk-form-controls">
          <input
            id="menuModalLocale"
            class="uk-input"
            type="text"
            name="locale"
            maxlength="8"
          >
        </div>
      </div>
      <div class="uk-margin">
        <label class="uk-flex uk-flex-middle">
          <input class="uk-checkbox" type="checkbox" name="isActive">
          <span class="uk-margin-small-left">Aktiv</span>
        </label>
      </div>
      <div class="uk-margin uk-flex uk-flex-right uk-flex-middle" style="gap: 8px;">
        <button type="button" class="uk-button uk-button-default uk-modal-close">Abbrechen</button>
        <button type="submit" class="uk-button uk-button-primary" data-menu-modal-submit>Speichern</button>
      </div>
    </form>
  </div>
</div>

<div class="uk-card uk-card-default uk-card-body uk-margin">
  <label class="uk-form-label" for="menuDefinitionSelect">Menü auswählen</label>
  <div class="uk-form-controls">
    <select
      id="menuDefinitionSelect"
      class="uk-select"
      data-selected="{{ selectedMenuId }}"
      {% if not hasMenus %}disabled{% endif %}
    >
      {% if not hasMenus %}
        <option value="" selected>Keine Menüs vorhanden</option>
      {% endif %}
      {% for menu in menuDefinitions %}
        <option
          value="{{ menu.id }}"
          {% if menu.id == selectedMenuId %}selected{% endif %}
        >{{ menu.label }} ({{ menu.locale }})</option>
      {% endfor %}
    </select>
  </div>
</div>

{% set marketingLocaleOptions = ['de', 'en'] %}
{% set selectedMenuLocale = locale()|default('de') %}
<div class="uk-card uk-card-default uk-card-body uk-margin">
  <label class="uk-form-label" for="menuLocaleSelect">Locale-Filter</label>
  <div class="uk-form-controls">
    <select id="menuLocaleSelect" class="uk-select" data-menu-locale-select>
      <option value="">Alle Locales</option>
      {% for localeOption in marketingLocaleOptions %}
        <option
          value="{{ localeOption|e('html_attr') }}"
          {% if localeOption == selectedMenuLocale %}selected{% endif %}
        >{{ localeOption }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="uk-text-meta uk-margin-small-top">
    Optional: Ohne Auswahl werden Menüeinträge aus allen Locales angezeigt.
  </div>
</div>
  <div class="uk-grid-medium" uk-grid>
    <div class="uk-width-expand@m">
      <div
        class="uk-card uk-card-default uk-card-body uk-margin"
        data-marketing-menu-cards
        data-base-path="{{ basePath }}"
        data-menus="{{ menuDefinitions|json_encode|e('html_attr') }}"
        data-internal-links="{{ internal_links|default([])|json_encode|e('html_attr') }}"
        data-selected-menu-id="{{ hasMenus ? selectedMenuId : '' }}"
        data-namespace="{{ activePageNamespace|e('html_attr') }}"
        data-locale="{{ selectedMenuLocale|e('html_attr') }}"
        data-page-id="{{ anchor_page_id|default('')|e('html_attr') }}"
      >
        <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap" style="gap: 12px;">
          <div>
            <h3 class="uk-card-title uk-margin-remove">Menü-Editor</h3>
          </div>
          <div class="menu-cards-toolbar">
            <button
              type="button"
              class="uk-button uk-button-default uk-button-small"
              data-menu-cards-generate-ai
              {% if selectedMenuId == '' %}disabled{% endif %}
            ><span uk-icon="icon: bolt; ratio: 0.75"></span> KI generieren</button>
            <div class="uk-button-group">
              <button
                type="button"
                class="uk-button uk-button-primary uk-button-small"
                data-menu-cards-save
                disabled
              >Speichern</button>
              <button
                type="button"
                class="uk-button uk-button-default uk-button-small"
                data-menu-cards-cancel
                disabled
              >Abbrechen</button>
            </div>
            <div class="uk-button-group">
              <button type="button" class="uk-button uk-button-default uk-button-small" data-menu-cards-export {% if selectedMenuId == '' %}disabled{% endif %}><span uk-icon="icon: download; ratio: 0.75"></span> Export</button>
              <button type="button" class="uk-button uk-button-default uk-button-small" data-menu-cards-import {% if selectedMenuId == '' %}disabled{% endif %}><span uk-icon="icon: upload; ratio: 0.75"></span> Import</button>
            </div>
            <input type="file" accept="application/json" data-menu-cards-import-input hidden>
            <button type="button" class="uk-button uk-button-primary uk-button-small" data-menu-cards-add {% if selectedMenuId == '' %}disabled{% endif %}><span uk-icon="icon: plus; ratio: 0.75"></span> Eintrag</button>
          </div>
        </div>
        {% if not hasMenus %}
          <div class="uk-alert uk-alert-warning uk-margin-small-top">
            Erstelle zuerst ein Menü, um die Navigation zu bearbeiten.
          </div>
        {% endif %}
        <p class="uk-text-meta uk-margin-small-top">
          Klicke auf <span uk-icon="icon: pencil; ratio: 0.65"></span> zum Bearbeiten. Drag &amp; Drop per <span uk-icon="icon: more-vertical; ratio: 0.65"></span> ordnet Einträge um.
        </p>
        <div class="uk-alert uk-alert-primary uk-margin-small" data-menu-cards-feedback hidden role="status"></div>
        <div class="menu-cards-list" data-menu-cards-list>
          <div class="menu-cards-empty">Bitte ein Menü auswählen oder anlegen.</div>
        </div>
      </div>
    </div>
    <aside class="uk-width-1-3@m uk-width-1-4@l">
      <div class="uk-card uk-card-default uk-card-body uk-margin">
        <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
          <div>
            <div class="uk-text-meta uk-text-uppercase">Vorschau</div>
            <h4 class="uk-heading-line uk-margin-remove"><span>Navigation</span></h4>
          </div>
        </div>
        <div class="uk-text-meta uk-margin-small-bottom">Aktive Menüeinträge</div>
        <div class="uk-alert uk-alert-primary uk-margin-small" data-menu-cards-preview-empty hidden>
          Noch keine Menüeinträge vorhanden.
        </div>
        <div data-menu-cards-preview></div>
      </div>
    </aside>
  </div>
