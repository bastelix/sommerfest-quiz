{% extends 'admin/base.twig' %}

{% block title %}{{ t('label_footer_block_editor') }}{% endblock %}

{% block content %}
  <div class="uk-container uk-container-large uk-margin-top">
    <main>
      <div class="uk-card uk-card-default uk-card-body">
        <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-bottom">
          <h2 class="uk-card-title uk-margin-remove">{{ t('label_footer_block_editor') }}</h2>
          <a href="{{ basePath }}/admin/navigation" class="uk-button uk-button-default uk-button-small">
            <span uk-icon="icon: arrow-left"></span> {{ t('label_back_to_navigation') }}
          </a>
        </div>

        <div class="uk-alert uk-alert-primary" uk-alert>
          <p>{{ t('text_footer_block_editor_intro') }}</p>
        </div>

        <!-- Locale and Slot Selection -->
        <div class="uk-margin">
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-1-3@s">
              <label class="uk-form-label">Namespace</label>
              <select id="footerBlockNamespace" class="uk-select" data-namespace-select>
                {% for ns in namespaces %}
                  <option value="{{ ns|e('html_attr') }}" {% if ns == currentNamespace %}selected{% endif %}>
                    {{ ns }}
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="uk-width-1-3@s">
              <label class="uk-form-label">Locale</label>
              <select id="footerBlockLocale" class="uk-select" data-locale-select>
                {% for locale in localeOptions %}
                  <option value="{{ locale|e('html_attr') }}">{{ locale }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="uk-width-1-3@s">
              <label class="uk-form-label">Footer Slot</label>
              <select id="footerBlockSlot" class="uk-select" data-slot-select>
                <option value="footer_1">Footer Column 1</option>
                <option value="footer_2">Footer Column 2</option>
                <option value="footer_3">Footer Column 3</option>
              </select>
            </div>
          </div>
        </div>

        <hr class="uk-divider-icon">

        <!-- Block List -->
        <div class="uk-margin">
          <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-bottom">
            <h3 class="uk-heading-bullet">{{ t('label_footer_blocks') }}</h3>
            <button class="uk-button uk-button-primary uk-button-small" data-add-block-btn>
              <span uk-icon="icon: plus"></span> {{ t('label_add_block') }}
            </button>
          </div>

          <div id="footerBlocksList" data-blocks-container>
            <!-- Blocks will be rendered here by JavaScript -->
            <div class="uk-text-center uk-text-muted uk-padding">
              <span uk-spinner></span> {{ t('label_loading') }}...
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Block Editor Modal -->
  <div id="blockEditorModal" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
      <button class="uk-modal-close-default" type="button" uk-close></button>
      <h2 class="uk-modal-title" data-modal-title>{{ t('label_add_block') }}</h2>

      <form id="blockEditorForm" data-block-form>
        <input type="hidden" name="blockId" data-block-id>

        <div class="uk-margin">
          <label class="uk-form-label">{{ t('label_block_type') }}</label>
          <select name="type" class="uk-select" data-type-select required>
            <option value="menu">{{ t('label_block_type_menu') }}</option>
            <option value="text">{{ t('label_block_type_text') }}</option>
            <option value="social">{{ t('label_block_type_social') }}</option>
            <option value="contact">{{ t('label_block_type_contact') }}</option>
            <option value="newsletter">{{ t('label_block_type_newsletter') }}</option>
            <option value="html">{{ t('label_block_type_html') }}</option>
          </select>
        </div>

        <div id="blockContentFields" data-content-fields>
          <!-- Dynamic content fields will be rendered here based on block type -->
        </div>

        <div class="uk-margin">
          <label class="uk-form-label">
            <input type="checkbox" name="isActive" class="uk-checkbox" data-active-checkbox checked>
            {{ t('label_active') }}
          </label>
        </div>

        <div class="uk-margin">
          <button type="submit" class="uk-button uk-button-primary">
            {{ t('label_save') }}
          </button>
          <button type="button" class="uk-button uk-button-default uk-modal-close">
            {{ t('label_cancel') }}
          </button>
        </div>
      </form>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    window.templateData = {
      menuDefinitions: {{ menuDefinitions|json_encode|raw }}
    };
  </script>
  <script type="module" src="{{ basePath }}/js/marketing-footer-blocks.js"></script>
{% endblock %}
