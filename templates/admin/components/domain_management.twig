{% import 'components/standard_table.twig' as standard_table %}

<div id="domains" class="uk-card uk-card-default uk-card-body uk-margin">
  <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap">
    <h3 class="uk-heading-bullet uk-margin-remove-bottom">{{ t('heading_domains') }}</h3>
    <div class="uk-margin-small-top@s">
      <button
        type="button"
        class="uk-button uk-button-default"
        data-renew-ssl-main
        data-success="{{ t('notify_domain_ssl_issued')|e('html_attr') }}"
        data-error="{{ t('notify_domain_ssl_error')|e('html_attr') }}"
      >
        <span uk-icon="lock" class="uk-margin-small-right"></span>{{ t('action_renew_ssl') }}
      </button>
    </div>
  </div>
  <div class="uk-margin-top">
    <p class="uk-text-meta">{{ t('text_domain_management_hint') }}</p>
    <div class="uk-card uk-card-default uk-card-body uk-margin-small-top">
      <form
        id="domainForm"
        class="uk-form-stacked"
        novalidate
        data-invalid="{{ t('notify_domain_invalid') }}"
        data-error="{{ t('notify_domain_error') }}"
        data-success="{{ t('notify_domain_saved') }}"
      >
        <fieldset class="uk-fieldset">
          <legend
            id="domainLegend"
            class="uk-legend"
            data-add-label="{{ t('heading_domain_add') }}"
            data-edit-label="{{ t('heading_domain_edit') }}"
          >
            {{ t('heading_domain_add') }}
          </legend>
          <input type="hidden" id="domainId" name="id">
          <div class="uk-alert uk-alert-danger uk-margin-small-bottom" id="domainFormError" hidden role="alert"></div>
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-1-1 uk-width-1-2@m">
              <label class="uk-form-label" for="domainHost">{{ t('label_domain_host') }}</label>
              <div class="uk-form-controls">
                <input
                  class="uk-input"
                  type="text"
                  id="domainHost"
                  name="domain"
                  required
                  placeholder="{{ t('placeholder_domain_host') }}"
                  autocomplete="off"
                >
              </div>
              <p class="uk-text-meta uk-margin-small">{{ t('text_domain_host_hint') }}</p>
            </div>
            <div class="uk-width-1-1 uk-width-1-2@m">
              <label class="uk-form-label" for="domainLabel">{{ t('label_domain_label') }}</label>
              <div class="uk-form-controls">
                <input
                  class="uk-input"
                  type="text"
                  id="domainLabel"
                  name="label"
                  maxlength="120"
                  placeholder="{{ t('placeholder_domain_label') }}"
                  autocomplete="off"
                >
              </div>
              <p class="uk-text-meta uk-margin-small">{{ t('text_domain_label_hint') }}</p>
            </div>
            <div class="uk-width-1-1 uk-width-1-2@m">
              <label class="uk-form-label" for="domainNamespace">{{ t('label_domain_namespace') }}</label>
              <div class="uk-form-controls">
                <select class="uk-select" id="domainNamespace" name="namespace">
                  <option value="">{{ t('text_domain_namespace_none') }}</option>
                  {% for entry in available_namespaces|default([]) %}
                    {% set entryNamespace = entry.namespace|default('') %}
                    {% if entryNamespace is not empty %}
                      <option value="{{ entryNamespace }}">{{ entry.label|default(entryNamespace) }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
              </div>
              <p class="uk-text-meta uk-margin-small">{{ t('text_domain_namespace_hint') }}</p>
            </div>
            <div class="uk-width-1-1 uk-width-1-2@m">
              <label class="uk-form-label">{{ t('label_domain_status') }}</label>
              <div class="uk-form-controls">
                <label class="uk-text-small">
                  <input class="uk-checkbox" type="checkbox" id="domainActive" name="is_active" checked>
                  {{ t('label_domain_active') }}
                </label>
              </div>
            </div>
            <div class="uk-width-1-1 uk-flex uk-flex-middle uk-flex-between">
              <span class="uk-text-meta">{{ t('text_domain_submit_hint') }}</span>
              <div class="uk-flex uk-flex-middle" style="gap: 8px;">
                <button type="submit" class="uk-button uk-button-primary">{{ t('action_domain_save') }}</button>
                <button type="button" class="uk-button uk-button-default" id="domainFormCancel" hidden>
                  {{ t('action_cancel') }}
                </button>
              </div>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    {% set domainNamespaceLabels = {} %}
    {% for entry in available_namespaces|default([]) %}
      {% set ns = entry.namespace|default('') %}
      {% if ns is not empty %}
        {% set domainNamespaceLabels = domainNamespaceLabels|merge({ (ns): entry.label|default(ns) }) %}
      {% endif %}
    {% endfor %}

    {% set domainHeadings = [
      { label: t('column_domain') },
      { label: t('column_domain_label') },
      { label: t('column_domain_namespace') },
      { label: t('column_domain_status') },
      { label: t('column_actions'), class: 'uk-table-shrink uk-text-center' },
    ] %}

    {% set domainBody %}
      {% set domainList = domains|default(null) %}
      {% if domainList is iterable and domainList|length > 0 %}
        {% for domain in domainList %}
          {% set namespaceLabel = domainNamespaceLabels[domain.namespace] ?? (domain.namespace ?? t('text_domain_namespace_none')) %}
          <tr>
            <td>{{ domain.host|default(domain.normalized_host)|e }}</td>
            <td>{{ domain.label|default('')|e }}</td>
            <td>{{ namespaceLabel|e }}</td>
            <td>{{ domain.is_active ? t('label_namespace_active') : t('label_namespace_inactive') }}</td>
            <td class="uk-table-shrink uk-text-center">
              <div class="uk-inline">
                <button class="uk-icon-button" type="button" uk-icon="more-vertical"></button>
                <div uk-dropdown="mode: click; pos: bottom-right; container: body">
                  <ul class="uk-nav uk-dropdown-nav">
                    <li class="uk-nav-header">{{ t('column_actions') }}</li>
                    <li>
                      <a href="#" data-domain-id="{{ domain.id }}" data-domain-action="edit">
                        <span uk-icon="pencil" class="uk-margin-small-right"></span>{{ t('action_edit') }}
                      </a>
                    </li>
                    <li>
                      <a href="#" data-domain-id="{{ domain.id }}" data-domain-action="renew-ssl">
                        <span uk-icon="lock" class="uk-margin-small-right"></span>{{ t('action_renew_ssl') }}
                      </a>
                    </li>
                    <li class="uk-nav-divider"></li>
                    <li>
                      <a
                        href="#"
                        class="uk-text-danger"
                        data-domain-id="{{ domain.id }}"
                        data-domain-action="delete"
                      >
                        <span uk-icon="trash" class="uk-margin-small-right"></span>{{ t('action_delete') }}
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </td>
          </tr>
        {% endfor %}
      {% elseif domainList is iterable %}
        <tr>
          <td colspan="5">{{ t('text_domains_empty') }}</td>
        </tr>
      {% else %}
        <tr>
          <td colspan="5">{{ t('text_domains_loading') }}</td>
        </tr>
      {% endif %}
    {% endset %}

    <div
      id="domainTable"
      data-domain-table
      data-loading="{{ t('text_domains_loading') }}"
      data-empty="{{ t('text_domains_empty') }}"
      data-error="{{ t('text_domains_error') }}"
      data-column-count="5"
      data-ignore-global-filters="true"
    >
      {{ standard_table.render(domainHeadings, 'domainTableBody', domainBody) }}
    </div>
  </div>
</div>
