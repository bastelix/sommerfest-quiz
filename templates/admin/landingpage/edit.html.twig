{% extends 'admin/base.twig' %}

{% block title %}{{ t('heading_landingpage_edit') }}{% endblock %}

{% block content %}
  <div class="uk-container uk-container-large">
    <div class="uk-container uk-container-small">
      <h1 class="uk-heading-bullet">{{ t('heading_landingpage_edit') }}</h1>
      {% set activePageNamespace = pageNamespace|default('default') %}
      {% set pageNamespaceQuery = pageNamespaceQuery|default(activePageNamespace is not empty ? '?namespace=' ~ activePageNamespace|url_encode : '') %}
      {% if seoPages|default([]) is empty %}
        <div class="uk-alert uk-alert-warning">{{ t('text_no_marketing_pages_seo') }}</div>
      {% else %}
      <form
        class="uk-form-stacked seo-form"
        action="{{ basePath }}/admin/landingpage/seo{{ pageNamespaceQuery }}"
        method="post"
        data-save-url="{{ basePath }}/admin/landingpage/seo{{ pageNamespaceQuery }}"
        data-ai-url="{{ basePath }}/admin/landingpage/seo/ai-import{{ pageNamespaceQuery }}"
      >
        <input type="hidden" name="pageId" value="{{ config.pageId|default(selectedPageId)|default('') }}">
        <input type="hidden" name="domain" id="seoDomain" value="{{ config.domain|default('') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="uk-margin">
          <label class="uk-form-label" for="seoPageSelect">{{ t('label_marketing_page') }}</label>
          <div class="uk-form-controls">
            <select
              id="seoPageSelect"
              class="uk-select"
              data-configs="{{ seoPages|json_encode|e('html_attr') }}"
              data-selected="{{ selectedPageId|default(config.pageId|default('')) }}"
            >
              {% for page in seoPages %}
                <option
                  value="{{ page.id }}"{% if page.id == selectedPageId %} selected{% endif %}
                  data-slug="{{ page.slug }}"
                  data-title="{{ page.title }}"
                >
                  {{ page.title }} ({{ page.slug }})
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <h2>{{ t('heading_seo_settings') }}</h2>
        <div class="uk-margin">
          <label class="uk-form-label" for="metaTitle">{{ t('label_meta_title') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="metaTitle" name="meta_title" type="text" required data-maxlength="60" value="{{ config.metaTitle|default('') }}">
            <small class="uk-text-meta char-count" data-for="metaTitle">0/60</small>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="metaDescription">{{ t('label_meta_description') }}</label>
          <div class="uk-form-controls">
            <textarea class="uk-textarea" id="metaDescription" name="meta_description" required data-maxlength="160">{{ config.metaDescription|default('') }}</textarea>
            <small class="uk-text-meta char-count" data-for="metaDescription">0/160</small>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="slug">{{ t('label_slug') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="slug" name="slug" type="text" required data-maxlength="100" value="{{ config.slug|default('') }}">
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="canonical">{{ t('label_canonical') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="canonical" name="canonical" type="url" value="{{ config.canonicalUrl|default('') }}">
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="faviconPath">{{ t('label_favicon') }}</label>
          <div class="uk-form-controls uk-flex uk-flex-middle uk-flex-wrap" style="gap:8px;">
            <input class="uk-input uk-flex-auto" id="faviconPath" name="favicon_path" type="text" placeholder="/uploads/favicon.svg" value="{{ config.faviconPath|default('') }}">
            <button type="button" class="uk-button uk-button-default" id="faviconSelectButton">{{ t('action_select_from_media') }}</button>
          </div>
          <small class="uk-text-meta">{{ t('text_favicon_hint') }}</small>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="robots">{{ t('label_robots') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="robots" name="robots" type="text" placeholder="index, follow" value="{{ config.robotsMeta|default('') }}">
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label">{{ t('heading_og_tags') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input uk-margin-small-bottom" id="ogTitle" name="og_title" type="text" placeholder="og:title" data-maxlength="60" value="{{ config.ogTitle|default('') }}">
            <input class="uk-input uk-margin-small-bottom" id="ogDescription" name="og_description" type="text" placeholder="og:description" data-maxlength="160" value="{{ config.ogDescription|default('') }}">
            <input class="uk-input" id="ogImage" name="og_image" type="url" placeholder="og:image" value="{{ config.ogImage|default('') }}">
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="schema">{{ t('label_schema_org') }}</label>
          <div class="uk-form-controls">
            <textarea class="uk-textarea" id="schema" name="schema" rows="4" placeholder="{ }">{{ config.schemaJson|default('') }}</textarea>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="hreflang">{{ t('label_hreflang') }}</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="hreflang" name="hreflang" type="text" placeholder="de, en, ..." value="{{ config.hreflang|default('') }}">
          </div>
        </div>
        <div class="uk-margin">
          <button type="button" class="uk-button uk-button-default import-seo-example">{{ t('action_import_example') }}</button>
          <button type="submit" class="uk-button uk-button-primary uk-margin-left">{{ t('action_save') }}</button>
        </div>
      </form>
      <div id="seoMediaModal" class="uk-modal" uk-modal>
        <div class="uk-modal-dialog uk-modal-body">
          <button class="uk-modal-close-default" type="button" uk-close></button>
          <h2 class="uk-modal-title">{{ t('heading_select_favicon') }}</h2>
          <div class="uk-margin-small">
            <input class="uk-input" type="search" placeholder="{{ t('placeholder_search') }}" data-role="media-search">
          </div>
          <div class="uk-overflow-auto" style="max-height: 320px;">
            <ul class="uk-list uk-list-divider" data-role="media-list"></ul>
          </div>
          <p class="uk-text-meta" data-role="media-empty" hidden>{{ t('text_no_media_found') }}</p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script type="module" src="{{ basePath }}/js/admin.js"></script>
  <script type="module" src="{{ basePath }}/js/seo-form.js"></script>
{% endblock %}
