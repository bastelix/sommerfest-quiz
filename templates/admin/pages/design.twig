{% extends 'layout.twig' %}
{% set includeMarketingThemeVars = true %}

{% block config_color_styles %}{% endblock %}

{% block title %}Design – Namespace: {{ pageNamespace|default('') }}{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css" media="(prefers-color-scheme: dark)">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/admin-design.css">
  <script type="module" src="{{ basePath }}/js/admin-design.js"></script>
{% endblock %}

{% block body_class %}uk-background-muted uk-padding admin-page{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}
    {% block left %}
      <button
        id="sidebarToggle"
        type="button"
        class="uk-navbar-toggle uk-visible@m uk-margin-small-right git-btn"
        aria-controls="adminSidebar"
        aria-expanded="true"
        aria-pressed="false"
        aria-label="{{ t('menu') }}"
      >
        <span uk-navbar-toggle-icon></span>
      </button>
      <a href="{{ basePath }}/admin/dashboard" class="uk-navbar-item uk-logo uk-margin-small-left uk-visible@s">
        QuizRace Admin
      </a>
    {% endblock %}
    {% block center %}
      {% include 'admin/components/namespace_breadcrumb.twig' %}
    {% endblock %}
    {% block offcanvas %}
      <div id="qr-offcanvas" uk-offcanvas="overlay: true">
        <div class="uk-offcanvas-bar">
          <button class="uk-offcanvas-close" type="button" uk-close aria-label="{{ t('menu') }}"></button>
          <h3 class="uk-margin-small">QuizRace</h3>
          {% include 'admin/_nav.twig' %}
        </div>
      </div>
    {% endblock %}
  {% endembed %}

  <div class="uk-grid-collapse" uk-grid>
    <aside id="adminSidebar" class="uk-width-1-4@m uk-width-1-5@l uk-visible@m qr-sidebar">
      <div class="uk-card qr-card uk-card-body qr-sidebar-card">
        {% include 'admin/_nav.twig' %}
      </div>
    </aside>
    <main class="uk-width-expand uk-padding-small@xs uk-padding" id="design-editor"
      data-default-tokens='{{ tokenDefaults|json_encode|e('html_attr') }}'
      data-current-tokens='{{ tokens|json_encode|e('html_attr') }}'
      data-effects-defaults='{{ effectsDefaults|json_encode|e('html_attr') }}'
      data-effects-current='{{ effects|json_encode|e('html_attr') }}'
      data-effects-map='{{ effectsProfiles|json_encode|e('html_attr') }}'
      data-marketing-theme-map='{{ marketingSchemes|default({})|json_encode|e('html_attr') }}'
      data-namespace="{{ pageNamespace|e('html_attr') }}"
      data-read-only="{{ readOnly ? '1' : '0' }}"
      data-effects-read-only="{{ effectsReadOnly ? '1' : '0' }}"
      data-active-tab="{{ activeTab }}"
    >
      <div class="uk-container uk-container-large">
        <h1 class="uk-heading-bullet">Design – Namespace: {{ pageNamespace }}</h1>
        <p class="uk-text-lead uk-margin-remove">Erscheinungsbild für alle Seiten dieses Namespace</p>
        {% if designUsedDefaults|default(false) %}
          <p class="uk-text-meta uk-margin-small-top">
            No overrides defined – default values are used.
          </p>
        {% endif %}
      </div>
      <div class="uk-container uk-container-large">
        {% set activePageNamespace = pageNamespace|default('default') %}
        {% set pageNamespaceOptions = available_namespaces|default([]) %}
        {% include 'admin/partials/namespace_select.twig' %}

        {% if flash is defined and flash %}
          <div class="uk-alert-{{ flash.type == 'success' ? 'success' : 'danger' }} uk-margin-small" uk-alert>
            <p class="uk-margin-remove">{{ flash.message }}</p>
          </div>
        {% endif %}

        <ul class="uk-tab design-tab-nav" data-design-tabs>
          <li class="{{ activeTab == 'appearance' ? 'uk-active' : '' }}">
            <a href="#" data-design-tab="appearance">Erscheinungsbild</a>
          </li>
          {% if canAccessBehavior %}
            <li class="{{ activeTab == 'behavior' ? 'uk-active' : '' }}">
              <a href="#" data-design-tab="behavior">Verhalten</a>
            </li>
          {% endif %}
        </ul>
        {% if not canAccessBehavior %}
          <div class="uk-alert uk-alert-primary uk-margin-small">Verhalten wird auf Namespace-Ebene gesteuert.</div>
        {% endif %}

        <div class="uk-grid-match uk-grid-small" uk-grid>
          <div class="uk-width-1-1 uk-width-2-5@l">
            <div class="uk-card uk-card-default uk-card-body design-preview-card">
              <div class="uk-flex uk-flex-between uk-flex-middle">
                <div>
                  <h3 class="uk-card-title uk-margin-remove">Live Preview</h3>
                  <p class="uk-text-meta uk-margin-remove">Änderungen wirken sofort</p>
                </div>
                <div class="uk-button-group" data-theme-toggle>
                  <button type="button" class="uk-button uk-button-default" data-theme-choice="light" aria-pressed="false">Light</button>
                  <button type="button" class="uk-button uk-button-default" data-theme-choice="dark" aria-pressed="false">Dark</button>
                </div>
              </div>
              <div class="uk-margin-small-top uk-flex uk-flex-middle uk-flex-between">
                <div class="uk-button-group" data-device-toggle>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="desktop" aria-pressed="false">Desktop</button>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="tablet" aria-pressed="false">Tablet</button>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="mobile" aria-pressed="false">Mobile</button>
                </div>
                <div class="uk-text-meta">
                  <span class="uk-margin-small-right">Layout: <strong data-preview-meta="layout">{{ tokens.layout.profile }}</strong></span>
                  <span>Typo: <strong data-preview-meta="typography">{{ tokens.typography.preset }}</strong></span>
                </div>
              </div>
              <div
                id="design-preview"
                class="design-preview__viewport marketing-scope marketing-page"
                data-theme="light"
                data-device="desktop"
                data-namespace="{{ activePageNamespace|e('html_attr') }}"
                data-layout-profile="{{ tokens.layout.profile|e('html_attr') }}"
                data-card-style="{{ tokens.components.cardStyle|e('html_attr') }}"
                data-button-style="{{ tokens.components.buttonStyle|e('html_attr') }}"
                data-typography-preset="{{ tokens.typography.preset|e('html_attr') }}"
                data-effects-profile="{{ effects.effectsProfile|e('html_attr') }}"
                data-slider-profile="{{ effects.sliderProfile|e('html_attr') }}"
              >
                <div class="design-preview__surface">
                  <div class="design-preview__badge">{{ activePageNamespace }}</div>
                  <div class="design-preview__content">
                    <div class="design-preview__eyebrow">Marketing Page</div>
                    <h2 class="design-preview__headline">Gestaltete Überschrift</h2>
                    <p class="design-preview__copy">
                      Einheitliche Design-Tokens sorgen für konsistente Farben, Abstände und Komponenten in diesem Namespace.
                    </p>
                    <div class="design-preview__cta-group">
                      <button class="uk-button uk-button-primary design-preview__button">Primary Action</button>
                      <button class="uk-button uk-button-default design-preview__button-secondary">Secondary</button>
                    </div>
                    <div class="design-preview__cards">
                      <div class="design-preview__card">
                        <h4 class="uk-margin-small-bottom">Card Titel</h4>
                        <p class="uk-margin-remove">Gestaltete Karte mit {{ tokens.components.cardStyle }}-Kanten.</p>
                      </div>
                      <div class="design-preview__card">
                        <h4 class="uk-margin-small-bottom">Buttons</h4>
                        <p class="uk-margin-remove">Button-Stil: {{ tokens.components.buttonStyle }}</p>
                      </div>
                    </div>
                    <div class="design-preview__effects" data-preview-effects>
                      <div class="design-preview__effects-item">
                        <span class="design-preview__effects-pill">Verhalten</span>
                        <span class="design-preview__effects-value" data-preview-meta="effectsProfile">
                          {{ effectsProfiles[effects.effectsProfile].label|default(effects.effectsProfile) }}
                        </span>
                      </div>
                      <div class="design-preview__effects-item">
                        <span class="design-preview__effects-pill">Slider</span>
                        <span class="design-preview__effects-value" data-preview-meta="sliderProfile">{{ effects.sliderProfile }}</span>
                      </div>
                      <div class="design-preview__effects-item">
                        <span class="design-preview__effects-pill design-preview__effects-pill--muted">Scroll</span>
                        <span class="design-preview__effects-value">Abschnitte erscheinen beim Scrollen</span>
                      </div>
                    </div>
                    <footer class="design-preview__footer" aria-label="Footer Vorschau">
                      <div class="design-preview__footer-brand">
                        <strong class="design-preview__footer-name">QuizRace</strong>
                        <span class="design-preview__footer-tagline">Business Footer mit klaren Rollen und Links.</span>
                      </div>
                      <div class="design-preview__footer-columns">
                        <div class="design-preview__footer-column">
                          <span class="design-preview__footer-title">Unternehmen</span>
                          <ul class="design-preview__footer-list">
                            <li><a class="design-preview__footer-link" href="#">Über uns</a></li>
                            <li><a class="design-preview__footer-link" href="#">Leistungen</a></li>
                            <li><a class="design-preview__footer-link" href="#">Karriere</a></li>
                          </ul>
                        </div>
                        <div class="design-preview__footer-column">
                          <span class="design-preview__footer-title">Ressourcen</span>
                          <ul class="design-preview__footer-list">
                            <li><a class="design-preview__footer-link" href="#">Support</a></li>
                            <li><a class="design-preview__footer-link" href="#">FAQ</a></li>
                            <li><a class="design-preview__footer-link" href="#">Kontakt</a></li>
                          </ul>
                        </div>
                        <div class="design-preview__footer-column">
                          <span class="design-preview__footer-title">Rechtliches</span>
                          <ul class="design-preview__footer-list">
                            <li><a class="design-preview__footer-link" href="#">Impressum</a></li>
                            <li><a class="design-preview__footer-link" href="#">Datenschutz</a></li>
                            <li><a class="design-preview__footer-link" href="#">AGB</a></li>
                          </ul>
                        </div>
                      </div>
                      <div class="design-preview__footer-meta">
                        © 2025 QuizRace GmbH · Zertifiziert · ISO 27001
                      </div>
                    </footer>
                  </div>
                </div>
              </div>
            </div>
            {% if readOnly %}
              <div class="uk-card uk-card-default uk-card-body uk-margin-small">
                <h3 class="uk-card-title uk-margin-remove">Design-Übersicht</h3>
                <p class="uk-text-meta">Design wird auf Namespace-Ebene gesteuert</p>
                <dl class="design-summary">
                  <div class="design-summary__row">
                    <dt>Layout-Profil</dt>
                    <dd>{{ tokens.layout.profile }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Typografie</dt>
                    <dd>{{ tokens.typography.preset }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Kartendesign</dt>
                    <dd>{{ tokens.components.cardStyle }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Button-Stil</dt>
                    <dd>{{ tokens.components.buttonStyle }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Farben</dt>
                    <dd>
                      <span class="design-summary__swatch" style="background: {{ tokens.brand.primary }}"></span>
                      <code>{{ tokens.brand.primary }}</code>
                      <span class="design-summary__swatch design-summary__swatch--accent" style="background: {{ tokens.brand.accent }}"></span>
                      <code>{{ tokens.brand.accent }}</code>
                      <span class="design-summary__swatch design-summary__swatch--secondary" style="background: {{ tokens.brand.secondary }}"></span>
                      <code>{{ tokens.brand.secondary }}</code>
                    </dd>
                  </div>
                </dl>
              </div>
            {% endif %}
          </div>
          <div class="uk-width-1-1 uk-width-expand@l">
            <div class="design-panel" data-design-panel="appearance" {% if activeTab != 'appearance' %}hidden{% endif %}>
              {% if readOnly %}
                <div class="uk-alert uk-alert-primary uk-margin-small">Redakteur:innen haben nur Lesezugriff auf die Design-Vorgaben.</div>
              {% else %}
                <form class="uk-form-stacked" method="post" enctype="multipart/form-data">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                  <input type="hidden" name="namespace" value="{{ activePageNamespace|e('html_attr') }}">

                  <ul class="uk-accordion" uk-accordion>
                    <li class="uk-open">
                      <a class="uk-accordion-title" href="#">Brand</a>
                      <div class="uk-accordion-content">
                        <div class="uk-grid-small" uk-grid>
                          <div class="uk-width-1-3@s">
                            <label class="uk-form-label" for="brandPrimary">Primary Color</label>
                            <div class="uk-flex uk-flex-middle design-color-input">
                              <input id="brandPrimary" class="uk-input" type="color" name="brand[primary]" value="{{ tokens.brand.primary|e('html_attr') }}" data-token-input data-group="brand" data-key="primary">
                              <code class="uk-margin-small-left" data-token-preview="brand.primary">{{ tokens.brand.primary }}</code>
                            </div>
                          </div>
                          <div class="uk-width-1-3@s">
                            <label class="uk-form-label" for="brandAccent">Accent Color</label>
                            <div class="uk-flex uk-flex-middle design-color-input">
                              <input id="brandAccent" class="uk-input" type="color" name="brand[accent]" value="{{ tokens.brand.accent|e('html_attr') }}" data-token-input data-group="brand" data-key="accent">
                              <code class="uk-margin-small-left" data-token-preview="brand.accent">{{ tokens.brand.accent }}</code>
                            </div>
                          </div>
                          <div class="uk-width-1-3@s">
                            <label class="uk-form-label" for="brandSecondary">Secondary Color</label>
                            <div class="uk-flex uk-flex-middle design-color-input">
                              <input id="brandSecondary" class="uk-input" type="color" name="brand[secondary]" value="{{ tokens.brand.secondary|e('html_attr') }}" data-token-input data-group="brand" data-key="secondary">
                              <code class="uk-margin-small-left" data-token-preview="brand.secondary">{{ tokens.brand.secondary }}</code>
                            </div>
                          </div>
                        </div>
                        <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_brand">Panel zurücksetzen</button>
                      </div>
                    </li>
                    {% set marketingSchemeOptions = {
                      aurora: {
                        label: 'Aurora',
                        description: 'Frisches Blau mit klarem Akzent.'
                      },
                      sunset: {
                        label: 'Sunset',
                        description: 'Warme Orange-/Pink-Töne für starke CTAs.'
                      },
                      midnight: {
                        label: 'Midnight',
                        description: 'Dunkler Look mit kühlem Akzent.'
                      },
                      monochrome: {
                        label: 'Monochrom',
                        description: 'Schwarz/Weiß mit maximalem Kontrast.'
                      },
                      'uikit-default': {
                        label: 'UIkit Default',
                        description: 'Neutrale UIkit-Standardfarben als Basis.'
                      }
                    } %}
                    <li>
                      <a class="uk-accordion-title" href="#">Marketing-Palette</a>
                      <div class="uk-accordion-content">
                        <p class="uk-text-meta uk-margin-remove-top">
                          Presets setzen die Marketing-Tokens für Primär-, Akzent- und Surface-Farben sowie die Textfarben
                          für Light- und Dark-Modus.
                        </p>
                        <p class="uk-text-meta uk-margin-remove-top">
                          Achte auf ausreichenden Kontrast zwischen Text, Surface und Primärfarben – die Lesbarkeit sollte
                          mindestens WCAG AA erfüllen.
                        </p>
                        <label class="uk-form-label" for="marketingScheme">Preset auswählen</label>
                        <div class="uk-form-controls">
                          <select
                            id="marketingScheme"
                            class="uk-select"
                            name="appearance[variables][marketingScheme]"
                            data-marketing-scheme-select
                            data-current-marketing-scheme="{{ marketingScheme|default('')|e('html_attr') }}"
                          >
                            <option value="" {% if marketingScheme is empty %}selected{% endif %}>Automatisch (Brand-Tokens)</option>
                            {% for schemeKey, scheme in marketingSchemeOptions %}
                              <option
                                value="{{ schemeKey|e('html_attr') }}"
                                {% if schemeKey == marketingScheme %}selected{% endif %}
                              >
                                {{ scheme.label }} – {{ scheme.description }}
                              </option>
                            {% endfor %}
                          </select>
                        </div>
                        <div class="uk-text-meta uk-margin-small-top">
                          Die Auswahl wird als Marketing-Design im Namespace gespeichert.
                        </div>
                      </div>
                    </li>
                    <li>
                      <a class="uk-accordion-title" href="#">Lesbarkeit &amp; Kontrast</a>
                      <div class="uk-accordion-content">
                        <p class="uk-text-meta uk-margin-remove-top">
                          Prüfe, ob Textfarben auf Surface, Background und Primary mindestens WCAG AA (4,5:1) erreichen.
                          AAA (7:1) ist ideal für besonders gut lesbare Inhalte.
                        </p>
                        <div class="design-contrast" data-contrast-panel>
                          <div class="design-contrast__row" data-contrast-row="text-on-surface">
                            <div>
                              <div class="design-contrast__label">Text auf Surface</div>
                              <div class="design-contrast__meta">Prüft Haupttext auf Surface-Flächen.</div>
                            </div>
                            <div class="design-contrast__metrics">
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Light</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="light">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="light">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="light">AAA</span>
                                </div>
                              </div>
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Dark</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="dark">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="dark">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="dark">AAA</span>
                                </div>
                              </div>
                            </div>
                            <button type="button" class="uk-button uk-button-default uk-button-small" data-contrast-fix>Auto-Fix</button>
                          </div>
                          <div class="design-contrast__row" data-contrast-row="text-on-card">
                            <div>
                              <div class="design-contrast__label">Text auf Card</div>
                              <div class="design-contrast__meta">Vergleicht Card-Text mit Card-Background.</div>
                            </div>
                            <div class="design-contrast__metrics">
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Light</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="light">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="light">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="light">AAA</span>
                                </div>
                              </div>
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Dark</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="dark">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="dark">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="dark">AAA</span>
                                </div>
                              </div>
                            </div>
                            <button type="button" class="uk-button uk-button-default uk-button-small" data-contrast-fix>Auto-Fix</button>
                          </div>
                          <div class="design-contrast__row" data-contrast-row="text-on-background">
                            <div>
                              <div class="design-contrast__label">Text auf Background</div>
                              <div class="design-contrast__meta">Prüft Fließtext auf Seitenhintergrund.</div>
                            </div>
                            <div class="design-contrast__metrics">
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Light</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="light">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="light">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="light">AAA</span>
                                </div>
                              </div>
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Dark</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="dark">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="dark">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="dark">AAA</span>
                                </div>
                              </div>
                            </div>
                            <button type="button" class="uk-button uk-button-default uk-button-small" data-contrast-fix>Auto-Fix</button>
                          </div>
                          <div class="design-contrast__row" data-contrast-row="text-on-primary">
                            <div>
                              <div class="design-contrast__label">Text auf Primary</div>
                              <div class="design-contrast__meta">Prüft Kontrast für Buttons/CTAs.</div>
                            </div>
                            <div class="design-contrast__metrics">
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Light</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="light">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="light">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="light">AAA</span>
                                </div>
                              </div>
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Dark</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="dark">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="dark">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="dark">AAA</span>
                                </div>
                              </div>
                            </div>
                            <button type="button" class="uk-button uk-button-default uk-button-small" data-contrast-fix>Auto-Fix</button>
                          </div>
                          <div class="design-contrast__row" data-contrast-row="text-on-secondary">
                            <div>
                              <div class="design-contrast__label">Text auf Secondary</div>
                              <div class="design-contrast__meta">Prüft Kontrast für Secondary-Buttons.</div>
                            </div>
                            <div class="design-contrast__metrics">
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Light</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="light">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="light">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="light">AAA</span>
                                </div>
                              </div>
                              <div class="design-contrast__metric">
                                <div class="design-contrast__metric-label">Dark</div>
                                <div class="design-contrast__ratio" data-contrast-ratio="dark">–</div>
                                <div class="design-contrast__badges">
                                  <span class="design-contrast__badge" data-contrast-aa="dark">AA</span>
                                  <span class="design-contrast__badge" data-contrast-aaa="dark">AAA</span>
                                </div>
                              </div>
                            </div>
                            <button type="button" class="uk-button uk-button-default uk-button-small" data-contrast-fix>Auto-Fix</button>
                          </div>
                        </div>
                        {% set textOnSurfaceValue = appearanceColors.textOnSurface|default('') %}
                        {% set textOnBackgroundValue = appearanceColors.textOnBackground|default('') %}
                        {% set textOnPrimaryValue = appearanceColors.textOnPrimary|default('') %}
                        <input
                          type="hidden"
                          name="appearance[variables][textOnSurface]"
                          value="{{ textOnSurfaceValue|e('html_attr') }}"
                          data-contrast-input="text-on-surface"
                          {% if textOnSurfaceValue is empty %}disabled{% endif %}
                        >
                        <input
                          type="hidden"
                          name="appearance[variables][textOnBackground]"
                          value="{{ textOnBackgroundValue|e('html_attr') }}"
                          data-contrast-input="text-on-background"
                          {% if textOnBackgroundValue is empty %}disabled{% endif %}
                        >
                        <input
                          type="hidden"
                          name="appearance[variables][textOnPrimary]"
                          value="{{ textOnPrimaryValue|e('html_attr') }}"
                          data-contrast-input="text-on-primary"
                          {% if textOnPrimaryValue is empty %}disabled{% endif %}
                        >
                      </div>
                    </li>
                    <li>
                      <a class="uk-accordion-title" href="#">Layout</a>
                      <div class="uk-accordion-content">
                        <label class="uk-form-label" for="layoutProfile">Layout-Profil</label>
                        <div class="uk-form-controls">
                          <select id="layoutProfile" class="uk-select" name="layout[profile]" data-token-input data-group="layout" data-key="profile">
                            {% for option in layoutProfiles %}
                              <option value="{{ option }}" {% if option == tokens.layout.profile %}selected{% endif %}>{{ option|title }}</option>
                            {% endfor %}
                          </select>
                        </div>
                        <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_layout">Panel zurücksetzen</button>
                      </div>
                    </li>
                    <li>
                      <a class="uk-accordion-title" href="#">Typography</a>
                      <div class="uk-accordion-content">
                        <label class="uk-form-label" for="typographyPreset">Heading Style Preset</label>
                        <div class="uk-form-controls">
                          <select id="typographyPreset" class="uk-select" name="typography[preset]" data-token-input data-group="typography" data-key="preset">
                            {% for preset in typographyPresets %}
                              <option value="{{ preset }}" {% if preset == tokens.typography.preset %}selected{% endif %}>{{ preset|title }}</option>
                            {% endfor %}
                          </select>
                        </div>
                        <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_typography">Panel zurücksetzen</button>
                      </div>
                    </li>
                    <li>
                      <a class="uk-accordion-title" href="#">Components</a>
                      <div class="uk-accordion-content">
                        <div class="uk-grid-small" uk-grid>
                          <div class="uk-width-1-2@s">
                            <label class="uk-form-label" for="cardStyle">Card Shape</label>
                            <div class="uk-form-controls">
                              <select id="cardStyle" class="uk-select" name="components[cardStyle]" data-token-input data-group="components" data-key="cardStyle">
                                {% for style in cardStyles %}
                                  <option value="{{ style }}" {% if style == tokens.components.cardStyle %}selected{% endif %}>{{ style|title }}</option>
                                {% endfor %}
                              </select>
                            </div>
                          </div>
                          <div class="uk-width-1-2@s">
                            <label class="uk-form-label" for="buttonStyle">Button Style</label>
                            <div class="uk-form-controls">
                              <select id="buttonStyle" class="uk-select" name="components[buttonStyle]" data-token-input data-group="components" data-key="buttonStyle">
                                {% for style in buttonStyles %}
                                  <option value="{{ style }}" {% if style == tokens.components.buttonStyle %}selected{% endif %}>{{ style|title }}</option>
                                {% endfor %}
                              </select>
                            </div>
                          </div>
                        </div>
                        <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_components">Panel zurücksetzen</button>
                      </div>
                    </li>
                  </ul>

                  <div class="uk-margin-large-top uk-flex uk-flex-between uk-flex-middle design-actions">
                    <button class="uk-button uk-button-default" type="submit" name="action" value="reset_all">Auf Standard zurücksetzen</button>
                    <button class="uk-button uk-button-primary" type="submit">Speichern</button>
                  </div>
                </form>
              {% endif %}
            </div>

            <div class="design-panel" data-design-panel="behavior" {% if activeTab != 'behavior' %}hidden{% endif %}>
              <div class="uk-card uk-card-default uk-card-body">
                <h2><span>Verhalten – Namespace: {{ pageNamespace }}</span></h2>
                <p class="uk-text-meta uk-margin-remove">Wie sich Seiten in diesem Namespace bewegen und anfühlen.</p>
                {% if not canAccessBehavior %}
                  <div class="uk-alert uk-alert-primary uk-margin-small">Verhalten wird auf Namespace-Ebene gesteuert.</div>
                {% elseif effectsReadOnly %}
                  <div class="uk-alert uk-alert-primary uk-margin-small">Redakteur:innen haben nur Lesezugriff auf die Effekt-Vorgaben.</div>
                {% endif %}

                {% if canAccessBehavior %}
                  <form class="uk-form-stacked" method="post">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <input type="hidden" name="namespace" value="{{ activePageNamespace|e('html_attr') }}">
                    <input type="hidden" name="action" value="save_effects">

                    <div class="design-effects-section">
                      <div class="design-effects-section__header">
                        <h3 class="uk-heading-bullet uk-margin-remove">Bewegungsprofil</h3>
                        <p class="uk-text-meta uk-margin-remove">Über Profile gesteuerte Effekte – kein Freitext.</p>
                      </div>
                      <div class="design-effects-options">
                        {% for profileKey, profile in effectsProfiles %}
                          <label class="design-effects-option">
                            <input
                              class="uk-radio"
                              type="radio"
                              name="effects_profile"
                              value="{{ profileKey|e('html_attr') }}"
                              data-effects-input="effectsProfile"
                              {% if profileKey == effects.effectsProfile %}checked{% endif %}
                              {% if effectsReadOnly %}disabled{% endif %}
                            >
                            <div>
                              <div class="design-effects-option__label">{{ profile.label }}</div>
                              <div class="design-effects-option__description">{{ profile.description }}</div>
                            </div>
                          </label>
                        {% endfor %}
                      </div>
                    </div>

                    <div class="design-effects-section">
                      <div class="design-effects-section__header">
                        <h3 class="uk-heading-bullet uk-margin-remove">Scroll-Effekte</h3>
                        <p class="uk-text-meta uk-margin-remove">Abgeleitet vom Bewegungsprofil.</p>
                      </div>
                      <div class="design-effects-detail">
                        <div class="design-effects-detail__row">
                          <span class="design-effects-detail__icon" aria-hidden="true">✓</span>
                          <div>
                            <div class="design-effects-detail__title">Abschnitte erscheinen beim Scrollen</div>
                            <div class="design-effects-detail__meta">Gilt global für alle Seiten</div>
                          </div>
                        </div>
                      </div>
                    </div>

                    {% set sliderSuggestionMap = {
                      'calserver.professional': 'static',
                      'quizrace.calm': 'calm',
                      'quizrace.marketing': 'marketing'
                    } %}
                    {% set suggestedSliderProfile = sliderSuggestionMap[effects.effectsProfile]|default(effectsDefaults.sliderProfile) %}
                    {% set activeSliderProfile = effects.sliderProfile|default(suggestedSliderProfile) %}
                    {% set autoSliderValue = activeSliderProfile == 'static' ? suggestedSliderProfile : activeSliderProfile %}
                    {% if hasSliderBlocks %}
                      <div class="design-effects-section">
                        <div class="design-effects-section__header">
                          <h3 class="uk-heading-bullet uk-margin-remove">Slider-Verhalten</h3>
                          <p class="uk-text-meta uk-margin-remove">Gilt für alle Slider-fähigen Blöcke.</p>
                        </div>
                        <div class="design-effects-options">
                          <label class="design-effects-option">
                            <input
                              class="uk-radio"
                              type="radio"
                              name="slider_profile"
                              value="static"
                              data-effects-input="sliderProfile"
                              {% if activeSliderProfile == 'static' %}checked{% endif %}
                              {% if effectsReadOnly %}disabled{% endif %}
                            >
                            <div>
                              <div class="design-effects-option__label">Statisch</div>
                              <div class="design-effects-option__description">Keine automatische Rotation.</div>
                            </div>
                          </label>
                          <label class="design-effects-option">
                            <input
                              class="uk-radio"
                              type="radio"
                              name="slider_profile"
                              value="{{ autoSliderValue|e('html_attr') }}"
                              data-effects-input="sliderProfile"
                              data-slider-auto="true"
                              {% if activeSliderProfile != 'static' %}checked{% endif %}
                              {% if effectsReadOnly %}disabled{% endif %}
                            >
                            <div>
                              <div class="design-effects-option__label">Automatisch wechseln</div>
                              <div class="design-effects-option__description">ca. alle 5 Sekunden, pausiert bei Hover</div>
                            </div>
                          </label>
                        </div>
                      </div>
                    {% endif %}

                    <div class="design-effects-section">
                      <div class="design-effects-section__header">
                        <h3 class="uk-heading-bullet uk-margin-remove">Barrierefreiheit</h3>
                        <p class="uk-text-meta uk-margin-remove">Immer aktiv, nicht editierbar.</p>
                      </div>
                      <div class="design-effects-detail">
                        <div class="design-effects-detail__row">
                          <span class="design-effects-detail__icon" aria-hidden="true">✓</span>
                          <div>
                            <div class="design-effects-detail__title">Systemeinstellung „Bewegung reduzieren“ wird respektiert</div>
                            <div class="design-effects-detail__meta">Effekte werden bei Bedarf automatisch deaktiviert</div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="uk-margin-large-top uk-flex uk-flex-between uk-flex-middle design-actions">
                      <div class="uk-text-meta">Änderungen gelten für alle Seiten des Namespace.</div>
                      <button class="uk-button uk-button-primary" type="submit">Verhalten speichern</button>
                    </div>
                  </form>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
{% endblock %}
