{% extends 'layout.twig' %}

{% block config_color_styles %}{% endblock %}

{% block title %}Design – Namespace: {{ pageNamespace|default('') }}{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css" media="(prefers-color-scheme: dark)">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/admin-design.css">
  <script src="{{ basePath }}/js/admin-design.js" defer></script>
{% endblock %}

{% block body_class %}uk-background-muted uk-padding admin-page{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}
    {% block left %}
      <button
        id="sidebarToggle"
        type="button"
        class="uk-navbar-toggle uk-visible@m uk-margin-small-right git-btn"
        aria-controls="adminSidebar"
        aria-expanded="true"
        aria-pressed="false"
        aria-label="{{ t('menu') }}"
      >
        <span uk-navbar-toggle-icon></span>
      </button>
      <a href="{{ basePath }}/admin/dashboard" class="uk-navbar-item uk-logo uk-margin-small-left uk-visible@s">
        QuizRace Admin
      </a>
    {% endblock %}
    {% block center %}
      {% include 'admin/components/namespace_breadcrumb.twig' %}
    {% endblock %}
    {% block offcanvas %}
      <div id="qr-offcanvas" uk-offcanvas="overlay: true">
        <div class="uk-offcanvas-bar">
          <button class="uk-offcanvas-close" type="button" uk-close aria-label="{{ t('menu') }}"></button>
          <h3 class="uk-margin-small">QuizRace</h3>
          {% include 'admin/_nav.twig' %}
        </div>
      </div>
    {% endblock %}
  {% endembed %}

  <div class="uk-grid-collapse" uk-grid>
    <aside id="adminSidebar" class="uk-width-1-4@m uk-width-1-5@l uk-visible@m qr-sidebar">
      <div class="uk-card qr-card uk-card-body qr-sidebar-card">
        {% include 'admin/_nav.twig' %}
      </div>
    </aside>
    <main class="uk-width-expand uk-padding-small@xs uk-padding" id="design-editor"
      data-default-tokens='{{ tokenDefaults|json_encode|e('html_attr') }}'
      data-current-tokens='{{ tokens|json_encode|e('html_attr') }}'
      data-namespace="{{ pageNamespace|e('html_attr') }}"
      data-read-only="{{ readOnly ? '1' : '0' }}"
    >
      <div class="uk-container uk-container-large">
        <h1 class="uk-heading-bullet">Design – Namespace: {{ pageNamespace }}</h1>
        <p class="uk-text-lead uk-margin-remove">Erscheinungsbild für alle Seiten dieses Namespace</p>
      </div>
      <div class="uk-container uk-container-large">
        {% set activePageNamespace = pageNamespace|default('default') %}
        {% set pageNamespaceOptions = available_namespaces|default([]) %}
        {% if pageNamespaceOptions is empty %}
          {% set pageNamespaceOptions = [{
            namespace: activePageNamespace,
            label: null,
            is_active: true
          }] %}
        {% endif %}
        <div class="uk-card uk-card-default uk-card-body uk-margin-small">
          <div class="uk-grid-small uk-flex-middle" uk-grid>
            <div class="uk-width-1-1 uk-width-expand@m">
              <label class="uk-form-label" for="pageNamespaceSelect">{{ t('label_project_namespace') }}</label>
              <div class="uk-form-controls">
                <select
                  id="pageNamespaceSelect"
                  class="uk-select"
                  data-page-namespace="{{ activePageNamespace|e('html_attr') }}"
                >
                  {% for entry in pageNamespaceOptions %}
                    {% set entryNamespace = entry.namespace|default('') %}
                    {% set entryLabel = entry.label|default('') %}
                    {% set entryIsInactive = entry.is_active is defined and not entry.is_active %}
                    <option
                      value="{{ entryNamespace|e('html_attr') }}"
                      {% if entryNamespace == activePageNamespace %}selected{% endif %}
                    >
                      {{ entryNamespace }}
                      {% if entryLabel is not empty %} – {{ entryLabel }}{% endif %}
                      {% if entryIsInactive %} – inaktiv{% endif %}
                    </option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="uk-width-auto uk-text-meta uk-margin-small-top uk-margin-remove-top@m">
              Wechsel lädt die Inhalte des ausgewählten Namespace neu.
            </div>
          </div>
        </div>

        {% if flash is defined and flash %}
          <div class="uk-alert-{{ flash.type == 'success' ? 'success' : 'danger' }} uk-margin-small" uk-alert>
            <p class="uk-margin-remove">{{ flash.message }}</p>
          </div>
        {% endif %}

        <div class="uk-grid-match uk-grid-small" uk-grid>
          <div class="uk-width-1-1 uk-width-2-5@l">
            <div class="uk-card uk-card-default uk-card-body design-preview-card">
              <div class="uk-flex uk-flex-between uk-flex-middle">
                <div>
                  <h3 class="uk-card-title uk-margin-remove">Live Preview</h3>
                  <p class="uk-text-meta uk-margin-remove">Änderungen wirken sofort</p>
                </div>
                <div class="uk-button-group" data-theme-toggle>
                  <button type="button" class="uk-button uk-button-default" data-theme-choice="light" aria-pressed="false">Light</button>
                  <button type="button" class="uk-button uk-button-default" data-theme-choice="dark" aria-pressed="false">Dark</button>
                </div>
              </div>
              <div class="uk-margin-small-top uk-flex uk-flex-middle uk-flex-between">
                <div class="uk-button-group" data-device-toggle>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="desktop" aria-pressed="false">Desktop</button>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="tablet" aria-pressed="false">Tablet</button>
                  <button type="button" class="uk-button uk-button-default" data-device-choice="mobile" aria-pressed="false">Mobile</button>
                </div>
                <div class="uk-text-meta">
                  <span class="uk-margin-small-right">Layout: <strong data-preview-meta="layout">{{ tokens.layout.profile }}</strong></span>
                  <span>Typo: <strong data-preview-meta="typography">{{ tokens.typography.preset }}</strong></span>
                </div>
              </div>
              <div
                id="design-preview"
                class="design-preview__viewport"
                data-theme="light"
                data-device="desktop"
                data-namespace="{{ activePageNamespace|e('html_attr') }}"
                data-layout-profile="{{ tokens.layout.profile|e('html_attr') }}"
                data-card-style="{{ tokens.components.cardStyle|e('html_attr') }}"
                data-button-style="{{ tokens.components.buttonStyle|e('html_attr') }}"
                data-typography-preset="{{ tokens.typography.preset|e('html_attr') }}"
              >
                <div class="design-preview__surface">
                  <div class="design-preview__badge">{{ activePageNamespace }}</div>
                  <div class="design-preview__content">
                    <div class="design-preview__eyebrow">Marketing Page</div>
                    <h2 class="design-preview__headline">Gestaltete Überschrift</h2>
                    <p class="design-preview__copy">
                      Einheitliche Design-Tokens sorgen für konsistente Farben, Abstände und Komponenten in diesem Namespace.
                    </p>
                    <div class="design-preview__cta-group">
                      <button class="uk-button uk-button-primary design-preview__button">Primary Action</button>
                      <button class="uk-button uk-button-default design-preview__button-secondary">Secondary</button>
                    </div>
                    <div class="design-preview__cards">
                      <div class="design-preview__card">
                        <h4 class="uk-margin-small-bottom">Card Titel</h4>
                        <p class="uk-margin-remove">Gestaltete Karte mit {{ tokens.components.cardStyle }}-Kanten.</p>
                      </div>
                      <div class="design-preview__card">
                        <h4 class="uk-margin-small-bottom">Buttons</h4>
                        <p class="uk-margin-remove">Button-Stil: {{ tokens.components.buttonStyle }}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% if readOnly %}
              <div class="uk-card uk-card-default uk-card-body uk-margin-small">
                <h3 class="uk-card-title uk-margin-remove">Design-Übersicht</h3>
                <p class="uk-text-meta">Design wird auf Namespace-Ebene gesteuert</p>
                <dl class="design-summary">
                  <div class="design-summary__row">
                    <dt>Layout-Profil</dt>
                    <dd>{{ tokens.layout.profile }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Typografie</dt>
                    <dd>{{ tokens.typography.preset }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Kartendesign</dt>
                    <dd>{{ tokens.components.cardStyle }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Button-Stil</dt>
                    <dd>{{ tokens.components.buttonStyle }}</dd>
                  </div>
                  <div class="design-summary__row">
                    <dt>Farben</dt>
                    <dd>
                      <span class="design-summary__swatch" style="background: {{ tokens.brand.primary }}"></span>
                      <code>{{ tokens.brand.primary }}</code>
                      <span class="design-summary__swatch design-summary__swatch--accent" style="background: {{ tokens.brand.accent }}"></span>
                      <code>{{ tokens.brand.accent }}</code>
                    </dd>
                  </div>
                </dl>
              </div>
            {% endif %}
          </div>
          <div class="uk-width-1-1 uk-width-expand@l">
            {% if readOnly %}
              <div class="uk-alert uk-alert-primary uk-margin-small">Redakteur:innen haben nur Lesezugriff auf die Design-Vorgaben.</div>
            {% else %}
              <form class="uk-form-stacked" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="namespace" value="{{ activePageNamespace|e('html_attr') }}">

                <ul class="uk-accordion" uk-accordion>
                  <li class="uk-open">
                    <a class="uk-accordion-title" href="#">Brand</a>
                    <div class="uk-accordion-content">
                      <div class="uk-grid-small" uk-grid>
                        <div class="uk-width-1-2@s">
                          <label class="uk-form-label" for="brandPrimary">Primary Color</label>
                          <div class="uk-flex uk-flex-middle design-color-input">
                            <input id="brandPrimary" class="uk-input" type="color" name="brand[primary]" value="{{ tokens.brand.primary|e('html_attr') }}" data-token-input data-group="brand" data-key="primary">
                            <code class="uk-margin-small-left" data-token-preview="brand.primary">{{ tokens.brand.primary }}</code>
                          </div>
                        </div>
                        <div class="uk-width-1-2@s">
                          <label class="uk-form-label" for="brandAccent">Accent Color</label>
                          <div class="uk-flex uk-flex-middle design-color-input">
                            <input id="brandAccent" class="uk-input" type="color" name="brand[accent]" value="{{ tokens.brand.accent|e('html_attr') }}" data-token-input data-group="brand" data-key="accent">
                            <code class="uk-margin-small-left" data-token-preview="brand.accent">{{ tokens.brand.accent }}</code>
                          </div>
                        </div>
                      </div>
                      <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_brand">Panel zurücksetzen</button>
                    </div>
                  </li>
                  <li>
                    <a class="uk-accordion-title" href="#">Layout</a>
                    <div class="uk-accordion-content">
                      <label class="uk-form-label" for="layoutProfile">Layout-Profil</label>
                      <div class="uk-form-controls">
                        <select id="layoutProfile" class="uk-select" name="layout[profile]" data-token-input data-group="layout" data-key="profile">
                          {% for option in layoutProfiles %}
                            <option value="{{ option }}" {% if option == tokens.layout.profile %}selected{% endif %}>{{ option|title }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_layout">Panel zurücksetzen</button>
                    </div>
                  </li>
                  <li>
                    <a class="uk-accordion-title" href="#">Typography</a>
                    <div class="uk-accordion-content">
                      <label class="uk-form-label" for="typographyPreset">Heading Style Preset</label>
                      <div class="uk-form-controls">
                        <select id="typographyPreset" class="uk-select" name="typography[preset]" data-token-input data-group="typography" data-key="preset">
                          {% for preset in typographyPresets %}
                            <option value="{{ preset }}" {% if preset == tokens.typography.preset %}selected{% endif %}>{{ preset|title }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_typography">Panel zurücksetzen</button>
                    </div>
                  </li>
                  <li>
                    <a class="uk-accordion-title" href="#">Components</a>
                    <div class="uk-accordion-content">
                      <div class="uk-grid-small" uk-grid>
                        <div class="uk-width-1-2@s">
                          <label class="uk-form-label" for="cardStyle">Card Shape</label>
                          <div class="uk-form-controls">
                            <select id="cardStyle" class="uk-select" name="components[cardStyle]" data-token-input data-group="components" data-key="cardStyle">
                              {% for style in cardStyles %}
                                <option value="{{ style }}" {% if style == tokens.components.cardStyle %}selected{% endif %}>{{ style|title }}</option>
                              {% endfor %}
                            </select>
                          </div>
                        </div>
                        <div class="uk-width-1-2@s">
                          <label class="uk-form-label" for="buttonStyle">Button Style</label>
                          <div class="uk-form-controls">
                            <select id="buttonStyle" class="uk-select" name="components[buttonStyle]" data-token-input data-group="components" data-key="buttonStyle">
                              {% for style in buttonStyles %}
                                <option value="{{ style }}" {% if style == tokens.components.buttonStyle %}selected{% endif %}>{{ style|title }}</option>
                              {% endfor %}
                            </select>
                          </div>
                        </div>
                      </div>
                      <button class="uk-button uk-button-default uk-margin-small-top" type="submit" name="action" value="reset_components">Panel zurücksetzen</button>
                    </div>
                  </li>
                </ul>

                <div class="uk-margin-large-top uk-flex uk-flex-between uk-flex-middle design-actions">
                  <button class="uk-button uk-button-default" type="submit" name="action" value="reset_all">Auf Standard zurücksetzen</button>
                  <button class="uk-button uk-button-primary" type="submit">Speichern</button>
                </div>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    </main>
  </div>
{% endblock %}
