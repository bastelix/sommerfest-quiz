{# Media management tab content #}
{% set limits = mediaLimits|default({}) %}
{% set allowedExtensions = limits.allowedExtensions|default([]) %}
{% set acceptValue = allowedExtensions ? '.' ~ allowedExtensions|join(',.') : '' %}
{% set sizeMb = (limits.maxSize|default(0) / 1048576)|number_format(1, '.', '') %}
{% set limitText = t('text_media_limits')|format(sizeMb, allowedExtensions|join(', ')) %}
{% set landingSlugs = mediaLandingSlugs|default([]) %}
{% set mediaScope = mediaScope|default('project') %}
{% set mediaNamespace = mediaNamespace|default(pageNamespace|default('')) %}
{% set landingTitleCounts = {} %}
{% for landing in landingSlugs %}
  {% set titleKey = landing.title|default(landing.slug)|default('') %}
  {% if titleKey is not empty %}
    {% set landingTitleCounts = landingTitleCounts|merge({ (titleKey): landingTitleCounts[titleKey]|default(0) + 1 }) %}
  {% endif %}
{% endfor %}
{% set translations = {
  'renamePrompt': t('prompt_media_rename'),
  'deleteConfirm': t('confirm_media_delete'),
  'uploaded': t('message_media_uploaded'),
  'replaced': t('message_media_replaced'),
  'converted': t('message_media_converted'),
  'renamed': t('message_media_renamed'),
  'deleted': t('message_media_deleted'),
  'requestFailed': t('error_media_request_failed'),
  'noFiles': t('text_media_no_files'),
  'download': t('action_download'),
  'replace': t('button_media_replace'),
  'rename': t('button_media_rename'),
  'delete': t('button_media_delete'),
  'preview': t('label_media_preview'),
  'selectPreview': t('text_media_select_preview'),
  'noPreview': t('text_media_no_preview'),
  'sizeLabel': t('column_media_size'),
  'modifiedLabel': t('column_media_modified'),
  'nameLabel': t('column_media_name'),
  'selectedLabel': t('label_media_selected'),
  'uploading': t('status_media_uploading'),
  'metadataSaved': t('message_media_metadata_saved'),
  'addTag': t('button_media_add_tag'),
  'clearFolder': t('button_media_clear_folder'),
  'saveFolder': t('button_media_save_folder'),
  'noTags': t('text_media_no_tags'),
  'filterTags': t('label_media_filter_tags'),
  'filterFolder': t('label_media_filter_folder'),
  'allFolders': t('option_media_all_folders'),
  'noFolder': t('option_media_no_folder'),
  'clearFilters': t('button_media_clear_filters'),
  'copyUrl': t('button_media_copy_url'),
  'copyUrlSuccess': t('message_media_url_copied'),
  'copyUrlFallback': t('message_media_url_copy_fallback'),
  'copyUrlError': t('error_media_url_copy_failed'),
  'convert': t('button_media_convert'),
  'landingFilter': t('label_media_filter_landing'),
  'landingAll': t('option_media_all_landings'),
  'landingMissingHeading': t('heading_media_landing_missing'),
  'landingMissingEmpty': t('text_media_landing_missing'),
  'landingPrefill': t('button_media_landing_prefill'),
  'landingOpenPdf': t('button_media_landing_open_pdf'),
  'landingUsage': t('label_media_landing_references'),
  'landingPreview': t('label_media_landing_preview'),
  'landingMarkup': t('tooltip_media_landing_markup'),
  'landingSeo': t('tooltip_media_landing_seo'),
} %}

<div class="media-tab" data-media-section>
  <h2 class="uk-heading-bullet">{{ t('heading_media') }}</h2>
  <p
    class="uk-text-meta"
    data-media-limit
    data-template="{{ t('text_media_limits')|e('html_attr') }}"
  >
    {{ limitText }}
  </p>
  <div
    class="uk-grid-large media-grid"
    uk-grid
    data-media-root
    data-limits="{{ limits|json_encode|e('html_attr') }}"
    data-translations="{{ translations|json_encode|e('html_attr') }}"
    data-landing-slugs="{{ landingSlugs|json_encode|e('html_attr') }}"
    data-media-scope="{{ mediaScope|e('html_attr') }}"
    data-media-namespace="{{ mediaNamespace|e('html_attr') }}"
  >
    <div class="uk-width-1-1 uk-width-2-3@l media-column">
      <div class="uk-card uk-card-default uk-card-small uk-margin media-controls-card">
        <div class="uk-card-header uk-padding-small">
          <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid>
            <div class="uk-width-1-1 uk-width-expand@m" data-media-landing-filter>
              <label class="uk-form-label" for="mediaLanding">{{ t('label_media_filter_landing') }}</label>
              <select
                id="mediaLanding"
                class="uk-select uk-form-small"
                data-media-landing
                aria-label="{{ t('label_media_filter_landing') }}"
              >
                <option value="">{{ t('option_media_all_landings') }}</option>
                {% for landing in landingSlugs %}
                  {% set baseTitle = landing.title|default(landing.slug)|default('') %}
                  {% set showSlug = landingTitleCounts[baseTitle]|default(0) > 1 %}
                  {% set optionLabel = showSlug ? baseTitle ~ ' (' ~ landing.slug|default('') ~ ')' : baseTitle %}
                  <option value="{{ landing.slug|e }}">{{ optionLabel|e }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="uk-width-1-1 uk-width-expand@m">
              <label class="uk-form-label" for="mediaSearch">{{ t('label_media_search') }}</label>
              <div class="uk-inline uk-width-1-1">
                <span class="uk-form-icon" uk-icon="icon: search" aria-hidden="true"></span>
                <input
                  id="mediaSearch"
                  class="uk-input uk-form-small"
                  type="search"
                  placeholder="{{ t('label_media_search') }}"
                  aria-label="{{ t('label_media_search') }}"
                  data-media-search
                >
              </div>
            </div>
            <div class="uk-width-1-1 uk-width-auto@m uk-flex uk-flex-right@m uk-flex-bottom media-refresh-container">
              <button type="button" class="uk-button uk-button-default uk-button-small uk-width-1-1 uk-width-auto@m" data-media-refresh>
                <span class="uk-margin-small-right" uk-icon="refresh" aria-hidden="true"></span>
                {{ t('button_media_refresh') }}
              </button>
            </div>
          </div>
        </div>
        <div class="uk-card-body uk-padding-small">
          <div class="uk-grid-small uk-grid-row-small uk-grid-divider uk-grid" uk-grid>
            <div class="uk-width-1-1">
              <label class="uk-form-label" for="mediaTagFilter">{{ t('label_media_filter_tags') }}</label>
              <div
                id="mediaTagFilter"
                class="media-filter-tags uk-margin-small-top"
                data-media-filter-tags
                aria-live="polite"
              ></div>
            </div>
            <div class="uk-width-1-1">
              <label class="uk-form-label" for="mediaFolderFilter">{{ t('label_media_filter_folder') }}</label>
              <div class="uk-grid-small uk-flex-middle uk-grid" uk-grid>
                <div class="uk-width-expand">
                  <select
                    id="mediaFolderFilter"
                    class="uk-select uk-form-small"
                    data-media-filter-folder
                    aria-label="{{ t('label_media_filter_folder') }}"
                  >
                    <option value="">{{ t('option_media_all_folders') }}</option>
                  </select>
                </div>
                <div class="uk-width-auto">
                  <button type="button" class="uk-button uk-button-default uk-button-small" data-media-clear-filters>
                    {{ t('button_media_clear_filters') }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="uk-card-footer uk-padding-small">
        </div>
      </div>

      <div
        class="uk-tile uk-tile-default uk-padding media-dropzone"
        data-media-dropzone
        role="button"
        tabindex="0"
        aria-describedby="mediaDropDescription"
      >
        <div class="media-dropzone-inner">
          <p id="mediaDropDescription" class="uk-text-center uk-margin-remove">
            {{ t('label_drag_file') }}
            <button type="button" class="uk-button uk-button-text" data-media-choose>{{ t('action_select') }}</button>
          </p>
          <input
            class="uk-hidden"
            type="file"
            data-media-file
            {% if acceptValue %}accept="{{ acceptValue }}"{% endif %}
          >
        </div>
      </div>

      <form class="uk-form-stacked uk-margin media-upload-form" data-media-form novalidate>
        <div class="uk-margin-small">
          <label class="uk-form-label" for="mediaName">{{ t('label_media_name_optional') }}</label>
          <input
            id="mediaName"
            class="uk-input"
            type="text"
            placeholder="{{ t('label_media_name_placeholder') }}"
            data-media-name
          >
        </div>
        <div class="uk-margin-small">
          <label class="uk-form-label" for="mediaUploadTags">{{ t('label_media_tags_optional') }}</label>
          <input
            id="mediaUploadTags"
            class="uk-input"
            type="text"
            placeholder="{{ t('label_media_tags_placeholder') }}"
            data-media-upload-tags
          >
          <div class="uk-text-meta">{{ t('help_media_tags') }}</div>
        </div>
        <div class="uk-margin-small">
          <label class="uk-form-label" for="mediaUploadFolder">{{ t('label_media_folder_optional') }}</label>
          <input
            id="mediaUploadFolder"
            class="uk-input"
            type="text"
            placeholder="{{ t('label_media_folder_placeholder') }}"
            data-media-upload-folder
          >
          <div class="uk-text-meta">{{ t('help_media_folder') }}</div>
        </div>
        <div class="uk-margin-small">
          <span class="uk-text-meta" data-media-selected hidden></span>
        </div>
        <div class="uk-margin-small">
          <progress class="uk-progress" value="0" max="100" hidden data-media-progress></progress>
          <div class="uk-text-meta" data-media-upload-status aria-live="polite"></div>
        </div>
        <div class="uk-margin-small uk-text-right">
          <button type="submit" class="uk-button uk-button-primary" data-media-submit disabled>
            {{ t('button_media_upload') }}
          </button>
        </div>
      </form>

      <div class="uk-card uk-card-default uk-card-body uk-margin media-table-card">
        <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
          <h3 class="uk-card-title uk-margin-remove">{{ t('heading_media_files') }}</h3>
          <div class="uk-text-meta" data-media-pagination aria-live="polite">1 / 1</div>
        </div>
        <div class="uk-overflow-auto">
          <table class="uk-table uk-table-divider uk-table-small uk-table-hover media-table" data-media-table>
            <thead>
              <tr>
                <th scope="col">{{ t('column_media_name') }}</th>
                <th scope="col" class="uk-table-shrink">{{ t('column_media_size') }}</th>
                <th scope="col" class="uk-table-shrink">{{ t('column_media_modified') }}</th>
                <th scope="col" class="uk-table-shrink">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody data-media-table-body></tbody>
          </table>
        </div>
        <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-top">
          <button type="button" class="uk-button uk-button-default uk-button-small" data-media-prev>
            « {{ t('button_media_prev') }}
          </button>
          <button type="button" class="uk-button uk-button-default uk-button-small" data-media-next>
            {{ t('button_media_next') }} »
          </button>
        </div>
        <p class="uk-text-meta uk-margin-small-top" data-media-empty hidden aria-live="polite">
          {{ t('text_media_no_files') }}
        </p>
        <div class="uk-alert uk-alert-danger uk-margin-small-top" role="alert" data-media-error hidden></div>
      </div>

      <div
        class="uk-card uk-card-default uk-card-small uk-card-body uk-margin media-missing-card"
        data-media-landing-missing-card
        hidden
      >
        <h3 class="uk-card-title uk-margin-remove">{{ t('heading_media_landing_missing') }}</h3>
        <p class="uk-text-meta uk-margin-small-bottom" data-media-landing-missing-empty>
          {{ t('text_media_landing_missing') }}
        </p>
        <ul class="uk-list uk-list-divider" data-media-landing-missing></ul>
      </div>
    </div>

    <div class="uk-width-1-1 uk-width-1-3@l">
      <div class="uk-card uk-card-default uk-card-small uk-card-body media-preview-card">
        <h3 class="uk-card-title uk-margin-remove">{{ t('label_media_preview') }}</h3>
        <div class="media-preview-frame">
          <img src="" alt="{{ t('label_media_preview') }}" data-media-preview-image hidden>
          <div class="media-preview-placeholder" data-media-preview-placeholder>
            {{ t('text_media_select_preview') }}
          </div>
        </div>
        <dl class="uk-description-list uk-margin-small-top media-preview-list" data-media-preview-meta hidden>
          <div>
            <dt>{{ t('column_media_name') }}</dt>
            <dd data-media-preview-name></dd>
          </div>
          <div>
            <dt>{{ t('column_media_size') }}</dt>
            <dd data-media-preview-size></dd>
          </div>
          <div>
            <dt>{{ t('column_media_modified') }}</dt>
            <dd data-media-preview-modified></dd>
          </div>
        </dl>
        <div class="uk-margin-small-top" data-media-preview-url hidden>
          <label class="uk-form-label uk-margin-small-bottom" for="mediaPreviewUrl">{{ t('label_media_file_url') }}</label>
          <div class="uk-flex uk-flex-middle uk-grid-small" uk-grid>
            <div class="uk-width-expand">
              <input
                id="mediaPreviewUrl"
                class="uk-input uk-form-small"
                type="text"
                readonly
                data-media-preview-url-input
                aria-describedby="mediaPreviewUrlHelp"
              >
            </div>
            <div class="uk-width-auto">
              <button
                type="button"
                class="uk-button uk-button-default uk-button-small"
                data-media-preview-copy
                uk-tooltip
                title="{{ t('tooltip_media_copy_url') }}"
                aria-label="{{ t('aria_media_copy_url') }}"
              >
                {{ t('button_media_copy_url') }}
              </button>
            </div>
          </div>
          <div id="mediaPreviewUrlHelp" class="uk-text-meta">{{ t('help_media_copy_url') }}</div>
        </div>
        <div class="media-metadata-editor uk-margin-top" data-media-metadata hidden>
          <h4 class="uk-heading-bullet">{{ t('label_media_file_tags') }}</h4>
          <div class="media-tag-list" data-media-meta-tags aria-live="polite"></div>
          <div class="uk-flex uk-flex-middle uk-grid-small uk-margin-small-top" uk-grid>
            <div class="uk-width-expand">
              <input
                type="text"
                class="uk-input uk-form-small"
                placeholder="{{ t('label_media_tags_placeholder') }}"
                data-media-meta-tag-input
              >
            </div>
            <div class="uk-width-auto">
              <button type="button" class="uk-button uk-button-default uk-button-small" data-media-meta-add-tag>
                {{ t('button_media_add_tag') }}
              </button>
            </div>
          </div>
          <div class="uk-text-meta uk-margin-small-top">{{ t('help_media_tag_editor') }}</div>
          <hr class="uk-divider-icon">
          <label class="uk-form-label" for="mediaMetaFolder">{{ t('label_media_file_folder') }}</label>
          <div class="uk-flex uk-flex-middle uk-grid-small" uk-grid>
            <div class="uk-width-expand">
              <input
                id="mediaMetaFolder"
                type="text"
                class="uk-input uk-form-small"
                placeholder="{{ t('label_media_folder_placeholder') }}"
                data-media-meta-folder
              >
            </div>
            <div class="uk-width-auto">
              <button type="button" class="uk-button uk-button-default uk-button-small" data-media-meta-save-folder>
                {{ t('button_media_save_folder') }}
              </button>
            </div>
            <div class="uk-width-auto">
              <button type="button" class="uk-button uk-button-text uk-button-small" data-media-meta-clear-folder>
                {{ t('button_media_clear_folder') }}
              </button>
            </div>
          </div>
          <div class="uk-text-meta uk-margin-small-top">{{ t('help_media_folder') }}</div>
        </div>
        <div class="media-landing-preview uk-margin-top" data-media-preview-landing hidden>
          <h4 class="uk-heading-bullet">{{ t('label_media_landing_preview') }}</h4>
          <ul class="uk-list uk-list-divider uk-text-small" data-media-preview-landing-list></ul>
        </div>
        <div class="uk-margin-top uk-flex uk-flex-wrap uk-grid-small media-preview-actions" uk-grid data-media-preview-actions hidden>
          <div>
            <a class="uk-button uk-button-default uk-button-small" data-media-download href="#" download>
              {{ t('action_download') }}
            </a>
          </div>
          <div>
            <button type="button" class="uk-button uk-button-default uk-button-small" data-media-replace>
              {{ t('button_media_replace') }}
            </button>
          </div>
          <div data-media-convert-container hidden>
            <button type="button" class="uk-button uk-button-default uk-button-small" data-media-convert>
              {{ t('button_media_convert') }}
            </button>
          </div>
          <div>
            <button type="button" class="uk-button uk-button-default uk-button-small" data-media-rename>
              {{ t('button_media_rename') }}
            </button>
          </div>
          <div>
            <button type="button" class="uk-button uk-button-danger uk-button-small" data-media-delete>
              {{ t('button_media_delete') }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
