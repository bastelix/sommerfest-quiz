{% extends 'layout.twig' %}

{% block title %}Quiz Verwaltung{% endblock %}

{% block head %}
  <link rel="stylesheet" href="/css/dark.css">
  <link rel="stylesheet" href="/css/main.css">
{% endblock %}

{% block body_class %}uk-background-muted uk-padding{% endblock %}

{% block body %}
  <div class="uk-flex uk-flex-between uk-margin-small-bottom">
    <a href="." class="uk-icon-button" uk-icon="icon: arrow-left; ratio: 2" title="Zurück" aria-label="Zurück"></a>
    <div class="uk-flex">
      <a href="/logout" class="uk-button uk-button-danger uk-margin-right">Logout</a>
      <div class="theme-switch uk-margin-right">
        <button id="theme-toggle" class="uk-icon-button" uk-icon="icon: moon; ratio: 2" aria-label="Design wechseln"></button>
      </div>
      <button id="helpBtn" class="uk-icon-button" uk-icon="icon: question; ratio: 2" aria-label="Hilfe"></button>
    </div>
  </div>
  <ul id="adminTabs" uk-tab>
    <li class="uk-active" data-help="Allgemeine Einstellungen wie Logo, Texte und Farben der Veranstaltung."><a href="#">Veranstaltung konfigurieren</a></li>
    <li data-help="Fragenkataloge erstellen, benennen und beschreiben. Die drei Felder stehen für ID, Name und Beschreibung. Mit \"Hinzufügen\" legst du einen neuen Katalog an, \"Speichern\" übernimmt Änderungen und \"Löschen\" entfernt einen Eintrag."><a href="#">Kataloge</a></li>
    <li data-help="Fragen eines Katalogs bearbeiten und neue Fragen hinzufügen."><a href="#">Fragen anpassen</a></li>
    <li data-help="Liste der teilnehmenden Teams oder Personen verwalten. Der Teamname wird beim Scannen an den Stationen verwendet. Die Option 'Nur Teams/Personen aus der Liste dürfen teilnehmen.' beschränkt die Teilnahme auf eingetragene Namen."><a href="#">Teams/Personen</a></li>
    <li data-help="Gespeicherte Quiz-Ergebnisse ansehen und herunterladen."><a href="#">Ergebnisse</a></li>
    <li data-help="Übersicht aller QR-Codes"><a href="#">Zusammenfassung</a></li>
    <li data-help="Administrationspasswort festlegen."><a href="#">Passwort ändern</a></li>
    <li data-help="Beispiele moderner QR-Codes"><a href="#">QR-Code Samples</a></li>
  </ul>
  <ul class="uk-switcher uk-margin">
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Veranstaltung konfigurieren</h2>
        <form id="configForm" class="uk-form-stacked">
          <div class="uk-child-width-1-1 uk-child-width-1-2@m uk-grid-small" uk-grid>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgLogoFile">Logo hochladen
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: PNG-Datei als Logo für die Startseite hochladen.; pos: right"></span>
                </label>
                <div class="uk-form-controls">
                  <div class="js-upload uk-placeholder uk-text-center">
                    <span uk-icon="icon: cloud-upload"></span>
                    <span class="uk-text-middle">Datei hierher ziehen oder </span>
                    <div uk-form-custom>
                      <input type="file" id="cfgLogoFile" accept="image/png">
                      <span class="uk-link">auswählen</span>
                    </div>
                  </div>
                  <progress id="cfgLogoProgress" class="uk-progress" value="0" max="100" hidden></progress>
                  <img id="cfgLogoPreview" src="{{ config.logoPath|default('') }}" alt="Logo Vorschau" class="uk-margin-small-top" style="max-height:80px">
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgPageTitle">Titel im Browser-Tab
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Text, der im Browser-Tab angezeigt wird.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgPageTitle"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgHeader">Überschrift
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Überschrift auf der Startseite.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgHeader"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgSubheader">Untertitel
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Text unter der Überschrift.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgSubheader"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgBackgroundColor">Hintergrundfarbe
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: CSS-Farbwert für die Seite.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgBackgroundColor"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgButtonColor">Farbe der Schaltflächen
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: CSS-Farbwert für alle Buttons.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgButtonColor"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgCheckAnswerButton">Antwort-Prüfen-Button anzeigen
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Zeigt beim Quiz einen Button zum Prüfen der Antwort.; pos: right"></span>
                </label>
                <div class="uk-form-controls">
                  <select class="uk-select" id="cfgCheckAnswerButton">
                    <option value="yes">Ja</option>
                    <option value="no">Nein</option>
                  </select>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgQRUser">QR-Code-Login verwenden
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Aktiviert den Button 'Name mit QR-Code scannen' auf der Startseite, um den Namen aus einem QR-Code zu übernehmen.; pos: right"></span>
                </label>
                <div class="uk-form-controls">
                  <select class="uk-select" id="cfgQRUser">
                    <option value="false">Nein</option>
                    <option value="true">Ja</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div class="uk-margin uk-flex uk-flex-between">
          <button id="cfgResetBtn" class="uk-button uk-button-default" uk-tooltip="title: Setzt alle Felder auf gespeicherte Werte zurück; pos: right">Zurücksetzen</button>
          <div>
            <button id="cfgSaveBtn" class="uk-button uk-button-primary" uk-tooltip="title: Einstellungen speichern; pos: right">Speichern</button>
          </div>
        </div>

      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <div>
          <h2 class="uk-heading-bullet">Kataloge</h2>
          <div class="uk-flex uk-margin-small">
            <div class="uk-width-small"><strong>ID</strong></div>
            <div class="uk-width-medium uk-margin-left"><strong>Name</strong></div>
            <div class="uk-width-expand uk-margin-left"><strong>Beschreibung</strong></div>
          </div>
          <div id="catalogList" class="uk-margin"></div>
          <div class="uk-margin">
            <button id="newCatBtn" class="uk-button uk-button-default" uk-tooltip="title: Neuen Fragenkatalog anlegen; pos: right">Hinzufügen</button>
          </div>
          <div class="uk-margin uk-flex uk-flex-right">
            <button id="catalogsSaveBtn" class="uk-button uk-button-primary" uk-tooltip="title: Änderungen an den Katalogen speichern; pos: right">Speichern</button>
          </div>
        </div>
      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Fragen bearbeiten</h2>
        <div class="uk-margin">
          <label class="uk-form-label" for="catalogSelect">Fragenkatalog
            <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Hier den zu bearbeitenden Katalog wählen.; pos: right"></span>
          </label>
          <div class="uk-form-controls">
            <select id="catalogSelect" class="uk-select"></select>
          </div>
        </div>
        <!-- Hauptdatenbereich: Frageneditor -->
        <div id="questions" class="uk-margin"></div>
        <!-- Bedienleiste fuer Frageneditor -->
        <div id="questionActions" class="sticky-actions uk-flex uk-flex-between uk-flex-middle uk-margin">
          <button id="addBtn" class="uk-button uk-button-default" uk-tooltip="title: Neue Frage im aktuellen Katalog anlegen; pos: right">Neue Frage</button>
          <div>
            <button id="resetBtn" class="uk-button uk-button-default uk-margin-right" uk-tooltip="title: Änderungen am Fragenkatalog verwerfen; pos: right">Zurücksetzen</button>
            <button id="saveBtn" class="uk-button uk-button-primary" uk-tooltip="title: Fragenkatalog speichern; pos: right">Speichern</button>
          </div>
        </div>
        <!-- Ende Hauptdatenbereich -->

      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Teams/Personen</h2>
        <div id="teamsList" class="uk-margin"></div>
        <div class="uk-margin">
          <button id="teamAddBtn" class="uk-button uk-button-default" uk-tooltip="title: Neues Team oder Person hinzufügen; pos: right">Hinzufügen</button>
        </div>
        <div class="uk-margin">
          <label><input class="uk-checkbox" type="checkbox" id="teamRestrict"> Nur Teams/Personen aus der Liste dürfen teilnehmen.
            <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Aktiviert eine Zugangsbeschränkung auf eingetragene Teams; pos: right"></span>
          </label>
        </div>
        <div class="uk-margin uk-flex uk-flex-right">
          <button id="teamsSaveBtn" class="uk-button uk-button-primary" uk-tooltip="title: Änderungen an Teams oder Personen speichern; pos: right">Speichern</button>
        </div>
      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Ergebnisse</h2>
        <table class="uk-table uk-table-divider">
          <thead>
            <tr><th>Name</th><th>Versuch</th><th>Katalog</th><th>Richtige</th></tr>
          </thead>
          <tbody>
            {% for r in results %}
            <tr>
              <td>{{ r.name }}</td>
              <td>{{ r.attempt }}</td>
              <td>{{ r.catalog }}</td>
              <td>{{ r.correct }}/{{ r.total }}</td>
            </tr>
            {% else %}
            <tr><td colspan="4">Keine Daten</td></tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="uk-margin uk-flex uk-flex-between">
          <button id="resultsResetBtn" class="uk-button uk-button-default" uk-tooltip="title: Löscht alle gespeicherten Ergebnisse; pos: right">Zurücksetzen</button>
          <button id="resultsDownloadBtn" class="uk-button uk-button-primary" uk-tooltip="title: Ergebnisse herunterladen; pos: right">Herunterladen</button>
        </div>
      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ config.header }}</h2>
        <p>{{ config.subheader }}</p>

        <h3 class="uk-heading-bullet">Kataloge</h3>
        <div class="card-grid" uk-grid>
          {% for c in catalogs %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card uk-card-default uk-card-body">
              <h4 class="uk-card-title">{{ c.name }}</h4>
              <p>{{ c.description }}</p>
              {% set link = baseUrl ? baseUrl ~ '/?katalog=' ~ c.id : '?katalog=' ~ c.id %}
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data={{ link|url_encode }}" alt="QR" width="96" height="96">
              <!--<img src="/qr.png?t={{ link|url_encode }}" alt="QR Design" width="96" height="96">-->
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card uk-card-default uk-card-body">Keine Kataloge</div>
          </div>
          {% endfor %}
        </div>

        <h3 class="uk-heading-bullet">Teams/Personen</h3>
        <div class="card-grid" uk-grid>
          {% for t in teams %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card uk-card-default uk-card-body">
              <h4 class="uk-card-title">{{ t }}</h4>
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data={{ t|url_encode }}" alt="QR" width="96" height="96">
              <!--<img src="/qr.png?t={{ t|url_encode }}" alt="QR Design" width="96" height="96">-->
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card uk-card-default uk-card-body">Keine Daten</div>
          </div>
          {% endfor %}
        </div>
        <div class="uk-margin uk-flex uk-flex-right">
          <button id="summaryPrintBtn" class="uk-button uk-button-default" uk-tooltip="title: Zusammenfassung drucken; pos: right">Drucken</button>
        </div>
        </div>
      </li>
      <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Passwort ändern</h2>
        <form id="passForm" class="uk-form-stacked">
          <div class="uk-child-width-1-1 uk-child-width-1-2@m uk-grid-small" uk-grid>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="newPass">Neues Passwort
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Neues Administrationspasswort festlegen.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="password" id="newPass"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="newPassRepeat">Passwort wiederholen
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: Passwort zur Bestätigung erneut eingeben.; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="password" id="newPassRepeat"></div>
              </div>
            </div>
          </div>
          <div class="uk-margin uk-flex uk-flex-right">
            <button id="passSaveBtn" class="uk-button uk-button-primary" uk-tooltip="title: Neues Passwort speichern; pos: right">Speichern</button>
          </div>
        </form>
      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">QR-Code Samples</h2>
        <div class="card-grid" uk-grid>
          {% set colors = ['ff5733','33c3ff','a433ff','ff33a6','33ff57','ffd433','3380ff','ff3333','33ffd9','7f33ff'] %}
          {% for i in 1..10 %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card uk-card-default uk-card-body">
              <h4 class="uk-card-title">Sample {{ i }}</h4>
              <img src="/qr.png?t={{ ('Sample ' ~ i)|url_encode }}&fg={{ colors[i-1] }}" alt="Sample {{ i }}" width="200" height="200">
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </li>
  </ul>
  <div id="helpSidebar" uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar uk-width-medium">
      <h3 class="uk-margin-remove-top">Hilfe</h3>
      <div id="helpContent"></div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/js/uikit-icons.min.js"></script>
  <script src="/js/custom-icons.js"></script>
  <script>
    window.quizConfig = {{ config|json_encode|raw }};
  </script>
  <script src="/js/admin.js"></script>
  <script src="/js/app.js"></script>
{% endblock %}
