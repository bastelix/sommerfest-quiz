{% extends 'layout.twig' %}

{% block config_color_styles %}{% endblock %}

{% block title %}{{ t('admin_title') }}{% endblock %}

{% block head %}
  <meta name="csrf-token" content="{{ csrf_token }}">
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css" media="(prefers-color-scheme: dark)">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg@2/dist/ui/trumbowyg.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/trumbowyg@2/dist/trumbowyg.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
  <script>
    window.profileVars = {
      NAME: {{ tenant.imprint_name|default('')|json_encode|raw }},
      STREET: {{ tenant.imprint_street|default('')|json_encode|raw }},
      ZIP: {{ tenant.imprint_zip|default('')|json_encode|raw }},
      CITY: {{ tenant.imprint_city|default('')|json_encode|raw }},
      EMAIL: {{ tenant.imprint_email|default('')|json_encode|raw }}
    };
  </script>
  <script>
    window.csrfToken = '{{ csrf_token|e('js') }}';
  </script>
  <script type="module" src="{{ basePath }}/js/trumbowyg-pages.js"></script>
  <script type="module" src="{{ basePath }}/js/seo-form.js"></script>
  {% endblock %}

{% block body_class %}uk-background-muted uk-padding admin-page{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}
    {% block left %}
      <button
        id="sidebarToggle"
        type="button"
        class="uk-navbar-toggle uk-visible@m uk-margin-small-right git-btn"
        aria-controls="adminSidebar"
        aria-expanded="true"
        aria-pressed="false"
        aria-label="{{ t('menu') }}"
      >
        <span uk-navbar-toggle-icon></span>
      </button>
      <button
        id="adminOffcanvasToggle"
        type="button"
        class="uk-navbar-toggle uk-visible@s uk-hidden@m uk-margin-small-right git-btn"
        uk-navbar-toggle-icon
        uk-toggle="target: #qr-offcanvas"
        aria-controls="qr-offcanvas"
        aria-expanded="false"
        aria-haspopup="true"
        aria-label="{{ t('menu') }}"
      ></button>
      <a href="{{ basePath }}/admin/dashboard" class="uk-navbar-item uk-logo uk-margin-small-left uk-visible@s">
        QuizRace Admin
        <div class="uk-text-meta uk-text-small">v{{ version }}</div>
      </a>
    {% endblock %}
    {% block center %}
      {% include 'admin/components/namespace_breadcrumb.twig' %}
    {% endblock %}
    {% block offcanvas %}
      <div id="qr-offcanvas" uk-offcanvas="overlay: true">
        <div class="uk-offcanvas-bar">
          <button class="uk-offcanvas-close" type="button" uk-close aria-label="{{ t('menu') }}"></button>
          <h3 class="uk-margin-small">QuizRace Admin</h3>
          {% include 'admin/_nav.twig' %}
        </div>
      </div>
    {% endblock %}
    {% block right %}{% endblock %}
  {% endembed %}
  {% if not stripe_configured %}
    <div class="uk-container uk-container-large">
      <div class="uk-alert-danger uk-margin" uk-alert>
        {{ t('text_stripe_config_missing') }}
      </div>
    </div>
  {% endif %}
  {% if tenant and tenant.stripe_status == 'trialing' and tenant.stripe_current_period_end %}
    <div class="uk-container uk-container-large">
      <div class="uk-alert-primary uk-margin" uk-alert>
        {{ t('text_trial_banner_prefix') }} {{ tenant.stripe_current_period_end|date('d.m.Y') }}.
        {{ t('text_trial_banner_suffix') }} <a href="{{ basePath }}/admin/subscription/portal">{{ t('action_setup_payment_method') }}</a>
      </div>
    </div>
  {% endif %}
  <div class="uk-grid-collapse" uk-grid>
    <aside id="adminSidebar" class="uk-width-1-4@m uk-width-1-5@l uk-visible@m qr-sidebar">
      <div class="uk-card qr-card uk-card-body qr-sidebar-card">
        {% include 'admin/_nav.twig' %}
      </div>
    </aside>
    <main class="uk-width-expand uk-padding-small@xs uk-padding">
      <div id="eventNotice" class="uk-alert uk-alert-primary" hidden data-empty="{{ t('text_no_events') }}" data-required="{{ t('text_event_required') }}" data-error="{{ t('text_events_fetch_error') }}"></div>
      {% set activeRoute = currentPath|split('/admin/')|last %}
      {% if activeRoute == '' %}
        {% set activeRoute = 'dashboard' %}
      {% endif %}
      <ul id="adminSwitcher" class="uk-switcher uk-margin">
      <li class="{{ activeRoute == 'dashboard' ? 'uk-active' }}">
        <div class="uk-container uk-container-large dashboard-container">
          <h1 class="uk-heading-bullet">Willkommen {{ username }}</h1>
          <div id="dashboard" class="uk-margin-large-top">
            <div class="uk-grid-large" uk-grid>
              <!-- Spalte 2–3: Inhalt -->
            <div class="uk-width-1-1 uk-width-2-3@m">
              <div class="uk-card qr-card uk-card-body uk-margin-small">
                <div class="uk-flex uk-flex-between uk-flex-middle">
                  <h3 class="uk-card-title uk-margin-remove">Für heute geplant</h3>
                  <div>
                    <a
                      href="{{ basePath }}/admin/events"
                      class="uk-button uk-button-primary uk-button-small"
                      aria-label="{{ t('tip_event_add') }}"
                    >
                      <span uk-icon="plus"></span>
                      <span class="button-text uk-visible@s uk-margin-small-left">{{ t('tip_event_add') }}</span>
                    </a>
                  </div>
                </div>
                <div id="today-empty" class="uk-text-meta uk-margin-small">Für heute nichts geplant</div>
                <ul id="upcoming-list" class="uk-list uk-list-divider uk-margin-small-top"></ul>
              </div>
              <div class="uk-margin-small">
                <span class="uk-badge" id="badge-events">0 Veranstaltungen</span>
                <span class="uk-badge" id="badge-upcoming">0 kommende</span>
                <span class="uk-badge" id="badge-past">0 vergangene</span>
              </div>

              <div class="dashboard-grid uk-margin-small">
                <div class="dashboard-tile">
                  <div class="uk-card qr-card uk-card-body">
                    <h4 class="uk-margin-remove-bottom">Teams anlegen & organisieren</h4>
                    <p class="uk-text-meta uk-margin-small-top">Erstelle Teams, generiere QR-Codes und teile Einladungen.</p>
                    <a href="{{ basePath }}/admin/teams" class="uk-link-reset uk-text-bold">Teams verwalten →</a>
                  </div>
                </div>
                <div class="dashboard-tile">
                  <div class="uk-card qr-card uk-card-body">
                    <h4 class="uk-margin-remove-bottom">Auswertung & Ergebnisse</h4>
                    <p class="uk-text-meta uk-margin-small-top">Live-Ergebnisse prüfen und PDF-Berichte exportieren.</p>
                    <a href="{{ basePath }}/admin/results" class="uk-link-reset uk-text-bold">Zur Auswertung →</a>
                  </div>
                </div>
              </div>

              <div class="uk-card qr-card uk-card-body uk-margin-small">
                <h3 class="uk-card-title uk-margin-remove">{{ t('heading_subscription_usage') }}</h3>
                <div data-subscription
                     data-label-plan="{{ t('label_plan') }}"
                     data-label-events="{{ t('label_events') }}"
                     data-label-catalogs="{{ t('label_catalogs') }}"
                     data-label-questions="{{ t('label_questions') }}"
                     data-label-of="{{ t('word_of') }}"
                     data-plan-starter="{{ t('plan_starter') }}"
                     data-plan-standard="{{ t('plan_standard') }}"
                     data-plan-professional="{{ t('plan_professional') }}"></div>
                <label for="planSelect" class="uk-form-label uk-margin-small-top">{{ t('label_plan') }}</label>
                <select id="planSelect" class="uk-select">
                  <option value="">{{ t('plan_none') }}</option>
                  <option value="starter">{{ t('plan_starter') }}</option>
                  <option value="standard">{{ t('plan_standard') }}</option>
                  <option value="professional">{{ t('plan_professional') }}</option>
                </select>
              </div>
            </div>

            <!-- Spalte 1: Kalender -->
            <div class="uk-width-1-1 uk-width-1-3@m">
              <div class="uk-card qr-card uk-card-small uk-card-body uk-margin-small">
                <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
                  <h3 class="uk-card-title uk-margin-remove">August 2025</h3>
                  <div>
                    <button class="uk-button uk-button-default uk-button-small" id="cal-prev" aria-label="Vorheriger Monat">‹</button>
                    <button class="uk-button uk-button-default uk-button-small" id="cal-next" aria-label="Nächster Monat">›</button>
                  </div>
                </div>
                <div id="calendar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'events' ? 'uk-active' }}">
      <div class="uk-container uk-container-large" data-admin-section="management">
        <h2 class="uk-heading-bullet">{{ t('heading_events') }}</h2>
        <p class="uk-hidden">Professionelles Quiz-Hosting</p>
        <div class="uk-overflow-auto uk-visible@m">
          <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
            <thead>
              <tr>
                <th class="uk-table-shrink"></th>
                <th>{{ t('column_number') }}</th>
                <th>{{ t('column_name') }}</th>
                <th>{{ t('column_start') }}</th>
                <th>{{ t('column_end') }}</th>
                <th>{{ t('column_description') }}</th>
                <th class="uk-table-shrink">{{ t('column_current') }}</th>
                <th class="uk-table-shrink uk-text-center">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody
              id="eventsList"
              data-label-name="{{ t('column_name') }}"
              data-label-start="{{ t('column_start') }}"
              data-label-end="{{ t('column_end') }}"
              data-label-description="{{ t('column_description') }}"
              data-tip-select-event="{{ t('tip_select_event') }}"
            ></tbody>
          </table>
        </div>
        {% from 'components/table.twig' import qr_rowcards %}
        {{ qr_rowcards('eventsCards') }}
        <div class="uk-margin">
          <button
            id="eventAddBtn"
            class="uk-icon-button uk-button-primary fab"
            uk-icon="plus"
            uk-tooltip="title: {{ t('tip_event_add') }}; pos: left"
            aria-label="{{ t('tip_event_add') }}"
          ></button>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'event/dashboard' ? 'uk-active' }}">
      {% include 'admin/components/event_dashboard.twig' %}
    </li>
    <li class="{{ activeRoute == 'event/settings' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        {% set eventName = event.name|default('') %}
        <h2
          id="eventSettingsHeading"
          class="uk-heading-bullet"
          data-title="{{ t('heading_event_settings') }}"
        >{{ eventName|e }}{% if eventName %} – {% endif %}{{ t('heading_event_settings') }}</h2>
        <hr class="admin-divider-line uk-margin-remove-top">
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: eventName
        } %}
        <p class="uk-text-meta uk-margin-small">{{ 'Änderungen werden automatisch gespeichert.' }}</p>
        <form
          id="configForm"
          class="uk-form-stacked"
          method="post"
          action="/config.json"
          data-config-form
        >
          <div class="uk-child-width-1-1 uk-child-width-1-2@m uk-grid-small" uk-grid>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgLogoFile">{{ t('label_logo_upload') }}
                  <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_logo_upload') }}; pos: right" aria-label="{{ t('tip_logo_upload') }}" tabindex="0"></span>
                </label>
                <div class="uk-form-controls">
                  <div class="js-upload uk-placeholder uk-text-center">
                    <span uk-icon="icon: cloud-upload"></span>
                    <span class="uk-text-middle">{{ t('label_drag_file') }}&nbsp;</span>
                    <div uk-form-custom>
                      <input type="file" id="cfgLogoFile" accept="image/png,image/webp,image/svg+xml">
                      <span class="uk-link">{{ t('action_select') }}</span>
                    </div>
                  </div>
                  <progress id="cfgLogoProgress" class="uk-progress" value="0" max="100" hidden></progress>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <div class="uk-form-label">{{ t('label_logo_preview') }}</div>
                <div class="uk-form-controls">
                  <div class="logo-frame uk-margin-small-top">
                    <img
                      id="cfgLogoPreview"
                      src="{% if config.logoPath %}
                            {{ basePath ~ config.logoPath }}
                          {% else %}
                            data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='160'%20height='240'%3E%3Crect%20width='160'%20height='240'%20fill='%23ccc'/%3E%3Ctext%20x='50%25'%20y='50%25'%20dominant-baseline='middle'%20text-anchor='middle'%20font-size='20'%20fill='%23666'%3ELogo%3C/text%3E%3C/svg%3E
                          {% endif %}"
                      alt="{{ t('label_logo_preview') }}"
                      class="logo-placeholder"
                      width="160"
                      height="240"
                      loading="lazy">
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgPageTitle">{{ t('label_page_title') }}
                  <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_page_title') }}; pos: right" aria-label="{{ t('tip_page_title') }}" tabindex="0"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgPageTitle" name="pageTitle" value="{{ config.pageTitle|default('') }}"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin uk-child-width-1-2@s uk-grid-small" uk-grid>
                <div>
                  <label class="uk-form-label" for="cfgBackgroundColor">{{ t('label_background_color') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_background_color') }}; pos: right" aria-label="{{ t('tip_background_color') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgBackgroundColor" name="backgroundColor" value="{{ config.backgroundColor|default('#ffffff') }}"></div>
                </div>
                <div>
                  <label class="uk-form-label" for="cfgButtonColor">{{ t('label_button_color') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_button_color') }}; pos: right" aria-label="{{ t('tip_button_color') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgButtonColor" name="buttonColor" value="{{ config.buttonColor|default('#1e87f0') }}"></div>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgStartTheme">{{ t('label_start_theme') }}
                  <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_start_theme') }}; pos: right" aria-label="{{ t('tip_start_theme') }}" tabindex="0"></span>
                </label>
                <div class="uk-form-controls">
                  <select class="uk-select" id="cfgStartTheme" name="startTheme">
                    <option value="light" {% if config.startTheme|default('light') != 'dark' %}selected{% endif %}>{{ t('option_theme_light') }}</option>
                    <option value="dark" {% if config.startTheme|default('light') == 'dark' %}selected{% endif %}>{{ t('option_theme_dark') }}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="uk-width-1-1">
              <hr class="admin-divider-line">
              <h3 class="uk-heading-bullet">{{ t('heading_game_options') }}</h3>
            </div>
              <div class="uk-width-1-1">
                <hr class="admin-divider-line admin-divider-line--subsection">
                <h4 class="uk-heading-bullet">{{ t('heading_login') }}</h4>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgQRUser" name="QRUser" value="1" {% if config.QRUser %}checked{% endif %}> {{ t('label_qr_login') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_qr_button') }}; pos:right" aria-label="{{ t('tip_qr_button') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgRandomNames" name="randomNames" value="1" {% if config.randomNames %}checked{% endif %}> {{ t('label_random_names') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_names') }}; pos: right" aria-label="{{ t('tip_random_names') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div class="uk-width-1-1">
                {% set randomNameDomains = constant('App\\Service\\ConfigValidator::RANDOM_NAME_ALLOWED_DOMAINS') %}
                {% set randomNameTones = constant('App\\Service\\ConfigValidator::RANDOM_NAME_ALLOWED_TONES') %}
                {% set randomNameDomainValues = config.randomNameDomains|default([]) %}
                {% set randomNameToneValues = config.randomNameTones|default([]) %}
                {% set randomNameStrategies = constant('App\\Service\\ConfigValidator::RANDOM_NAME_STRATEGIES') %}
                {% set randomNameStrategyDefault = constant('App\\Service\\ConfigValidator::RANDOM_NAME_STRATEGY_DEFAULT') %}
                {% set randomNameStrategyValue = config.randomNameStrategy|default(randomNameStrategyDefault)|lower %}
                {% if randomNameStrategyValue not in randomNameStrategies %}
                  {% set randomNameStrategyValue = randomNameStrategyDefault %}
                {% endif %}
                {% set randomNameLocaleValue = config.randomNameLocale|default('') %}
                {% set randomNameHintKey = 'disabled' %}
                {% if config.randomNames %}
                  {% if randomNameStrategyValue == 'lexicon' %}
                    {% set randomNameHintKey = 'lexicon' %}
                  {% else %}
                    {% set randomNameHintKey = 'ai' %}
                  {% endif %}
                {% endif %}
                <div class="uk-margin">
                  <label class="uk-form-label" for="cfgRandomNameStrategy">
                    {{ t('label_random_name_strategy') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_name_strategy') }}; pos: right" aria-label="{{ t('tip_random_name_strategy') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-form-controls">
                    <select class="uk-select" id="cfgRandomNameStrategy" name="random_name_strategy">
                      <option value="ai" {% if randomNameStrategyValue == 'ai' %}selected{% endif %}>{{ t('option_random_name_strategy_ai') }}</option>
                      <option value="lexicon" {% if randomNameStrategyValue == 'lexicon' %}selected{% endif %}>{{ t('option_random_name_strategy_lexicon') }}</option>
                    </select>
                  </div>
                  <p class="uk-text-meta uk-margin-small-top">{{ t('text_random_name_strategy_hint') }}</p>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="cfgRandomNameLocale">
                    {{ t('label_random_name_locale') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_name_locale') }}; pos: right" aria-label="{{ t('tip_random_name_locale') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-form-controls">
                    <input class="uk-input" type="text" id="cfgRandomNameLocale" name="random_name_locale" value="{{ randomNameLocaleValue }}" placeholder="{{ t('placeholder_random_name_locale') }}">
                  </div>
                  <p class="uk-text-meta uk-margin-small-top">{{ t('text_random_name_locale_hint') }}</p>
                </div>
                <div
                  class="uk-alert-primary uk-alert-small uk-margin-small"
                  uk-alert
                  data-random-name-hints
                  data-hint-ai="{{ t('text_random_name_hint_ai') }}"
                  data-hint-lexicon="{{ t('text_random_name_hint_lexicon') }}"
                  data-hint-disabled="{{ t('text_random_name_hint_disabled') }}"
                >
                  <p class="uk-margin-remove" data-random-name-hint-text>
                    {% if randomNameHintKey == 'ai' %}
                      {{ t('text_random_name_hint_ai') }}
                    {% elseif randomNameHintKey == 'lexicon' %}
                      {{ t('text_random_name_hint_lexicon') }}
                    {% else %}
                      {{ t('text_random_name_hint_disabled') }}
                    {% endif %}
                  </p>
                </div>
                {% set randomNameOptionsDisabled = (not config.randomNames) or (randomNameStrategyValue != 'ai') %}
                <fieldset class="uk-fieldset uk-margin-small-top{% if randomNameOptionsDisabled %} uk-disabled{% endif %}" data-random-name-options {% if randomNameOptionsDisabled %}disabled{% endif %}>
                  <legend class="uk-legend uk-text-small uk-text-bold">{{ t('legend_random_name_preferences') }}</legend>
                  <div class="uk-grid-small uk-child-width-1-2@s" uk-grid>
                    <div>
                      <div class="uk-flex uk-flex-middle uk-margin-small-bottom">
                        <span class="uk-form-label">{{ t('label_random_name_domains') }}</span>
                        <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_name_domains') }}; pos: right" aria-label="{{ t('tip_random_name_domains') }}" tabindex="0"></span>
                      </div>
                      <div class="uk-grid-small uk-child-width-1-2@s uk-margin-small-top" uk-grid>
                        {% for domain in randomNameDomains %}
                          {% set domainId = 'cfgRandomNameDomain-' ~ domain|replace({'_':'-'}) %}
                          <div>
                            <label class="uk-display-block" for="{{ domainId }}">
                              <input class="uk-checkbox" type="checkbox" id="{{ domainId }}" name="random_name_domains[]" value="{{ domain }}" {% if domain in randomNameDomainValues %}checked{% endif %}>
                              {{ t('option_random_name_domain_' ~ domain) }}
                            </label>
                          </div>
                        {% endfor %}
                      </div>
                      <p class="uk-text-meta uk-margin-small-top">{{ t('text_random_name_domains_hint') }}</p>
                    </div>
                    <div>
                      <div class="uk-flex uk-flex-middle uk-margin-small-bottom">
                        <span class="uk-form-label">{{ t('label_random_name_tones') }}</span>
                        <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_name_tones') }}; pos: right" aria-label="{{ t('tip_random_name_tones') }}" tabindex="0"></span>
                      </div>
                      <div class="uk-grid-small uk-child-width-1-2@s uk-margin-small-top" uk-grid>
                        {% for tone in randomNameTones %}
                          {% set toneId = 'cfgRandomNameTone-' ~ tone|replace({'_':'-'}) %}
                          <div>
                            <label class="uk-display-block" for="{{ toneId }}">
                              <input class="uk-checkbox" type="checkbox" id="{{ toneId }}" name="random_name_tones[]" value="{{ tone }}" {% if tone in randomNameToneValues %}checked{% endif %}>
                              {{ t('option_random_name_tone_' ~ tone) }}
                            </label>
                          </div>
                        {% endfor %}
                      </div>
                      <p class="uk-text-meta uk-margin-small-top">{{ t('text_random_name_tones_hint') }}</p>
                    </div>
                  </div>
                  <div class="uk-margin-top">
                    <label class="uk-form-label" for="cfgRandomNameBuffer">
                      {{ t('label_random_name_buffer') }}
                      <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_random_name_buffer') }}; pos: right" aria-label="{{ t('tip_random_name_buffer') }}" tabindex="0"></span>
                    </label>
                    <div class="uk-form-controls">
                      <input class="uk-input" type="number" id="cfgRandomNameBuffer" name="random_name_buffer" min="{{ constant('App\\Service\\ConfigValidator::RANDOM_NAME_BUFFER_MIN') }}" max="{{ constant('App\\Service\\ConfigValidator::RANDOM_NAME_BUFFER_MAX') }}" step="1" value="{{ config.randomNameBuffer|default(0) }}">
                    </div>
                    <p class="uk-text-meta uk-margin-small-top">{{ t('text_random_name_buffer_hint') }}</p>
                  </div>
                  <div
                    class="uk-alert-secondary uk-alert-small uk-margin-top"
                    uk-alert
                    data-random-name-inventory
                    data-inventory-loading="{{ t('text_random_name_inventory_loading') }}"
                    data-inventory-error="{{ t('text_random_name_inventory_error') }}"
                    data-inventory-ai-total="{{ t('text_random_name_inventory_ai_total') }}"
                    data-inventory-ai-empty="{{ t('text_random_name_inventory_ai_empty') }}"
                    data-inventory-lexicon="{{ t('text_random_name_inventory_lexicon') }}"
                    data-inventory-lexicon-empty="{{ t('text_random_name_inventory_lexicon_empty') }}"
                    hidden
                  >
                    <div class="uk-grid-small uk-child-width-1-2@s" uk-grid>
                      <div>
                        <div class="uk-text-bold">{{ t('label_random_name_inventory_ai') }}</div>
                        <div class="uk-text-meta" data-random-name-inventory-ai>{{ t('text_random_name_inventory_loading') }}</div>
                      </div>
                      <div>
                        <div class="uk-text-bold">{{ t('label_random_name_inventory_lexicon') }}</div>
                        <div class="uk-text-meta" data-random-name-inventory-lexicon>{{ t('text_random_name_inventory_loading') }}</div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="uk-margin-top"
                    data-random-name-preview
                    data-preview-hint="{{ t('text_random_name_preview_hint') }}"
                    data-preview-empty="{{ t('text_random_name_preview_empty') }}"
                    data-preview-loading="{{ t('text_random_name_preview_loading') }}"
                    data-preview-error="{{ t('text_random_name_preview_error') }}"
                    data-preview-none="{{ t('text_random_name_preview_none') }}"
                    data-preview-requires-event="{{ t('text_random_name_preview_requires_event') }}"
                    data-log-target="{{ t('text_random_name_log_target') }}"
                    data-log-attempt="{{ t('text_random_name_log_attempt') }}"
                    data-log-received="{{ t('text_random_name_log_received') }}"
                    data-log-accepted="{{ t('text_random_name_log_accepted') }}"
                    data-log-skipped-duplicate-cache="{{ t('text_random_name_log_skipped_duplicate_cache') }}"
                    data-log-skipped-duplicate-event="{{ t('text_random_name_log_skipped_duplicate_event') }}"
                    data-log-skipped-invalid="{{ t('text_random_name_log_skipped_invalid') }}"
                    data-log-error="{{ t('text_random_name_log_error') }}"
                    data-log-persisted="{{ t('text_random_name_log_persisted') }}"
                    data-log-status-completed="{{ t('text_random_name_log_status_completed') }}"
                    data-log-status-partial="{{ t('text_random_name_log_status_partial') }}"
                    data-log-status-failed="{{ t('text_random_name_log_status_failed') }}"
                    data-log-status-unchanged="{{ t('text_random_name_log_status_unchanged') }}"
                    data-log-status-skipped="{{ t('text_random_name_log_status_skipped') }}"
                    data-log-status-disabled="{{ t('text_random_name_log_status_disabled') }}"
                    data-log-status-missing-event="{{ t('text_random_name_log_status_missing_event') }}"
                    data-log-names-placeholder="{{ t('text_random_name_log_names_placeholder') }}"
                  >
                    <div class="uk-flex uk-flex-middle uk-grid-small" uk-grid>
                      <div>
                        <button class="uk-button uk-button-default" type="button" id="cfgRandomNamePreviewButton">
                          {{ t('button_random_name_preview_fetch') }}
                        </button>
                      </div>
                      <div class="uk-text-meta" data-random-name-preview-status>{{ t('text_random_name_preview_hint') }}</div>
                      <div>
                        <span class="uk-margin-small-left" uk-spinner="ratio: 0.6" hidden data-random-name-preview-spinner></span>
                      </div>
                    </div>
                    <ul class="uk-list uk-list-divider uk-margin-small-top" data-random-name-preview-list hidden></ul>
                    <div
                      class="uk-margin-small-top"
                      data-random-name-cache
                      data-cache-empty="{{ t('text_random_name_cache_empty') }}"
                      data-cache-total="{{ t('text_random_name_cache_total') }}"
                      data-cache-label-domains="{{ t('label_random_name_domains') }}"
                      data-cache-label-tones="{{ t('label_random_name_tones') }}"
                      data-cache-label-locale="{{ t('label_random_name_cache_locale') }}"
                      data-cache-none="{{ t('text_random_name_cache_no_filters') }}"
                      data-cache-entry-count="{{ t('text_random_name_cache_entry_count') }}"
                      data-cache-entry-empty="{{ t('text_random_name_cache_entry_empty') }}"
                      hidden
                    >
                      <div class="uk-flex uk-flex-middle uk-grid-small" uk-grid>
                        <div class="uk-text-bold">{{ t('heading_random_name_cache') }}</div>
                        <div class="uk-text-meta" data-random-name-cache-status>{{ t('text_random_name_cache_empty') }}</div>
                      </div>
                      <ul class="uk-list uk-list-divider uk-margin-small-top" data-random-name-cache-list hidden></ul>
                    </div>
                  </div>
                </fieldset>
              </div>
              <div class="uk-width-1-1">
                <hr class="admin-divider-line admin-divider-line--subsection">
                <h4 class="uk-heading-bullet">{{ t('heading_access') }}</h4>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgTeamRestrict" name="QRRestrict" value="1" {% if config.QRRestrict %}checked{% endif %}> {{ t('label_team_restrict') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_team_restrict') }}; pos: right" aria-label="{{ t('tip_team_restrict') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div class="uk-width-1-1">
                <hr class="admin-divider-line admin-divider-line--subsection">
                <h4 class="uk-heading-bullet">{{ t('heading_gameplay') }}</h4>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgCheckAnswerButton" name="CheckAnswerButton" value="yes" {% if config.CheckAnswerButton != 'no' %}checked{% endif %}> {{ t('label_check_button') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_check_button') }}; pos: right" aria-label="{{ t('tip_check_button') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgShuffleQuestions" name="shuffleQuestions" value="1" {% if config.shuffleQuestions %}checked{% endif %}> {{ t('label_shuffle_questions') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_shuffle_questions') }}; pos: right" aria-label="{{ t('tip_shuffle_questions') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgCompetitionMode" name="competitionMode" value="1" {% if config.competitionMode %}checked{% endif %}> {{ t('label_competition_mode') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_competition_mode') }}; pos: right" aria-label="{{ t('tip_competition_mode') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgTeamResults" name="teamResults" value="1" {% if config.teamResults %}checked{% endif %}> {{ t('label_team_results') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_team_results') }}; pos: right" aria-label="{{ t('tip_team_results') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div class="uk-width-1-1">
                <hr class="admin-divider-line admin-divider-line--subsection">
                <h4 class="uk-heading-bullet">{{ t('heading_extras') }}</h4>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgPhotoUpload" name="photoUpload" value="1" {% if config.photoUpload %}checked{% endif %}> {{ t('label_photo_upload') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_photo_upload') }}; pos: right" aria-label="{{ t('tip_photo_upload') }}" tabindex="0"></span>
                  </label>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgCountdownEnabled" name="countdownEnabled" value="1" {% if config.countdownEnabled %}checked{% endif %}> {{ t('label_countdown_enabled') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_countdown_enabled') }}; pos: right" aria-label="{{ t('tip_countdown_enabled') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-text-meta">{{ t('text_countdown_enabled_hint') }}</div>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="cfgCountdown">{{ t('label_countdown_default') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_countdown_default') }}; pos: right" aria-label="{{ t('tip_countdown_default') }}" tabindex="0"></span>
                  </label>
                  <div class="uk-form-controls">
                    <input class="uk-input" type="number" min="0" id="cfgCountdown" name="countdown" value="{{ config.countdown|default('') }}">
                  </div>
                  <div class="uk-text-meta">{{ t('text_countdown_default_hint') }}</div>
                </div>
              </div>
              <div>
                <div class="uk-margin">
                  <label><input class="uk-checkbox" type="checkbox" id="cfgPuzzleEnabled" name="puzzleWordEnabled" value="1" {% if config.puzzleWordEnabled %}checked{% endif %}> {{ t('label_puzzle_word') }}
                    <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_puzzle_word') }}; pos: right" aria-label="{{ t('tip_puzzle_word') }}" tabindex="0"></span>
                  </label>
                  <div id="cfgPuzzleWordWrap" class="uk-margin-small-top uk-grid uk-child-width-1-2@m uk-grid-small uk-flex-middle" uk-grid>
                    <div>
                      <input class="uk-input" type="text" id="cfgPuzzleWord" name="puzzleWord" placeholder="{{ t('placeholder_puzzle_word') }}" value="{{ config.puzzleWord|default('') }}">
                    </div>
                    <div>
                      <button id="puzzleFeedbackBtn" class="uk-button uk-button-default uk-width-1-1@m" type="button" uk-toggle="target: #puzzleFeedbackModal">
                        <span id="puzzleFeedbackIcon" uk-icon="icon: check"></span>
                        <span id="puzzleFeedbackLabel">{{ t('action_edit_feedback') }}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
        <div id="puzzleFeedbackModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_feedback') }}</h2>
            <textarea id="puzzleFeedbackTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_feedback') }}"></textarea>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="puzzleFeedbackSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>

        <div id="catalogCommentModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_catalog_comment') }}</h2>
            <div id="catalogCommentToolbar" class="uk-margin-small-bottom">
              <button class="uk-button uk-button-default" type="button" data-format="h2">H2</button>
              <button class="uk-button uk-button-default" type="button" data-format="h3">H3</button>
              <button class="uk-button uk-button-default" type="button" data-format="h4">H4</button>
              <button class="uk-button uk-button-default" type="button" data-format="h5">H5</button>
              <button class="uk-button uk-button-default" type="button" data-format="bold"><strong>B</strong></button>
              <button class="uk-button uk-button-default" type="button" data-format="italic"><em>I</em></button>
            </div>
            <textarea id="catalogCommentTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_catalog_comment') }}"></textarea>
            <div class="uk-margin-top uk-text-right">
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
              <button id="catalogCommentSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
            </div>
          </div>
        </div>

        <div id="catalogEditModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_catalog_edit') }}</h2>
            <input id="catalogEditInput" class="uk-input" type="text">
            <div id="catalogEditError" class="uk-text-danger uk-margin-small-top" hidden></div>
            <div class="uk-margin-top uk-text-right">
              <button id="catalogEditCancel" class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
              <button id="catalogEditSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
            </div>
          </div>
        </div>

      </div>
    </li>
    <li class="{{ activeRoute == 'catalogs' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div>
          {% set eventName = event.name|default('') %}
          <h2
            id="catalogsHeading"
            class="uk-heading-bullet"
            data-title="{{ t('heading_catalogs') }}"
          >{{ eventName|e }}{% if eventName %} – {% endif %}{{ t('heading_catalogs') }}</h2>
          {% include 'admin/components/event_controls.twig' with {
            currentEventUid: config.event_uid|default(''),
            currentEventName: eventName
          } %}
          {% from 'components/table.twig' import qr_rowcards %}
          <div class="uk-overflow-auto uk-visible@m">
            <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
              <thead>
                <tr>
                  <th class="uk-table-shrink"></th>
                  <th data-key="slug">{{ t('column_slug') }}</th>
                  <th data-key="name">{{ t('column_name') }}</th>
                  <th data-key="description">{{ t('column_description') }}</th>
                  <th data-key="raetsel_buchstabe">{{ t('column_letter') }}</th>
                  <th data-key="comment">{{ t('column_comment') }}</th>
                  <th class="uk-table-shrink uk-text-center">{{ t('column_actions') }}</th>
                </tr>
              </thead>
              <tbody
                id="catalogList"
                data-label-slug="{{ t('column_slug') }}"
                data-label-name="{{ t('column_name') }}"
                data-label-description="{{ t('column_description') }}"
                data-label-letter="{{ t('column_letter') }}"
                data-label-comment="{{ t('column_comment') }}"
              ></tbody>
            </table>
          </div>
          {{ qr_rowcards('catalogCards') }}
          <ul id="catalogsPagination" class="uk-pagination uk-flex-center"></ul>
          <div class="uk-margin">
            <button id="newCatBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_cat_add') }}; pos: left" aria-label="{{ t('tip_cat_add') }}"></button>
          </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'questions' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        {% set eventName = event.name|default('') %}
        <h2
          id="questionsHeading"
          class="uk-heading-bullet"
          data-title="{{ t('heading_questions') }}"
        >{{ eventName|e }}{% if eventName %} – {% endif %}{{ t('heading_questions') }}</h2>
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: eventName
        } %}
        <div class="uk-margin">
          <label class="uk-form-label" for="catalogSelect">{{ t('label_catalog_select') }}
            <span class="uk-margin-small-left help-icon" uk-icon="icon: info" uk-tooltip="title: {{ t('tip_catalog_select') }}; pos: right" aria-label="{{ t('tip_catalog_select') }}" tabindex="0"></span>
          </label>
          <div class="uk-form-controls">
            <select id="catalogSelect" class="uk-select uk-margin-small-top"></select>
          </div>
        </div>
        <!-- Hauptdatenbereich: Frageneditor -->
        <div id="questions" class="uk-margin"></div>
        <!-- Bedienleiste fuer Frageneditor -->
        <div id="questionActions">
          <div class="uk-margin">
          <button id="addBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_question_add') }}; pos: left" aria-label="{{ t('tip_question_add') }}"></button>
        </div>
      </div>
      <!-- Ende Hauptdatenbereich -->

      </div>
    </li>
    <li class="{{ activeRoute == 'media' ? 'uk-active' }}" data-media-tab>
      {% include 'admin/media.twig' %}
    </li>
    <li class="{{ activeRoute == 'rag-chat' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_rag_chat') }}</h2>
        <ul uk-tab>
          <li><a href="#">{{ t('tab_domain_chat') }}</a></li>
          <li><a href="#">{{ t('tab_rag_chat_config') }}</a></li>
        </ul>
        <ul class="uk-switcher uk-margin">
          <li>
            {% include 'admin/components/domain_chat.twig' %}
          </li>
          <li>
            <p class="uk-text-meta uk-margin-small">{{ t('text_rag_chat_hint') }}</p>
            <form id="ragChatForm" class="uk-form-stacked uk-margin">
              <div class="uk-margin">
                <label class="uk-form-label" for="ragChatUrl">{{ t('label_rag_chat_url') }}</label>
                <div class="uk-form-controls">
                  <input
                    class="uk-input"
                    type="url"
                    id="ragChatUrl"
                    value="{{ settings.rag_chat_service_url|default('') }}"
                    placeholder="https://chat.example.com/v1/chat"
                  >
                </div>
              </div>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatDriver">{{ t('label_rag_chat_driver') }}</label>
                    <div class="uk-form-controls">
                      {% set driver = settings.rag_chat_service_driver|default('')|lower %}
                      <select class="uk-select" id="ragChatDriver">
                        <option value=""{% if driver == '' %} selected{% endif %}>{{ t('option_rag_chat_driver_auto') }}</option>
                        <option value="openai"{% if driver == 'openai' %} selected{% endif %}>{{ t('option_rag_chat_driver_openai') }}</option>
                        <option value="http"{% if driver == 'http' %} selected{% endif %}>{{ t('option_rag_chat_driver_http') }}</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin uk-flex uk-flex-middle" style="min-height: 58px;">
                    {% set forceOpenAi = settings.rag_chat_service_force_openai|default('')|lower %}
                    <label class="uk-form-label uk-margin-remove"><input class="uk-checkbox" type="checkbox" id="ragChatForceOpenAi"{% if forceOpenAi in ['1','true','yes','on'] %} checked{% endif %}> {{ t('label_rag_chat_force_openai') }}</label>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatModel">{{ t('label_rag_chat_model') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="text"
                        id="ragChatModel"
                        value="{{ settings.rag_chat_service_model|default('') }}"
                        placeholder="gpt-4o-mini"
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-1 uk-width-1-2@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatToken">{{ t('label_rag_chat_token') }}</label>
                    <div class="uk-form-controls">
                      {% set tokenPlaceholder = settings.rag_chat_service_token_present|default('0') == '1' ? t('placeholder_rag_chat_token') : '' %}
                      <input
                        class="uk-input"
                        type="password"
                        id="ragChatToken"
                        value=""
                        autocomplete="new-password"
                        placeholder="{{ tokenPlaceholder }}"
                      >
                    </div>
                    <p id="ragChatTokenStatus" class="uk-text-meta uk-margin-small">{{ t('text_rag_chat_token_hint') }}</p>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                  <div class="uk-margin uk-flex uk-flex-middle" style="min-height: 58px;">
                    <label class="uk-form-label uk-margin-remove"><input class="uk-checkbox" type="checkbox" id="ragChatTokenClear"> {{ t('label_rag_chat_token_clear') }}</label>
                  </div>
                </div>
              </div>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatTemperature">{{ t('label_rag_chat_temperature') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="number"
                        step="0.01"
                        min="0"
                        max="2"
                        id="ragChatTemperature"
                        value="{{ settings.rag_chat_service_temperature|default('') }}"
                        placeholder="0.20"
                      >
                    </div>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatTopP">{{ t('label_rag_chat_top_p') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="number"
                        step="0.01"
                        min="0"
                        max="1"
                        id="ragChatTopP"
                        value="{{ settings.rag_chat_service_top_p|default('') }}"
                        placeholder="1.00"
                      >
                    </div>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-3@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatMaxTokens">{{ t('label_rag_chat_max_tokens') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="number"
                        step="1"
                        min="1"
                        id="ragChatMaxTokens"
                        value="{{ settings.rag_chat_service_max_tokens|default('') }}"
                        placeholder="300"
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-1 uk-width-1-2@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatPresencePenalty">{{ t('label_rag_chat_presence_penalty') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="number"
                        step="0.01"
                        min="-2"
                        max="2"
                        id="ragChatPresencePenalty"
                        value="{{ settings.rag_chat_service_presence_penalty|default('') }}"
                        placeholder="0.00"
                      >
                    </div>
                  </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                  <div class="uk-margin">
                    <label class="uk-form-label" for="ragChatFrequencyPenalty">{{ t('label_rag_chat_frequency_penalty') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="number"
                        step="0.01"
                        min="-2"
                        max="2"
                        id="ragChatFrequencyPenalty"
                        value="{{ settings.rag_chat_service_frequency_penalty|default('') }}"
                        placeholder="0.00"
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="uk-flex uk-flex-right uk-margin-top">
                <button type="submit" class="uk-button uk-button-primary">{{ t('action_save') }}</button>
              </div>
            </form>
          </li>
        </ul>
      </div>
    </li>
    <li class="{{ activeRoute == 'teams' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_teams') }}</h2>
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: event.name|default('')
        } %}
        <form id="teamSearchForm" class="uk-form uk-margin-medium-bottom" role="search">
          <label class="uk-form-label" for="teamSearch">{{ t('label_team_search') }}</label>
          <div class="uk-form-controls">
            <input
              id="teamSearch"
              class="uk-input"
              type="search"
              placeholder="{{ t('placeholder_team_search') }}"
              autocomplete="off"
              aria-controls="teamsList"
            >
          </div>
        </form>
        {% from 'components/table.twig' import qr_rowcards %}
        <div class="uk-overflow-auto uk-visible@m">
          <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
            <thead>
              <tr>
                <th class="uk-table-shrink"></th>
                <th data-key="name">{{ t('column_name') }}</th>
                <th class="uk-table-shrink">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody
              id="teamsList"
              data-label-name="{{ t('column_name') }}"
            ></tbody>
          </table>
        </div>
        {{ qr_rowcards('teamsCards') }}
        <div class="uk-margin uk-flex uk-flex-middle uk-flex-wrap">
          <button
            id="teamAddBtn"
            class="uk-icon-button uk-button-primary fab"
            uk-icon="plus"
            uk-tooltip="title: {{ t('tip_team_add') }}; pos: left"
            aria-label="{{ t('tip_team_add') }}"
            type="button"
          ></button>
          <button
            id="teamDeleteAllBtn"
            class="uk-button uk-button-danger uk-margin-small-left"
            type="button"
          >
            <span uk-icon="trash" aria-hidden="true"></span>
            <span class="uk-margin-small-left">{{ t('action_delete_all_teams') }}</span>
          </button>
        </div>
        <div id="teamDeleteAllModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h3 class="uk-modal-title">{{ t('heading_delete_all_teams') }}</h3>
            <p>{{ t('text_delete_all_teams_warning') }}</p>
            <div class="uk-text-right">
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
              <button id="teamDeleteAllConfirm" class="uk-button uk-button-danger" type="button">{{ t('action_delete') }}</button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'summary' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: event.name|default('')
        } %}
        <div class="uk-flex uk-flex-between uk-flex-middle" id="summaryEvent">
          <div>
            <h2 class="uk-heading-bullet" id="summaryEventName">{{ event.name }}</h2>
            <p id="summaryEventDesc">{{ event.description }}</p>
          </div>
          <div class="uk-text-center uk-margin-small-bottom">
            {% if event.uid %}
              <div class="summary-event-links uk-flex uk-flex-middle uk-flex-center uk-flex-column uk-flex-row@s">
                <div class="uk-margin-small-right@s uk-margin-small-bottom">
                  <img
                    id="summaryEventQr"
                    class="qr-img"
                    data-endpoint="/qr/event"
                    data-target="{{ eventUrl }}"
                    src="{{ basePath }}/qr/event?event={{ event.uid }}&t={{ eventUrl|url_encode }}&size=150&margin=40"
                    width="150"
                    height="150"
                    alt="QR"
                  >
                </div>
                <div class="uk-text-left@s uk-width-expand@s">
                  <div class="uk-text-meta uk-margin-small-bottom">{{ t('label_results_frontend_link') }}</div>
                  <code class="uk-display-block uk-text-break uk-background-muted uk-padding-small summary-results-code">{{ resultsUrl }}</code>
                  <a
                    class="uk-button uk-button-default uk-button-small uk-margin-small-top"
                    href="{{ resultsUrl }}"
                    target="_blank"
                    rel="noopener"
                  >
                    {{ t('action_results_open_frontend') }}
                  </a>
                </div>
              </div>
            {% endif %}
          </div>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_catalogs') }}</h3>
        <button id="openStickerEditorBtn" class="uk-button uk-button-default uk-margin-small-bottom">
          {{ t('action_catalog_stickers_pdf') }}
        </button>
        <div id="catalogStickerModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body" style="width: 800px;">
            <h2 class="uk-modal-title">Sticker-Editor</h2>

            <form id="catalogStickerForm" class="uk-form-stacked">
              <div class="uk-margin">
                <label class="uk-form-label" for="catalogStickerTemplate">{{ t('label_template') }}</label>
                <div class="uk-form-controls">
                  <select id="catalogStickerTemplate" class="uk-select">
                    <option value="avery_l7163">Avery L7163 (99.1×38.1)</option>
                    <option value="avery_l7165">Avery L7165 (99.1×67.7)</option>
                    <option value="avery_l7651">Avery L7651 (63.5×38.1)</option>
                    <option value="avery_l7992">Avery L7992 (210×41)</option>
                    <option value="avery_j8165">Avery J8165 (199.6×67.7)</option>
                    <option value="avery_l7168">Avery L7168 (199.6×143.5)</option>
                  </select>
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label">{{ t('label_qr_size_pct') }}</label>
                <input id="catalogStickerQrSizePct" type="range" min="10" max="80" step="1" class="uk-range">
              </div>
              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-2">
                  <label class="uk-form-label">{{ t('label_qr_color') }}</label>
                  <input id="catalogStickerQrColor" class="uk-input" type="color">
                </div>
                <div class="uk-width-1-2">
                  <label class="uk-form-label">{{ t('label_text_color') }}</label>
                  <input id="catalogStickerTextColor" class="uk-input" type="color">
                </div>
              </div>

              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-2">
                  <label class="uk-form-label" for="catalogStickerHeaderFontSize">{{ t('label_header_font_size') }}</label>
                  <div class="uk-form-controls uk-flex uk-flex-middle">
                    <input class="uk-checkbox uk-margin-right" id="catalogStickerPrintHeader" type="checkbox">
                    <input id="catalogStickerHeaderFontSize" class="uk-input" type="number">
                  </div>
                </div>
                <div class="uk-width-1-2">
                  <label class="uk-form-label" for="catalogStickerSubheaderFontSize">{{ t('label_subheader_font_size') }}</label>
                  <div class="uk-form-controls uk-flex uk-flex-middle">
                    <input class="uk-checkbox uk-margin-right" id="catalogStickerPrintSubheader" type="checkbox">
                    <input id="catalogStickerSubheaderFontSize" class="uk-input" type="number">
                  </div>
                </div>
              </div>

              <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-2">
                  <label class="uk-form-label" for="catalogStickerCatalogFontSize">{{ t('label_catalog_font_size') }}</label>
                  <div class="uk-form-controls uk-flex uk-flex-middle">
                    <input class="uk-checkbox uk-margin-right" id="catalogStickerPrintCatalog" type="checkbox">
                    <input id="catalogStickerCatalogFontSize" class="uk-input" type="number">
                  </div>
                </div>
                <div class="uk-width-1-2">
                  <label class="uk-form-label" for="catalogStickerDescFontSize">{{ t('label_desc_font_size') }}</label>
                  <div class="uk-form-controls uk-flex uk-flex-middle">
                    <input class="uk-checkbox uk-margin-right" id="catalogStickerPrintDesc" type="checkbox">
                    <input id="catalogStickerDescFontSize" class="uk-input" type="number">
                  </div>
                </div>
              </div>

              <div class="uk-margin">
                <label class="uk-form-label" for="catalogStickerBg">{{ t('label_sticker_bg') }}</label>
                <div class="uk-form-controls">
                  <div uk-form-custom>
                    <input type="file" id="catalogStickerBg" accept="image/png,image/jpeg,image/webp" hidden>
                    <input class="uk-input uk-form-small" id="catalogStickerBgName" type="text" readonly>
                    <button class="uk-button uk-button-default uk-form-small">Datei wählen</button>
                  </div>
                  <progress id="stickerBgProgress" class="uk-progress" value="0" max="100" hidden></progress>
                </div>
              </div>

              <div id="catalogStickerPreview" class="uk-margin uk-margin-auto uk-position-relative uk-border-rounded sticker-preview" style="width: 595px; height: 229px; background: #fff url('') center/100% 100% no-repeat; border:1px solid rgba(0,0,0,.1); padding: 0">
                <div id="stickerStage" class="sticker-stage">
                  <!-- B: TEXT-BOX -->
                  <div id="stickerTextBox" class="dragzone sticker-box" role="group" aria-label="Textfeld verschieben/größenändern">
                    <div class="drag-handle" aria-hidden="true" uk-icon="move"></div>
                    <div class="resize-handle" aria-hidden="true"></div>
                    <div class="preview-text" id="stickerTextPreview"></div>
                  </div>

                  <!-- A: QR-ZONE (quadratisch, resizable) -->
                  <div id="stickerQrHandle" class="dragzone dragzone--square sticker-box" role="group" aria-label="QR-Position verschieben">
                    <div class="drag-handle" aria-hidden="true" uk-icon="move"></div>
                    <div class="resize-handle" aria-hidden="true"></div>
                    <img id="qrPreview" alt="QR-Vorschau" />
                  </div>
                </div>

                <!-- Hidden: Prozentwerte relativ zum Sticker -->
                <input type="hidden" id="stickerDescTop"  name="stickerDescTop"  value="">
                <input type="hidden" id="stickerDescLeft" name="stickerDescLeft" value="">
                <input type="hidden" id="stickerDescW"    name="stickerDescWidth"  value="">
                <input type="hidden" id="stickerDescH"    name="stickerDescHeight" value="">

                <input type="hidden" id="stickerQrTop"  name="stickerQrTop"  value="">
                <input type="hidden" id="stickerQrLeft" name="stickerQrLeft" value="">
                <input type="hidden" id="stickerQrSize" name="stickerQrSizePct" value="">
              </div>

              <div class="uk-margin uk-flex uk-flex-right">
                <button type="button" class="uk-button uk-button-default" id="catalogStickerPdfCreateBtn">PDF erstellen</button>
              </div>
            </form>
          </div>
        </div>
        <div
          class="card-grid"
          uk-grid
          id="summaryCatalogs"
          data-summary-page-size="6"
          data-empty-text="{{ t('text_no_catalogs') }}"
        >
          {% for c in catalogs %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card qr-card uk-card-body">
              {% if event.uid %}
                {% set link = baseUrl ~ '/?event=' ~ event.uid ~ '&katalog=' ~ c.slug %}
              {% else %}
                {% set link = baseUrl ~ '/?katalog=' ~ c.slug %}
              {% endif %}
              <h4 class="uk-card-title"><a href="{{ link }}" target="_blank">{{ c.name }}</a></h4>
              <p>{{ c.description }}</p>
              <img class="qr-img" src="{{ basePath }}/qr/catalog?t={{ link|url_encode }}&size=150&margin=40" alt="QR">
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card qr-card uk-card-body">{{ t('text_no_catalogs') }}</div>
          </div>
          {% endfor %}
        </div>
        <div class="uk-margin-small" id="summaryCatalogsPager" hidden>
          <p class="uk-text-meta" id="summaryCatalogsMeta" aria-live="polite"></p>
          <button
            id="summaryCatalogsMore"
            class="uk-button uk-button-default uk-button-small uk-margin-small-top"
            type="button"
            hidden
          >
            {{ t('action_summary_load_more_catalogs') }}
          </button>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_teams') }}</h3>
        <div
          class="card-grid"
          uk-grid
          id="summaryTeams"
          data-summary-page-size="6"
          data-empty-text="{{ t('text_no_data') }}"
        >
          {% for t in teams %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card qr-card uk-card-body uk-position-relative">
              <button class="qr-print-btn uk-icon-button uk-position-top-right" data-team="{{ t }}" uk-icon="icon: print" aria-label="QR-Code drucken"></button>
              <h4 class="uk-card-title">{{ t }}</h4>
              {% if event.uid %}
                {% set link = baseUrl ? baseUrl ~ '/?event=' ~ event.uid ~ '&t=' ~ t : '?event=' ~ event.uid ~ '&t=' ~ t %}
              {% else %}
                {% set link = baseUrl ? baseUrl ~ '/?t=' ~ t : '?t=' ~ t %}
              {% endif %}
              <img
                class="qr-img"
                data-endpoint="/qr/team"
                data-target="{{ link }}"
                src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                alt="Team QR"
              >
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card qr-card uk-card-body">{{ t('text_no_data') }}</div>
          </div>
          {% endfor %}
        </div>
        <div class="uk-margin-small" id="summaryTeamsPager" hidden>
          <p class="uk-text-meta" id="summaryTeamsMeta" aria-live="polite"></p>
          <button
            id="summaryTeamsMore"
            class="uk-button uk-button-default uk-button-small uk-margin-small-top"
            type="button"
            hidden
          >
            {{ t('action_summary_load_more_teams') }}
          </button>
        </div>
        <div class="uk-margin" uk-grid>
          <div class="uk-width-1-1 uk-width-auto@m">
            <button id="inviteTextBtn" class="uk-button uk-button-default uk-margin-small-bottom uk-margin-right@m" type="button" uk-toggle="target: #inviteTextModal">
              <span id="inviteTextLabel">{{ t('action_invite_text') }}</span>
            </button>
          </div>
          <div class="uk-width-1-1 uk-width-expand@m">
            <div class="uk-flex uk-flex-wrap uk-flex-right@m">
              <button id="openInvitesBtn" class="uk-button uk-button-default uk-margin-small-bottom uk-margin-small-right" uk-tooltip="title: {{ t('tip_invitations_open') }}; pos: right" data-event-btn disabled>{{ t('action_open_invitations') }}</button>
              <button id="summaryPrintBtn" class="uk-button uk-button-default uk-margin-small-bottom uk-margin-small-right" uk-tooltip="title: {{ t('tip_summary_print') }}; pos: right">{{ t('action_print_summary') }}</button>
              <button id="summaryTeamQrLoadBtn" class="uk-button uk-button-default uk-margin-small-bottom uk-margin-small-right" type="button" disabled>{{ t('action_summary_generate_team_qr') }}</button>
              <button id="summaryDesignAllBtn" class="uk-button uk-button-default uk-margin-small-bottom" type="button">{{ t('action_design_qrcodes') }}</button>
            </div>
          </div>
        </div>
        <div id="inviteTextModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
          <h2 class="uk-modal-title">{{ t('heading_invite_text') }}</h2>
            <div id="inviteTextToolbar" class="uk-margin-small-bottom">
              <div class="uk-inline">
                <button class="uk-button uk-button-default" type="button">
                  Tags <span uk-icon="icon: triangle-down"></span>
                </button>
                <div uk-dropdown="mode: click">
                  <ul class="uk-nav uk-dropdown-nav">
                    <li><button class="uk-button uk-button-text" type="button" data-format="h2">H2</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h3">H3</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h4">H4</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h5">H5</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="bold"><strong>B</strong></button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="italic"><em>I</em></button></li>
                  </ul>
                </div>
              </div>
              <button class="uk-button uk-button-default" type="button" data-insert="[TEAM]">[TEAM]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_NAME]">[EVENT_NAME]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_START]">[EVENT_START]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_END]">[EVENT_END]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_DESCRIPTION]">[EVENT_DESCRIPTION]</button>
            </div>
            <textarea id="inviteTextTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_invite_text') }}"></textarea>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="inviteTextSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
        <div id="qrDesignModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">QR-Design</h2>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrLabelInput">Label</label>
              <textarea class="uk-textarea" id="qrLabelInput" rows="2"></textarea>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrColorInput">{{ t('label_qr_color') }}</label>
              <input class="uk-input" id="qrColorInput" type="color">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrBgColorInput">{{ t('label_qr_bg_color') }}</label>
              <input class="uk-input" id="qrBgColorInput" type="color" value="#ffffff">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrSizeInput">{{ t('label_qr_size') }}</label>
              <input class="uk-input" id="qrSizeInput" type="number" min="64" max="2048">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrMarginInput">{{ t('label_qr_margin') }}</label>
              <input class="uk-input" id="qrMarginInput" type="number" min="0" max="40">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrEcSelect">{{ t('label_qr_ec') }}</label>
              <select class="uk-select" id="qrEcSelect">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="quartile">Quartile</option>
                <option value="high">High</option>
              </select>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrLogoFile">{{ t('label_custom_logo') }}</label>
              <input class="uk-input" id="qrLogoFile" type="file" accept="image/png,image/webp">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrLogoWidthInput">Logo-Größe</label>
              <input class="uk-input" id="qrLogoWidthInput" type="number" min="20" max="200">
            </div>
            <div class="uk-margin">
              <label><input class="uk-checkbox" id="qrPunchoutInput" type="checkbox"> Logo-Hintergrund ausstanzen</label>
            </div>
            <div class="uk-margin">
              <label><input class="uk-checkbox" id="qrRoundedInput" type="checkbox"> Runde Marker</label>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrRoundModeSelect">Rundungsmodus</label>
              <select class="uk-select" id="qrRoundModeSelect">
                <option value="margin">Margin</option>
                <option value="enlarge">Enlarge</option>
                <option value="shrink">Shrink</option>
                <option value="none">None</option>
              </select>
            </div>
            <div class="uk-margin uk-text-center">
              <img id="qrDesignPreview" src="" alt="Preview" width="150" height="150">
            </div>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="qrDesignApply" class="uk-button uk-button-primary" type="button">Übernehmen</button>
              <button class="uk-button uk-button-default uk-modal-close uk-margin-small-left" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
        </div>
      </li>
    <li class="{{ activeRoute == 'results' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: event.name|default('')
        } %}
        <div class="uk-flex uk-flex-middle uk-flex-column uk-flex-row@s uk-flex-between@s">
          <h2 class="uk-heading-bullet">{{ t('heading_results') }}</h2>
          <div class="uk-flex uk-flex-middle uk-margin-small-top uk-margin-remove-top@s">
            <div class="uk-margin-right">
              <input
                id="resultsFilter"
                class="uk-input uk-form-width-medium"
                type="search"
                placeholder="{{ t('placeholder_results_search') }}"
                aria-label="{{ t('placeholder_results_search') }}"
                list="resultsFilterList"
                autocomplete="off"
              >
              <datalist id="resultsFilterList"></datalist>
            </div>
            <button id="resultsRefreshBtn" class="uk-icon-button" uk-icon="icon: refresh; ratio: 1.2" title="{{ t('action_refresh') }}" aria-label="{{ t('action_refresh') }}" data-event-btn disabled></button>
          </div>
        </div>
        <div id="rankingGrid" class="uk-grid-small uk-child-width-1-1 uk-child-width-1-2@s uk-child-width-expand@m uk-margin-bottom" uk-grid uk-height-match="target: > div > .uk-card"></div>
        {% set resultsRows %}
          {% for r in results %}
          <tr>
            <td class="qr-cell">{{ r.name }}</td>
            <td class="qr-cell">{{ r.attempt }}</td>
            <td class="qr-cell">{{ r.catalogName ?? r.catalog }}</td>
            <td class="qr-cell">{{ r.correct }}/{{ r.total }}</td>
            <td class="qr-cell">{{ r.points ?? r.correct ?? 0 }}/{{ r.max_points ?? 0 }}</td>
            <td class="qr-cell">{{ r.points ?? r.correct ?? 0 }}/{{ r.max_points ?? 0 }}</td>
            <td class="qr-cell">&ndash;</td>
            <td class="qr-cell">{{ r.time | date('Y-m-d H:i') }}</td>
            <td class="qr-cell">{% if r.puzzleTime is defined and r.puzzleTime is not null and r.puzzleTime > 0 %}{{ r.puzzleTime | date('Y-m-d H:i') }}{% else %}&ndash;{% endif %}</td>
            <td class="qr-cell">{% if r.photo is defined and r.photo %}<span class="photo-wrapper"><a class="uk-inline rotate-link" href="{{ basePath ~ r.photo }}" data-caption='<button class="uk-icon-button lightbox-rotate-btn" type="button" uk-icon="history" data-path="{{ basePath ~ r.photo }}" aria-label="Drehen"></button>' data-attrs="class: uk-inverse-light"><img src="{{ basePath ~ r.photo }}" alt="Beweisfoto" class="proof-thumb"></a></span>{% endif %}</td>
          </tr>
          {% else %}
          <tr><td colspan="10">{{ t('text_no_data') }}</td></tr>
          {% endfor %}
        {% endset %}
        <div uk-lightbox="nav: thumbnav; slidenav: false">
          <div class="uk-overflow-auto">
            <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
              <thead>
                <tr>
                  <th>{{ t('column_name') }}</th>
                  <th>{{ t('column_attempt') }}</th>
                  <th>{{ t('column_catalog') }}</th>
                  <th>{{ t('column_correct') }}</th>
                  <th>{{ t('column_points') }}</th>
                  <th>{{ t('column_final_points') }}</th>
                  <th>{{ t('column_avg_efficiency') }}</th>
                  <th>{{ t('column_time') }}</th>
                  <th>{{ t('column_puzzle_solved') }}</th>
                  <th>{{ t('column_proof_photo') }}</th>
                </tr>
              </thead>
              <tbody id="resultsTableBody">
                {{ resultsRows|raw }}
              </tbody>
            </table>
          </div>
        </div>
        <ul id="resultsPagination" class="uk-pagination uk-flex-center"></ul>
        {% set showReset = role == 'admin' %}
        {% set showDownloads = role in ['admin','analyst'] %}
        {% if showReset or showDownloads %}
        <div class="uk-margin uk-flex {% if showReset and showDownloads %}uk-flex-between{% elseif showDownloads %}uk-flex-right{% endif %}">
          {% if showReset %}
          <button id="resultsResetBtn" class="uk-button uk-button-default" uk-tooltip="title: {{ t('tip_results_reset') }}; pos: right">{{ t('action_reset') }}</button>
          {% endif %}
          {% if showDownloads %}
          <div class="uk-flex">
            <button id="resultsPdfBtn" class="uk-button uk-button-primary uk-margin-right" uk-tooltip="title: {{ t('tip_results_pdf') }}; pos: right">{{ t('action_open_evaluation') }}</button>
            <button id="resultsDownloadBtn" class="uk-button uk-button-primary" uk-tooltip="title: {{ t('tip_results_download') }}; pos: right">{{ t('action_download') }}</button>
          </div>
          {% endif %}
        </div>
        {% endif %}

        {% if showReset %}
        <div id="resultsResetModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <p>Beim Zurücksetzen der Statistik werden auch alle hochgeladenen Beweisfotos unwiderruflich gelöscht. Dieser Vorgang kann nicht rückgängig gemacht werden.<br>Soll die Statistik nun zurückgesetzt werden?</p>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="resultsResetConfirm" class="uk-button uk-button-danger" type="button">{{ t('action_delete') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </li>
    <li class="{{ activeRoute == 'statistics' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        {% include 'admin/components/event_controls.twig' with {
          currentEventUid: config.event_uid|default(''),
          currentEventName: event.name|default('')
        } %}
        <div class="uk-flex uk-flex-middle uk-flex-column uk-flex-row@s uk-flex-between@s">
          <h2 class="uk-heading-bullet">{{ t('heading_statistics') }}</h2>
          <div class="uk-flex uk-flex-middle uk-margin-small-top uk-margin-remove-top@s">
            <div class="uk-margin-right">
              <input
                id="statsFilter"
                class="uk-input uk-form-width-medium"
                type="search"
                placeholder="{{ t('placeholder_statistics_search') }}"
                aria-label="{{ t('placeholder_statistics_search') }}"
                list="statsFilterList"
                autocomplete="off"
              >
              <datalist id="statsFilterList"></datalist>
            </div>
            <button id="statsRefreshBtn" class="uk-icon-button" uk-icon="icon: refresh; ratio: 1.2" title="{{ t('action_refresh') }}" aria-label="{{ t('action_refresh') }}"></button>
          </div>
        </div>
        <div uk-lightbox="nav: thumbnav; slidenav: false">
          <div class="uk-overflow-auto">
            <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
              <thead>
                <tr>
                  <th>{{ t('column_name') }}</th>
                  <th>{{ t('column_attempt') }}</th>
                  <th>{{ t('column_catalog') }}</th>
                  <th>{{ t('column_question') }}</th>
                  <th>{{ t('column_answer') }}</th>
                  <th>{{ t('column_correct') }}</th>
                  <th>{{ t('column_points') }}</th>
                  <th>{{ t('column_final_points') }}</th>
                  <th>{{ t('column_efficiency') }}</th>
                  <th>{{ t('column_proof_photo') }}</th>
                </tr>
              </thead>
              <tbody id="statsTableBody"></tbody>
            </table>
          </div>
        </div>
        <ul id="statsPagination" class="uk-pagination uk-flex-center"></ul>
      </div>
    </li>
      {% if role == 'admin' %}
      <li class="{{ activeRoute == 'pages' ? 'uk-active' }}">
        <div class="uk-container uk-container-large">
          <h2 class="uk-heading-bullet">{{ t('heading_pages') }}</h2>
          {% set activePageNamespace = pageNamespace|default('default') %}
          {% set pageNamespaceQuery = activePageNamespace is not empty ? '?namespace=' ~ activePageNamespace|url_encode : '' %}
          {% set pageNamespaceOptions = available_namespaces|default([]) %}
          {% if pageNamespaceOptions is empty %}
            {% set pageNamespaceOptions = [{
              namespace: activePageNamespace,
              label: null,
              is_active: true
            }] %}
          {% endif %}
          <div class="uk-card uk-card-default uk-card-body uk-margin-small">
            <div class="uk-grid-small uk-flex-middle" uk-grid>
              <div class="uk-width-1-1 uk-width-expand@m">
                <label class="uk-form-label" for="pageNamespaceSelect">{{ t('label_project_namespace') }}</label>
                <div class="uk-form-controls">
                  <select
                    id="pageNamespaceSelect"
                    class="uk-select"
                    data-page-namespace="{{ activePageNamespace|e('html_attr') }}"
                  >
                    {% for entry in pageNamespaceOptions %}
                      {% set entryNamespace = entry.namespace|default('') %}
                      {% set entryLabel = entry.label|default('') %}
                      {% set entryIsInactive = entry.is_active is defined and not entry.is_active %}
                      <option
                        value="{{ entryNamespace|e('html_attr') }}"
                        {% if entryNamespace == activePageNamespace %}selected{% endif %}
                      >
                        {{ entryNamespace }}
                        {% if entryLabel is not empty %} – {{ entryLabel }}{% endif %}
                        {% if entryIsInactive %} – inaktiv{% endif %}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="uk-width-auto uk-text-meta uk-margin-small-top uk-margin-remove-top@m">
                Wechsel lädt die Inhalte des ausgewählten Namespace neu.
              </div>
            </div>
          </div>
          {% include 'admin/components/project_tree.twig' %}
          {% set currentPageTab = pageTab|default('seo') %}
          <ul id="pageTabs" class="uk-tab" uk-tab="connect: #pageSwitcher">
            <li class="{{ currentPageTab == 'seo' ? 'uk-active' }}" data-page-tab="seo"><a href="#">{{ t('tab_landingpage_seo') }}</a></li>
            <li class="{{ currentPageTab == 'content' ? 'uk-active' }}" data-page-tab="content"><a href="#">{{ t('tab_landingpage_content') }}</a></li>
            <li class="{{ currentPageTab == 'wiki' ? 'uk-active' }}" data-page-tab="wiki"><a href="#">Wiki</a></li>
            <li class="{{ currentPageTab == 'landing-news' ? 'uk-active' }}" data-page-tab="landing-news"><a href="#">{{ t('tab_landing_news') }}</a></li>
          </ul>
          <ul id="pageSwitcher" class="uk-switcher uk-margin">
            <li class="{{ currentPageTab == 'seo' ? 'uk-active' }}">
              {% if seo_pages|default([]) is empty %}
                <div class="uk-alert uk-alert-warning">{{ t('text_no_marketing_pages') }}</div>
              {% else %}
              <form class="uk-form-stacked seo-form" action="{{ basePath }}/admin/landingpage/seo{{ pageNamespaceQuery }}" method="post">
                <input type="hidden" name="pageId" value="{{ seo_config.pageId|default(selectedSeoPageId|default('')) }}">
                <input type="hidden" name="domain" id="seoDomain" value="{{ seo_config.domain|default('') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="uk-margin">
                  <label class="uk-form-label" for="seoPageSelect">Marketing-Seite</label>
                  <div class="uk-form-controls">
                    <select
                      id="seoPageSelect"
                      class="uk-select"
                      data-configs="{{ seo_pages|json_encode|e('html_attr') }}"
                      data-selected="{{ selectedSeoPageId|default(seo_config.pageId|default('')) }}"
                    >
                      {% for page in seo_pages %}
                        <option
                          value="{{ page.id }}"{% if page.id == selectedSeoPageId %} selected{% endif %}
                          data-slug="{{ page.slug }}"
                          data-title="{{ page.title }}"
                        >
                          {{ page.title }} ({{ page.slug }})
                        </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="metaTitle">Meta Title</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="metaTitle" name="meta_title" type="text" required data-maxlength="60" value="{{ seo_config.metaTitle|default('') }}">
                    <small class="uk-text-meta char-count" data-for="metaTitle">0/60</small>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="metaDescription">Meta Description</label>
                  <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="metaDescription" name="meta_description" required data-maxlength="160">{{ seo_config.metaDescription|default('') }}</textarea>
                    <small class="uk-text-meta char-count" data-for="metaDescription">0/160</small>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="slug">Slug</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="slug" name="slug" type="text" required data-maxlength="100" value="{{ seo_config.slug|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="canonical">Canonical</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="canonical" name="canonical" type="url" value="{{ seo_config.canonicalUrl|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="robots">Robots</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="robots" name="robots" type="text" placeholder="index, follow" value="{{ seo_config.robotsMeta|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label">OG-Tags</label>
                  <div class="uk-form-controls">
                    <input class="uk-input uk-margin-small-bottom" id="ogTitle" name="og_title" type="text" placeholder="og:title" data-maxlength="60" value="{{ seo_config.ogTitle|default('') }}">
                    <input class="uk-input uk-margin-small-bottom" id="ogDescription" name="og_description" type="text" placeholder="og:description" data-maxlength="160" value="{{ seo_config.ogDescription|default('') }}">
                    <input class="uk-input" id="ogImage" name="og_image" type="url" placeholder="og:image" value="{{ seo_config.ogImage|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="schema">Schema.org</label>
                  <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="schema" name="schema" rows="4" placeholder="{ }">{{ seo_config.schemaJson|default('') }}</textarea>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="hreflang">hreflang</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="hreflang" name="hreflang" type="text" placeholder="de, en, ..." value="{{ seo_config.hreflang|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <button type="button" class="uk-button uk-button-default import-seo-example">Beispiel importieren</button>
                  <button type="submit" class="uk-button uk-button-primary uk-margin-left">Speichern</button>
                </div>
              </form>
              {% endif %}
            </li>
            <li class="{{ currentPageTab == 'content' ? 'uk-active' }}">
              {% if pages|default([]) is empty %}
                <div class="uk-alert uk-alert-warning">{{ t('text_no_marketing_pages') }}</div>
              {% else %}
                {% include 'admin/components/page_tree.twig' %}
                {% set selectedSlug = selectedPageSlug|default('') %}
                {% if selectedSlug == '' and pages|length > 0 %}
                  {% set selectedSlug = (pages|first).slug %}
                {% endif %}
                {% set excludedLandingSlugs = ['impressum', 'datenschutz', 'faq', 'lizenz'] %}
                <div class="uk-flex uk-flex-middle uk-margin-small-bottom uk-flex-wrap">
                  <div class="uk-width-1-1 uk-width-expand@m uk-margin-small-bottom">
                    <label class="uk-form-label" for="pageContentSelect">Marketing-Seite</label>
                    <div class="uk-form-controls">
                      <select
                        id="pageContentSelect"
                        class="uk-select"
                        data-selected="{{ selectedSlug }}"
                        data-excluded-landing="{{ excludedLandingSlugs|join(',') }}"
                      >
                        {% for page in pages %}
                          {% set pageLabel = page.title is not empty ? page.title : page.slug|replace({'-': ' '})|title %}
                          <option
                            value="{{ page.slug }}"
                            {% if page.slug == selectedSlug %}selected{% endif %}
                          >{{ pageLabel }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <div class="uk-margin-small-left">
                    <button
                      class="uk-button uk-button-default"
                      type="button"
                      uk-toggle="target: #createPageModal"
                    >Neue Seite</button>
                  </div>
                </div>
                <div id="pageFormsContainer">
                  {% for page in pages %}
                  <form
                    class="page-form{% if page.slug != selectedSlug %} uk-hidden{% endif %}"
                    data-slug="{{ page.slug }}"
                    data-landing="{{ page.slug not in excludedLandingSlugs ? 'true' : 'false' }}"
                  >
                    <input type="hidden" id="page_{{ page.slug }}" name="content" value="{{ page.content|e('html_attr') }}">
                    <div class="page-editor" data-content="{{ page.content|e('html_attr') }}"></div>
                    <div class="uk-margin-top">
                      <button class="uk-button uk-button-primary save-page-btn" type="button">Speichern</button>
                      <a
                        class="uk-button uk-button-default uk-margin-small-left preview-link"
                        href="{{ basePath }}/{{ page.slug }}{{ pageNamespaceQuery }}"
                        target="_blank"
                      >Vorschau</a>
                      <button class="uk-button uk-button-danger uk-margin-small-left delete-page-btn" type="button">{{ t('action_delete') }}</button>
                    </div>
                  </form>
                  {% endfor %}
                </div>
                <div id="createPageModal" uk-modal>
                  <div class="uk-modal-dialog uk-modal-body">
                    <h2 class="uk-modal-title">Neue Seite anlegen</h2>
                    <form id="createPageForm" class="uk-form-stacked">
                      <div id="createPageFeedback" class="uk-alert uk-alert-danger" hidden></div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="newPageSlug">Slug</label>
                        <div class="uk-form-controls">
                          <input class="uk-input" id="newPageSlug" name="slug" type="text" required maxlength="100" placeholder="z. B. neue-landingpage">
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="newPageTitle">Titel</label>
                        <div class="uk-form-controls">
                          <input class="uk-input" id="newPageTitle" name="title" type="text" required placeholder="Seitentitel">
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="newPageContent">Initiales HTML (optional)</label>
                        <div class="uk-form-controls">
                          <textarea class="uk-textarea" id="newPageContent" name="content" rows="6" placeholder="&lt;section class=&quot;uk-section&quot;&gt;...&lt;/section&gt;"></textarea>
                        </div>
                      </div>
                      <div class="uk-flex uk-flex-right">
                        <button type="submit" class="uk-button uk-button-primary">Seite erstellen</button>
                        <button type="button" class="uk-button uk-button-default uk-margin-small-left uk-modal-close">Abbrechen</button>
                      </div>
                    </form>
                  </div>
                </div>
              {% endif %}
            </li>
            <li class="{{ currentPageTab == 'wiki' ? 'uk-active' }}">
              {% if pages|default([]) is empty %}
                <div class="uk-alert uk-alert-warning">{{ t('text_no_marketing_pages') }}</div>
              {% else %}
                {% set initialWikiPageId = selectedSeoPageId|default(pages|first.id|default(0)) %}
                <div
                  class="wiki-manager"
                  data-wiki-manager
                  data-base-path="{{ basePath }}"
                  data-namespace="{{ activePageNamespace|e('html_attr') }}"
                  data-pages="{{ pages|json_encode|e('html_attr') }}"
                  data-selected-page-id="{{ initialWikiPageId }}"
                >
                  <div class="uk-alert uk-alert-primary" data-wiki-feedback hidden role="status"></div>
                  <div class="uk-grid-small uk-flex-middle uk-flex-wrap" uk-grid>
                    <div class="uk-width-1-1 uk-width-expand@m">
                      <label class="uk-form-label" for="wikiPageSelect">Marketing-Seite</label>
                      <div class="uk-form-controls">
                        <select id="wikiPageSelect" class="uk-select" data-wiki-page-select>
                          {% for page in pages %}
                            {% set pageLabel = page.title is not empty ? page.title : page.slug|replace({'-': ' '})|title %}
                            <option
                              value="{{ page.id }}"
                              data-slug="{{ page.slug }}"
                              {% if page.id == initialWikiPageId %}selected{% endif %}
                            >
                              {{ pageLabel }} ({{ page.slug }})
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="uk-width-auto uk-margin-small-top uk-margin-remove-top@m">
                      <span class="uk-text-meta" data-wiki-selected-slug></span>
                    </div>
                  </div>

                  <div class="uk-card uk-card-default uk-card-body uk-margin" data-wiki-settings hidden>
                    <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
                      <h3 class="uk-card-title uk-margin-remove">Wiki-Einstellungen</h3>
                      <span class="uk-text-meta" data-wiki-settings-updated></span>
                    </div>
                    <form class="uk-form-stacked" data-wiki-settings-form>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiActive">Wiki im Menü aktivieren</label>
                        <div class="uk-form-controls">
                          <label class="uk-form-label uk-flex uk-flex-middle" style="gap: 8px;">
                            <input class="uk-checkbox" type="checkbox" id="wikiActive" data-wiki-active>
                            <span>Artikel-Liste im Marketing-Menü anzeigen</span>
                          </label>
                          <p class="uk-text-meta uk-margin-small-top">
                            Ist der Schalter deaktiviert, erscheinen veröffentlichte Artikel nicht in der Navigation.
                          </p>
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label">Menülabel</label>
                        <ul class="uk-tab" uk-tab>
                          <li><a href="#">DE</a></li>
                          <li><a href="#">EN</a></li>
                        </ul>
                        <ul class="uk-switcher uk-margin-small-top">
                          <li>
                            <input class="uk-input" type="text" data-wiki-menu-label-locale="de" maxlength="80" placeholder="z. B. Dokumentation">
                          </li>
                          <li>
                            <input class="uk-input" type="text" data-wiki-menu-label-locale="en" maxlength="80" placeholder="e.g. Documentation">
                          </li>
                        </ul>
                        <p class="uk-text-meta uk-margin-small-top">Optional – Standard ist „Dokumentation“.</p>
                      </div>
                      <div class="uk-flex uk-flex-right uk-flex-middle" style="gap: 12px;">
                        <button type="submit" class="uk-button uk-button-primary" data-wiki-settings-submit>Einstellungen speichern</button>
                      </div>
                    </form>
                  </div>

                  <div class="uk-card uk-card-default uk-card-body uk-margin" data-wiki-articles hidden>
                    <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap">
                      <h3 class="uk-card-title uk-margin-remove">Wiki-Artikel</h3>
                      <div class="uk-flex uk-flex-middle uk-flex-wrap" style="gap: 8px;">
                        <label class="uk-form-label uk-margin-remove" for="wikiLocaleFilter">Locale</label>
                        <select id="wikiLocaleFilter" class="uk-select uk-form-small" data-wiki-locale-filter>
                          <option value="all">Alle</option>
                        </select>
                        <button type="button" class="uk-button uk-button-default" data-wiki-upload>Markdown importieren</button>
                        <input
                          type="file"
                          accept=".md,.markdown,text/markdown"
                          hidden
                          data-wiki-upload-input
                        >
                        <button type="button" class="uk-button uk-button-primary" data-wiki-create>Artikel erstellen</button>
                      </div>
                    </div>
                    <p class="uk-text-meta uk-margin-small">Artikel können nach Locale gefiltert und in der Reihenfolge angepasst werden.</p>
                    <div class="uk-alert uk-alert-warning" data-wiki-articles-empty hidden>Für diese Auswahl sind keine Artikel vorhanden.</div>
                    <div class="uk-overflow-auto admin-table-wrapper">
                      <table class="uk-table uk-table-divider uk-table-small uk-table-hover">
                        <thead>
                          <tr>
                            <th>Titel</th>
                            <th>Locale</th>
                            <th>Status</th>
                            <th>Veröffentlicht</th>
                            <th class="uk-table-shrink">Reihenfolge</th>
                            <th class="uk-table-shrink">Aktionen</th>
                          </tr>
                        </thead>
                        <tbody data-wiki-article-list>
                          <tr data-wiki-loading-row>
                            <td colspan="6">Lädt…</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <div id="wikiArticleModal" class="uk-modal" uk-modal>
                  <div class="uk-modal-dialog uk-modal-body">
                    <button class="uk-modal-close-default" type="button" uk-close></button>
                    <h2 class="uk-modal-title" data-wiki-modal-title>Artikel bearbeiten</h2>
                    <div class="uk-alert uk-alert-danger" data-wiki-article-error hidden></div>
                    <form class="uk-form-stacked" data-wiki-article-form>
                      <input type="hidden" data-wiki-article-id>
                      <div class="uk-grid-small" uk-grid>
                        <div class="uk-width-1-2@m">
                          <div class="uk-margin">
                            <label class="uk-form-label" for="wikiArticleLocale">Locale</label>
                            <div class="uk-form-controls">
                              <input class="uk-input" id="wikiArticleLocale" type="text" data-wiki-article-locale required maxlength="10" placeholder="de">
                            </div>
                          </div>
                        </div>
                        <div class="uk-width-1-2@m">
                          <div class="uk-margin">
                            <label class="uk-form-label" for="wikiArticleStatus">Status</label>
                            <div class="uk-form-controls">
                              <select class="uk-select" id="wikiArticleStatus" data-wiki-article-status>
                                <option value="draft">Entwurf</option>
                                <option value="published">Veröffentlicht</option>
                                <option value="archived">Archiviert</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiArticleTitle">Titel</label>
                        <div class="uk-form-controls">
                          <input class="uk-input" id="wikiArticleTitle" type="text" data-wiki-article-title required maxlength="160">
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiArticleSlug">Slug</label>
                        <div class="uk-form-controls">
                          <input class="uk-input" id="wikiArticleSlug" type="text" data-wiki-article-slug required maxlength="120" placeholder="z. B. quickstart">
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiArticleExcerpt">Kurzbeschreibung</label>
                        <div class="uk-form-controls">
                          <textarea class="uk-textarea" id="wikiArticleExcerpt" rows="3" data-wiki-article-excerpt maxlength="280" placeholder="Teasertext für die Übersicht"></textarea>
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiArticleStart">Startdokument</label>
                        <div class="uk-form-controls">
                          <label class="uk-flex uk-flex-middle" style="gap: 8px;">
                            <input class="uk-checkbox" id="wikiArticleStart" type="checkbox" data-wiki-article-start>
                            <span>Als erstes Dokument anzeigen (z. B. Inhaltsverzeichnis)</span>
                          </label>
                          <p class="uk-text-meta uk-margin-small-top">Pro Locale kann nur ein Startdokument aktiv sein.</p>
                        </div>
                      </div>
                      <div class="uk-margin">
                        <label class="uk-form-label" for="wikiArticleContent">Inhalt (Markdown)</label>
                        <div class="uk-form-controls">
                          <textarea class="uk-textarea" id="wikiArticleContent" rows="14" data-wiki-article-content placeholder="# Überschrift\nAbsätze werden durch Leerzeilen getrennt."></textarea>
                        </div>
                        <p class="uk-text-meta uk-margin-small-top">Unterstützt einfache Markdown-Syntax, die beim Speichern in Wiki-Blöcke umgewandelt wird.</p>
                      </div>
                      <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-top uk-flex-wrap" style="gap: 12px;">
                        <span class="uk-text-meta" data-wiki-article-updated></span>
                        <div class="uk-flex uk-flex-right uk-flex-middle" style="gap: 8px;">
                          <button type="submit" class="uk-button uk-button-primary" data-wiki-article-submit>Speichern</button>
                          <button type="button" class="uk-button uk-button-default uk-modal-close">Abbrechen</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              {% endif %}
            </li>
            <li class="{{ currentPageTab == 'landing-news' ? 'uk-active' }}">
              <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom uk-flex-wrap">
                <h3 class="uk-heading-bullet uk-margin-remove">{{ t('heading_landing_news') }}</h3>
                <a class="uk-button uk-button-primary uk-margin-small-top uk-margin-remove-top@s" href="{{ basePath }}/admin/landing-news/create{{ pageNamespaceQuery }}">{{ t('button_add_news') }}</a>
              </div>
              {% include 'admin/landing_news/_list.twig' with {
                entries: landingNewsEntries|default([]),
                status: landingNewsStatus|default(''),
                csrfToken: csrf_token,
                pageNamespace: activePageNamespace
              } %}
              <div class="uk-margin-large-top">
                <h3 class="uk-heading-bullet">Projekt → Newsletter</h3>
                <p class="uk-text-meta">Projekt → Newsletter</p>
                <p class="uk-text-meta">{{ t('text_marketing_newsletter_namespace_hint')|format(marketingNewsletterNamespace) }}</p>
                <div
                  id="marketingNewsletterConfigSection"
                  class="uk-card uk-card-default uk-card-body uk-margin"
                  data-marketing-namespace="{{ marketingNewsletterNamespace|e('html_attr') }}"
                >
                  <div class="uk-margin">
                    <label class="uk-form-label" for="marketingNewsletterSlug">{{ t('label_marketing_newsletter_slug') }}</label>
                    <div class="uk-form-controls">
                      <input class="uk-input" type="text" id="marketingNewsletterSlug" list="marketingNewsletterSlugOptions" placeholder="landing">
                      <datalist id="marketingNewsletterSlugOptions">
                        {% for slug in marketingNewsletterSlugs %}
                          <option value="{{ slug }}"></option>
                        {% endfor %}
                      </datalist>
                    </div>
                    <p class="uk-text-meta uk-margin-small-top">{{ t('text_marketing_newsletter_slug_hint') }}</p>
                  </div>
                  <div class="uk-overflow-auto uk-margin">
                    <table class="uk-table uk-table-small uk-table-divider uk-table-middle" id="marketingNewsletterConfigTable" data-empty="{{ t('text_marketing_newsletter_empty') }}">
                      <thead>
                        <tr>
                          <th class="uk-table-shrink">#</th>
                          <th>{{ t('label_marketing_newsletter_label') }}</th>
                          <th>{{ t('label_marketing_newsletter_url') }}</th>
                          <th class="uk-table-shrink">{{ t('label_marketing_newsletter_style') }}</th>
                          <th class="uk-table-shrink uk-text-center">{{ t('column_actions') }}</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                  <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap" style="gap: 12px;">
                    <div class="uk-flex uk-flex-left" style="gap: 8px;">
                      <button type="button" id="marketingNewsletterAddRow" class="uk-button uk-button-default">{{ t('button_marketing_newsletter_add_entry') }}</button>
                    </div>
                    <div class="uk-flex uk-flex-right" style="gap: 8px;">
                      <button type="button" id="marketingNewsletterReset" class="uk-button uk-button-default">{{ t('action_reset') }}</button>
                      <button type="button" id="marketingNewsletterSave" class="uk-button uk-button-primary">{{ t('action_save') }}</button>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </li>
      <li class="{{ activeRoute == 'logins' ? 'uk-active' }}">
        <div class="uk-container uk-container-large">
          <h2 class="uk-heading-bullet">{{ t('menu_admin_logins') }}</h2>

          <h3 id="registration" class="uk-heading-bullet">{{ t('heading_registration') }}</h3>
          <div class="uk-margin uk-flex uk-flex-middle">
            <label>
              <input
                class="uk-checkbox"
                type="checkbox"
                id="cfgRegistrationEnabled"
                {% if settings.registration_enabled == '1' %}checked{% endif %}
              >
              {{ t('label_registration_enabled') }}
            </label>
          </div>

          <h3 id="users" class="uk-heading-bullet">{{ t('heading_users') }}</h3>
          <p class="uk-text-meta">Namespaces werden zentral verwaltet.</p>
          {% from 'components/table.twig' import qr_rowcards %}
          <div class="uk-overflow-auto uk-visible@m">
            <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive">
              <thead>
                <tr>
                  <th class="uk-table-shrink"></th>
                  <th data-key="username">{{ t('column_username') }}</th>
                  <th data-key="role">{{ t('column_role') }}</th>
                  <th data-key="namespaces">{{ t('column_namespaces') }}</th>
                  <th data-key="active" class="uk-table-shrink">{{ t('column_active') }}</th>
                  <th class="uk-table-shrink uk-text-right">{{ t('column_actions') }}</th>
                </tr>
              </thead>
              <tbody
                id="usersList"
                data-label-username="{{ t('column_username') }}"
                data-label-role="{{ t('column_role') }}"
                data-label-namespaces="{{ t('column_namespaces') }}"
                data-label-active="{{ t('column_active') }}"
              ></tbody>
            </table>
          </div>
          {{ qr_rowcards('usersCards') }}
          <ul id="usersPagination" class="uk-pagination uk-flex-center uk-margin-top"></ul>
          <template id="userRoleSelect">
            <select class="uk-select">
              {% for role in roles %}
                <option value="{{ role }}">{{ role }}</option>
              {% endfor %}
            </select>
          </template>
          <div class="uk-margin">
            <button
              id="userAddBtn"
              class="uk-icon-button uk-button-default"
              uk-icon="plus"
              uk-tooltip="title: {{ t('tip_user_add') }}; pos: right"
              aria-label="{{ t('tip_user_add') }}"
            ></button>
          </div>
          <div id="userNameModal" uk-modal>
            <div class="uk-modal-dialog uk-modal-body">
              <h2 class="uk-modal-title">{{ t('heading_username_modal') }}</h2>
              <form id="userNameForm">
                <div class="uk-margin">
                  <input
                    id="userNameInput"
                    class="uk-input"
                    type="text"
                    placeholder="{{ t('placeholder_username_modal') }}"
                    required
                  >
                </div>
                <div class="uk-flex uk-flex-right uk-margin-top">
                  <button
                    class="uk-icon-button uk-button-primary"
                    uk-icon="check"
                    type="submit"
                    aria-label="{{ t('action_save') }}"
                  ></button>
                  <button class="uk-button uk-button-default uk-modal-close" type="button">
                    {{ t('action_cancel') }}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <div id="userPassModal" uk-modal>
            <div class="uk-modal-dialog uk-modal-body">
              <h2 class="uk-modal-title">Passwort setzen</h2>
              <form id="userPassForm">
                <div class="uk-margin">
                  <input id="userPassInput" class="uk-input" type="password" placeholder="Passwort">
                </div>
                <div class="uk-margin">
                  <input id="userPassRepeat" class="uk-input" type="password" placeholder="Wiederholen">
                </div>
                <div class="uk-flex uk-flex-right uk-margin-top">
                  <button
                    id="userPassSave"
                    class="uk-icon-button uk-button-primary"
                    uk-icon="check"
                    type="submit"
                    aria-label="{{ t('action_save') }}"
                  ></button>
                  <button class="uk-button uk-button-default uk-modal-close" type="button">
                    {{ t('action_cancel') }}
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </li>
      <li class="{{ activeRoute == 'management' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_management') }}</h2>

        <h3 class="uk-heading-bullet" id="startpage">{{ t('heading_homepage') }}</h3>
        <div class="uk-margin-top">
          <p class="uk-text-meta">{{ t('text_domain_start_page_hint') }}</p>
          <div class="uk-card uk-card-default uk-card-body uk-margin-small-top">
            <form
              id="marketingDomainForm"
              class="uk-form-stacked"
              novalidate
              data-invalid="{{ t('notify_marketing_domain_invalid') }}"
              data-error="{{ t('notify_marketing_domain_error') }}"
              data-success="{{ t('notify_marketing_domain_created') }}"
            >
              <fieldset class="uk-fieldset">
                <legend id="domain-add" class="uk-legend">{{ t('heading_marketing_domain_add') }}</legend>
                <div class="uk-alert uk-alert-danger uk-margin-small-bottom" id="marketingDomainFormError" hidden role="alert"></div>
                <div class="uk-grid-small" uk-grid>
                  <div class="uk-width-1-1 uk-width-1-2@m">
                    <label class="uk-form-label" for="marketingDomainHost">{{ t('label_marketing_domain_host') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="text"
                        id="marketingDomainHost"
                        name="domain"
                        required
                        placeholder="{{ t('placeholder_marketing_domain_host') }}"
                        autocomplete="off"
                      >
                    </div>
                    <p class="uk-text-meta uk-margin-small">{{ t('text_marketing_domain_host_hint') }}</p>
                  </div>
                  <div class="uk-width-1-1 uk-width-1-2@m">
                    <label class="uk-form-label" for="marketingDomainLabel">{{ t('label_marketing_domain_label') }}</label>
                    <div class="uk-form-controls">
                      <input
                        class="uk-input"
                        type="text"
                        id="marketingDomainLabel"
                        name="label"
                        maxlength="120"
                        placeholder="{{ t('placeholder_marketing_domain_label') }}"
                        autocomplete="off"
                      >
                    </div>
                    <p class="uk-text-meta uk-margin-small">{{ t('text_marketing_domain_label_hint') }}</p>
                  </div>
                  <div class="uk-width-1-1 uk-flex uk-flex-middle uk-flex-between">
                    <span class="uk-text-meta">{{ t('text_marketing_domain_submit_hint') }}</span>
                    <button type="submit" class="uk-button uk-button-primary">{{ t('action_marketing_domain_save') }}</button>
                  </div>
                </div>
              </fieldset>
            </form>
          </div>
          <div class="uk-overflow-auto">
            <table
              id="domainStartPageTable"
              class="uk-table uk-table-divider uk-table-small uk-table-hover uk-table-responsive"
              data-loading="{{ t('text_domain_start_pages_loading') }}"
              data-empty="{{ t('text_domain_start_pages_empty') }}"
              data-error="{{ t('text_domain_start_pages_error') }}"
            >
              <thead>
                <tr>
                  <th>{{ t('column_domain') }}</th>
                  <th>{{ t('column_start_page') }}</th>
                  <th>{{ t('column_domain_email') }}</th>
                  <th>{{ t('column_domain_smtp') }}</th>
                  <th class="uk-table-shrink">{{ t('column_contact_template') }}</th>
                  <th class="uk-table-shrink">{{ t('column_domain_ssl') }}</th>
                  <th>{{ t('column_domain_type') }}</th>
                  <th class="uk-table-shrink uk-text-center">{{ t('column_actions') }}</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="7">{{ t('text_domain_start_pages_loading') }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="uk-flex uk-flex-between uk-flex-middle uk-flex-wrap uk-margin-small-top" style="gap: 12px;">
            <span class="uk-text-meta">{{ t('text_marketing_domain_reconcile_hint') }}</span>
            <button type="button" id="marketingDomainReconcile" class="uk-button uk-button-default">
              {{ t('action_marketing_domain_reconcile') }}
            </button>
          </div>
        </div>


        <div id="domainContactTemplateModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_domain_contact_template') }}</h2>
            <p id="domainContactTemplateInfo" class="uk-text-meta uk-margin-remove"></p>
            <p class="uk-text-meta">{{ t('text_domain_contact_template_hint') }}</p>
            <p class="uk-text-meta uk-margin-small">{{ t('help_contact_template_placeholders')|raw }}</p>
            <form id="domainContactTemplateForm" class="uk-form-stacked">
              <input type="hidden" id="domainContactTemplateDomain">
              <div class="uk-margin">
                <label class="uk-form-label" for="domainContactTemplateSenderName">{{ t('label_contact_sender_name') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="text" id="domainContactTemplateSenderName" placeholder="{{ t('label_contact_sender_name') }}">
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainContactTemplateRecipientHtml">{{ t('label_contact_recipient_html') }}</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="domainContactTemplateRecipientHtml" rows="6" data-template-editor="html"></textarea>
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainContactTemplateRecipientText">{{ t('label_contact_recipient_text') }}</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="domainContactTemplateRecipientText" rows="4"></textarea>
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainContactTemplateSenderHtml">{{ t('label_contact_sender_html') }}</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="domainContactTemplateSenderHtml" rows="6" data-template-editor="html"></textarea>
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainContactTemplateSenderText">{{ t('label_contact_sender_text') }}</label>
                <div class="uk-form-controls">
                  <textarea class="uk-textarea" id="domainContactTemplateSenderText" rows="4"></textarea>
                </div>
              </div>
              <div class="uk-flex uk-flex-right uk-margin-top">
                <button type="submit" class="uk-button uk-button-primary">{{ t('action_save') }}</button>
                <button type="button" class="uk-button uk-button-default uk-margin-small-left uk-modal-close">{{ t('action_cancel') }}</button>
              </div>
            </form>
          </div>
        </div>

        <div id="domainSmtpModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_domain_smtp_settings') }}</h2>
            <p id="domainSmtpInfo" class="uk-text-meta uk-margin-remove"></p>
            <p class="uk-text-meta">{{ t('text_domain_smtp_hint') }}</p>
            <form id="domainSmtpForm" class="uk-form-stacked">
              <input type="hidden" id="domainSmtpDomain">
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpHost">{{ t('label_domain_smtp_host') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="text" id="domainSmtpHost" placeholder="smtp.example.org">
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpUser">{{ t('label_domain_smtp_user') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="text" id="domainSmtpUser" placeholder="user@example.org">
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpPort">{{ t('label_domain_smtp_port') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="number" min="1" max="65535" id="domainSmtpPort" placeholder="587">
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpEncryption">{{ t('label_domain_smtp_encryption') }}</label>
                <div class="uk-form-controls">
                  <select class="uk-select" id="domainSmtpEncryption">
                    <option value="">{{ t('option_domain_smtp_encryption_default') }}</option>
                    <option value="none">{{ t('option_domain_smtp_encryption_none') }}</option>
                    <option value="tls">{{ t('option_domain_smtp_encryption_tls') }}</option>
                    <option value="ssl">{{ t('option_domain_smtp_encryption_ssl') }}</option>
                    <option value="starttls">{{ t('option_domain_smtp_encryption_starttls') }}</option>
                  </select>
                </div>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpPass">{{ t('label_domain_smtp_pass') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="password" id="domainSmtpPass" autocomplete="new-password" placeholder="{{ t('placeholder_domain_smtp_pass') }}">
                </div>
                <p class="uk-text-meta uk-margin-small">{{ t('text_domain_smtp_password_hint') }}</p>
                <label class="uk-text-small"><input class="uk-checkbox" type="checkbox" id="domainSmtpClearPass"> {{ t('label_domain_smtp_clear_password') }}</label>
              </div>
              <div class="uk-margin">
                <label class="uk-form-label" for="domainSmtpDsn">{{ t('label_domain_smtp_dsn') }}</label>
                <div class="uk-form-controls">
                  <input class="uk-input" type="text" id="domainSmtpDsn" placeholder="smtp://user:pass@host:587">
                </div>
                <p class="uk-text-meta uk-margin-small">{{ t('text_domain_smtp_dsn_hint') }}</p>
              </div>
              <div class="uk-flex uk-flex-right uk-margin-top">
                <button type="submit" class="uk-button uk-button-primary">{{ t('action_save') }}</button>
                <button type="button" class="uk-button uk-button-default uk-margin-small-left uk-modal-close">{{ t('action_cancel') }}</button>
              </div>
            </form>
          </div>
        </div>

        <h3 id="backups" class="uk-heading-bullet">{{ t('heading_backups') }}</h3>
        <div class="uk-margin uk-child-width-1-1 uk-child-width-auto@s uk-grid-small uk-flex-right@s" uk-grid>
          <div>
            <button id="exportJsonBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_export') }}; pos: right">{{ t('action_create_backup') }}</button>
          </div>
          <div>
            <button id="importJsonBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_import') }}; pos: right">{{ t('action_restore_demo') }}</button>
          </div>
          <div>
            <button id="saveDemoBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_save') }}; pos: right">{{ t('action_save_demo') }}</button>
          </div>
        </div>
        {% set backupRows %}{% include 'admin/_backup_table.twig' %}{% endset %}
        <div class="uk-overflow-auto">
          <table class="uk-table uk-table-divider uk-table-small uk-table-hover">
            <thead>
              <tr>
                <th class="uk-table-expand">{{ t('column_folder') }}</th>
                <th class="uk-table-shrink uk-text-center">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody id="backupTableBody">{{ backupRows|raw }}</tbody>
          </table>
        </div>
      </div>
    </li>
    {% if domainType == 'main' %}
    <li class="{{ activeRoute == 'tenants' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_tenants') }}</h2>

        <!-- FILTER / TOOLBAR -->
        <div class="uk-grid-small uk-flex-middle uk-margin" uk-grid>
          <div class="uk-width-auto uk-flex uk-flex-middle">
            <select id="tenantStatusFilter" class="uk-select" aria-label="Status filtern">
              <option value="">{{ t('tenant_status_filter_all') }}</option>
              <option value="active">{{ t('tenant_status_active') }}</option>
              <option value="canceled">{{ t('tenant_status_canceled') }}</option>
              <option value="simulated">{{ t('tenant_status_simulated') }}</option>
              <option value="pending">{{ t('tenant_status_pending') }}</option>
              <option value="provisioning">{{ t('tenant_status_provisioning') }}</option>
              <option value="provisioned">{{ t('tenant_status_provisioned') }}</option>
              <option value="failed">{{ t('tenant_status_failed') }}</option>
            </select>
          </div>

          <div class="uk-width-expand uk-flex uk-flex-middle">
            <div class="uk-inline uk-width-1-1">
              <span class="uk-form-icon" uk-icon="icon: search"></span>
              <input id="tenantSearchInput" class="uk-input" type="search" placeholder="Suchen (Subdomain, Kunde, E-Mail)">
            </div>
          </div>
          <div class="uk-width-auto uk-flex uk-flex-wrap uk-margin-small-top@s">
            <button
              class="uk-icon-button uk-margin-small-right"
              uk-icon="icon: more"
              uk-tooltip="title: {{ t('menu') }}; pos: bottom"
              aria-label="{{ t('menu') }}"
              type="button"></button>
            <div uk-dropdown="mode: click; pos: bottom-right">
              <ul class="uk-nav uk-dropdown-nav">
                <li>
                  <button
                    id="tenantExportBtn"
                    type="button"
                    class="uk-button uk-button-text uk-width-1-1 uk-text-left"
                    aria-label="Exportieren">Exportieren</button>
                </li>
                <li>
                  <button
                    id="tenantReportBtn"
                    type="button"
                    class="uk-button uk-button-text uk-width-1-1 uk-text-left"
                    aria-label="Auswertung">Auswertung</button>
                </li>
                <li>
                  <button
                    id="tenantColumnBtn"
                    type="button"
                    class="uk-button uk-button-text uk-width-1-1 uk-text-left"
                    aria-label="Spalten">Spalten</button>
                </li>
                <li>
                  <button
                    id="tenantSyncBtn"
                    type="button"
                    class="uk-button uk-button-text uk-width-1-1 uk-text-left"
                    aria-label="Sync">
                    Sync
                    <span class="uk-badge uk-margin-small-left uk-hidden" id="tenantSyncBadge">–</span>
                  </button>
                </li>
                <li>
                  <button
                    type="button"
                    class="uk-button uk-button-text uk-width-1-1 uk-text-left"
                    data-action="build-docker"
                    aria-label="{{ t('action_build_image') }}">{{ t('action_build_image') }}</button>
                </li>
              </ul>
            </div>
          </div>
        </div>

        {% from 'components/table.twig' import qr_rowcards %}
        <div class="uk-visible@s uk-overflow-auto">
          <table class="uk-table uk-table-middle uk-table-striped">
            <thead>
              <tr>
                <th class="sticky">{{ t('column_subdomain') }}</th>
                <th>{{ t('column_plan') }}</th>
                <th>{{ t('column_billing') }}</th>
                <th>{{ t('column_created') }}</th>
                <th class="uk-text-right">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody id="tenantTableBody"></tbody>
          </table>
        </div>
        {{ qr_rowcards('tenantCards', false, 'uk-hidden@s', 'div') }}
      </div>
    </li>
    {% else %}
    <li class="{{ activeRoute == 'tenants' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_tenants') }}</h2>
        <div class="uk-alert-warning" uk-alert>MAIN_DOMAIN falsch konfiguriert – Mandantenliste nicht geladen</div>
      </div>
    </li>
    {% endif %}
    {% endif %}
    {% if activeRoute == 'profile' %}
    <li class="{{ activeRoute == 'profile' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_profile') }}</h2>
        {% if tenant %}
        <form id="profileForm" class="uk-form-stacked">
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_subdomain') }}</label>
              <input class="uk-input" type="text" name="subdomain" value="{{ tenant.subdomain }}" readonly>
            </div>
            <div class="uk-width-1-1">
              <label class="uk-form-label">{{ t('language') }}</label>
              <select id="langSelect" class="uk-select uk-form-width-small">
                <option value="de" {{ locale() == 'de' ? 'selected' }}>{{ t('german') }}</option>
                <option value="en" {{ locale() == 'en' ? 'selected' }}>{{ t('english') }}</option>
              </select>
            </div>
            <div class="uk-width-1-1">
              <label class="uk-form-label">{{ t('column_imprint_name') }}</label>
              <input class="uk-input" type="text" name="imprint_name" value="{{ tenant.imprint_name|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_street') }}</label>
              <input class="uk-input" type="text" name="imprint_street" value="{{ tenant.imprint_street|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_zip') }}</label>
              <input class="uk-input" type="text" name="imprint_zip" value="{{ tenant.imprint_zip|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_city') }}</label>
              <input class="uk-input" type="text" name="imprint_city" value="{{ tenant.imprint_city|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_email') }}</label>
              <input class="uk-input" type="email" name="imprint_email" value="{{ tenant.imprint_email|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_created') }}</label>
              <input class="uk-input" type="text" value="{{ tenant.created_at }}" readonly>
            </div>
          </div>
          {% if domainType == 'tenant' %}
          <div class="uk-margin">
            <button id="welcomeMailBtn" type="button" class="uk-button uk-button-default">{{ t('action_send_welcome_mail') }}</button>
          </div>
          {% endif %}
          <button id="profileSaveBtn" class="uk-icon-button uk-button-primary fab fab-save" uk-icon="check" uk-tooltip="title: {{ t('tip_save_changes') }}; pos: left" aria-label="{{ t('tip_save_changes') }}"></button>
        </form>
        {% else %}
        <p>{{ t('text_no_data') }}</p>
        {% endif %}
      </div>
    </li>
    {% endif %}
    <li class="{{ activeRoute == 'subscription' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_subscription') }}</h2>
        {% set hasCustomer = tenant and tenant.stripe_customer_id %}
        <div class="uk-card qr-card uk-card-body uk-margin-small" id="subscription-card">
          <div id="subscription-details"
            data-label-plan="{{ t('label_plan') }}"
            data-label-price="{{ t('label_price') }}"
            data-label-status="{{ t('label_invoice_status') }}"
            data-label-next="{{ t('label_next_payment') }}"
            data-action-cancel="{{ t('action_cancel_subscription') }}"
            data-plan-starter="{{ t('plan_starter') }}"
            data-plan-standard="{{ t('plan_standard') }}"
            data-plan-professional="{{ t('plan_professional') }}"></div>
          <div data-subscription
            data-label-plan="{{ t('label_plan') }}"
            data-label-events="{{ t('label_events') }}"
            data-label-catalogs="{{ t('label_catalogs') }}"
            data-label-questions="{{ t('label_questions') }}"
            data-plan-starter="{{ t('plan_starter') }}"
            data-plan-standard="{{ t('plan_standard') }}"
            data-plan-professional="{{ t('plan_professional') }}"></div>
          {% if tenant and tenant.imprint_email %}
            <p>{{ t('subscription_email') }}: {{ tenant.imprint_email }}</p>
          {% endif %}
        </div>
        {% if stripe_configured and hasCustomer %}
        <div class="uk-card qr-card uk-card-body uk-margin-small">
          <h3 class="uk-card-title uk-margin-remove">{{ t('heading_invoices') }}</h3>
          <div id="invoice-list"
               data-label-invoice="{{ t('billing_invoice') }}"
               data-label-date="{{ t('label_date') }}"
               data-label-amount="{{ t('label_price') }}"
               data-label-status="{{ t('label_invoice_status') }}"
               data-label-download="{{ t('label_invoice_pdf') }}"
               data-action-download="{{ t('action_download') }}"
               data-text-empty="{{ t('text_no_data') }}"></div>
        </div>
        {% endif %}
        {% if stripe_configured %}
        <script src="https://js.stripe.com/v3/"></script>
        <div id="stripe-checkout"></div>
          {% if not tenant or not tenant.imprint_email %}
          <div class="uk-margin-top uk-width-1-2@s">
            <label class="uk-form-label">E-Mail für Abrechnung</label>
            <input class="uk-input" type="email" id="subscription-email" placeholder="name@firma.de" required>
            <div class="uk-text-meta">Wird für Stripe-Kund*in verwendet.</div>
          </div>
          {% endif %}
        {% set planRows %}
        <tr>
          <th scope="row">Gleichzeitige Events</th>
          <td>1</td>
          <td>3</td>
          <td>20</td>
        </tr>
        <tr>
          <th scope="row">Teams &amp; Kataloge</th>
          <td>5 Teams &amp; 5 Kataloge à 5 Fragen</td>
          <td>10 Teams &amp; 10 Kataloge à 10 Fragen</td>
          <td>100 Teams &amp; 50 Kataloge à 50 Fragen</td>
        </tr>
        <tr>
          <th scope="row">Subdomain</th>
          <td>–</td>
          <td>&#10003;</td>
          <td>&#10003;</td>
        </tr>
        <tr>
          <th scope="row">PDF-Export</th>
          <td>Basis</td>
          <td>Vollständig</td>
          <td>Vollständig</td>
        </tr>
        <tr>
          <th scope="row">White-Label &amp; Rollenverwaltung</th>
          <td>–</td>
          <td>–</td>
          <td>&#10003;</td>
        </tr>
        <tr>
          <th scope="row"></th>
          <td><button class="uk-button uk-button-default uk-width-1-1 plan-select" data-plan="starter">{{ t('action_start_subscription') }}</button></td>
          <td><button class="uk-button uk-button-primary uk-width-1-1 plan-select" data-plan="standard">{{ t('action_start_subscription') }}</button></td>
          <td><button class="uk-button uk-button-default uk-width-1-1 plan-select" data-plan="professional">{{ t('action_start_subscription') }}</button></td>
        </tr>
        {% endset %}
        <div class="uk-overflow-auto uk-margin-top">
          <table class="uk-table uk-table-divider uk-table-small uk-table-hover uk-text-center">
            <thead>
              <tr>
                <th></th>
                <th>{{ (t('plan_starter') ~ '<br><div class="uk-text-large">9&nbsp;€/Monat</div>')|raw }}</th>
                <th>{{ (t('plan_standard') ~ '<br><div class="uk-text-large">39&nbsp;€/Monat</div>')|raw }}</th>
                <th>{{ (t('plan_professional') ~ '<br><div class="uk-text-large">79&nbsp;€/Monat</div>')|raw }}</th>
              </tr>
            </thead>
            <tbody id="planCompareBody">{{ planRows|raw }}</tbody>
          </table>
        </div>
        </div>
        {% endif %}
        {% if domainType == 'tenant' and hasCustomer %}
        <p class="uk-margin-top"><a class="uk-button uk-button-text" href="{{ basePath }}/admin/subscription/portal">{{ t('action_open_subscription') }}</a></p>
        {% endif %}
        <script>
          window.upgradeUrl = '{{ basePath }}/admin/subscription';
        </script>
      </div>
    </li>
      </ul>
    </main>
  </div>
  <div id="helpSidebar" uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar uk-width-medium">
      <h3 class="uk-margin-remove-top">Hilfe</h3>
      <div id="helpContent"></div>
    </div>
  </div>
  <div id="qr-offcanvas" uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar">
      <button class="uk-offcanvas-close" type="button" uk-close aria-label="{{ t('menu') }}"></button>
      <h3 class="uk-margin-small">QuizRace</h3>
      {% include 'admin/_nav.twig' %}
      <ul class="uk-nav uk-nav-default offcanvas-switches" role="menu">
        <li>
          <button class="uk-button uk-button-default git-btn theme-toggle" aria-label="{{ t('design_toggle') }}" role="menuitem">
            <span class="theme-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"></path></svg>
            </span>
          </button>
        </li>
        <li>
          <button class="uk-button uk-button-default git-btn accessibility-toggle" aria-label="{{ t('contrast_toggle') }}" role="menuitem">
            <span class="accessibility-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 2a10 10 0 0 0 0 20z" fill="currentColor" /></svg>
            </span>
          </button>
        </li>
        <li>
          <button class="uk-button uk-button-default git-btn help-toggle" aria-label="{{ t('help') }}" role="menuitem">
            <span aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 0 20A10 10 0 0 0 12 2Zm0 16a1.25 1.25 0 1 1 0 2.5A1.25 1.25 0 0 1 12 18Zm1.1-3.9v.65h-2.1V14c0-1.35.9-2.01 1.84-2.56.84-.5 1.66-.99 1.66-1.94 0-.86-.7-1.5-1.75-1.5-1.06 0-1.77.63-1.9 1.6H8.7C8.86 7.63 10.13 6 12.75 6c2.32 0 3.9 1.33 3.9 3.23 0 1.87-1.46 2.7-2.37 3.22-.87.5-1.18.76-1.18 1.65Z" fill="currentColor"/></svg>
            </span>
          </button>
        </li>
      </ul>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ basePath }}/js/custom-icons.js"></script>
  <script>
    window.quizConfig = {{ config|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.quizSettings = {{ settings|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.ragChatSecretPlaceholder = '{{ ragChatSecretPlaceholder|e('js') }}';
    window.transRagChatSaved = '{{ t('message_rag_chat_saved')|e('js') }}';
    window.transRagChatSaveError = '{{ t('message_rag_chat_save_error')|e('js') }}';
    window.transRagChatTokenSaved = '{{ t('text_rag_chat_token_saved')|e('js') }}';
    window.transRagChatTokenMissing = '{{ t('text_rag_chat_token_missing')|e('js') }}';
    window.ragChatTokenPlaceholder = '{{ t('placeholder_rag_chat_token')|e('js') }}';
    window.roles = {{ roles|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.availableNamespaces = {{ available_namespaces|default([])|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.defaultNamespace = '{{ default_namespace|default('default')|e('js') }}';
    window.pageNamespace = '{{ pageNamespace|default('default')|e('js') }}';
    window.currentUserRole = '{{ role|e('js') }}';
    window.transNamespaceActiveLabel = '{{ t('label_namespace_active')|e('js') }}';
    window.transNamespaceDefaultLabel = '{{ t('label_namespace_default')|e('js') }}';
    window.transNamespaceNone = '{{ t('text_namespace_none')|e('js') }}';
    window.baseUrl = '{{ baseUrl }}';
    window.mainDomain = '{{ main_domain }}';
    window.domainType = '{{ domainType }}';
    window.tenantSyncState = {{ tenant_sync|default(null)|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.initialTenantListHtml = {{ initialTenantListHtml|default('')|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.transTenantSyncOk = '{{ 'Aktuell'|e('js') }}';
    window.transTenantSyncStale = '{{ 'Sync nötig'|e('js') }}';
    window.transTenantSyncCooling = '{{ 'Wartezeit'|e('js') }}';
    window.transTenantSyncLastRun = '{{ 'Letzter Sync'|e('js') }}';
    window.transTenantSyncThrottled = '{{ 'Sync läuft bereits – bitte später erneut versuchen'|e('js') }}';
    window.transTenantSyncSuccess = '{{ 'Mandanten eingelesen'|e('js') }}';
    window.transTenantSyncNoChanges = '{{ t('notify_tenant_sync_no_changes')|e('js') }}';
    window.domainStartPageOptions = {{ domain_start_page_options|default({})|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.marketingNewsletterConfigs = {{ marketingNewsletterConfigs|default({})|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.marketingNewsletterSlugs = {{ marketingNewsletterSlugs|default([])|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.marketingNewsletterStyles = {{ marketingNewsletterStyles|default([])|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.marketingNewsletterStyleLabels = {{ {
      'primary': t('label_marketing_newsletter_style_primary'),
      'secondary': t('label_marketing_newsletter_style_secondary'),
      'link': t('label_marketing_newsletter_style_link')
    }|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.domainStartPageTypeLabels = {{ {
      'main': t('label_domain_type_main'),
      'marketing': t('label_domain_type_marketing'),
      'custom': t('label_domain_type_custom')
    }|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.transDomainStartPageSaved = '{{ t('notify_domain_start_page_saved')|e('js') }}';
    window.transDomainStartPageError = '{{ t('notify_domain_start_page_error')|e('js') }}';
    window.transDomainStartPageInvalidEmail = '{{ t('notify_domain_start_page_invalid_email')|e('js') }}';
    window.transDomainStartPageDeleted = '{{ t('notify_domain_start_page_deleted')|e('js') }}';
    window.transDomainStartPageDeleteError = '{{ t('notify_domain_start_page_delete_error')|e('js') }}';
    window.transDomainStartPageDeleteConfirm = '{{ t('confirm_domain_start_page_delete')|e('js') }}';
    window.transDomainSmtpTitle = '{{ t('heading_domain_smtp_settings')|e('js') }}';
    window.transDomainSmtpSaved = '{{ t('notify_domain_smtp_saved')|e('js') }}';
    window.transDomainSmtpError = '{{ t('notify_domain_smtp_error')|e('js') }}';
    window.transDomainSmtpInvalid = '{{ t('notify_domain_start_page_invalid_smtp')|e('js') }}';
    window.actionDomainIssueSsl = '{{ t('action_domain_issue_ssl')|e('js') }}';
    window.transDomainSslIssued = '{{ t('notify_domain_ssl_issued')|e('js') }}';
    window.transDomainSslError = '{{ t('notify_domain_ssl_error')|e('js') }}';
    window.transDomainSmtpDefault = '{{ t('text_domain_smtp_default_summary')|e('js') }}';
    window.transDomainSmtpSummaryDsn = '{{ t('text_domain_smtp_summary_dsn')|e('js') }}';
    window.transDomainSmtpPasswordSet = '{{ t('text_domain_smtp_password_set')|e('js') }}';
    window.transMarketingDomainCreated = '{{ t('notify_marketing_domain_created')|e('js') }}';
    window.transMarketingDomainInvalid = '{{ t('notify_marketing_domain_invalid')|e('js') }}';
    window.transMarketingDomainError = '{{ t('notify_marketing_domain_error')|e('js') }}';
    window.actionMarketingDomainReconcile = '{{ t('action_marketing_domain_reconcile')|e('js') }}';
    window.transMarketingDomainReconcileProvisioned = '{{ t('notify_marketing_domain_reconcile_provisioned')|e('js') }}';
    window.transMarketingDomainReconcileResolved = '{{ t('notify_marketing_domain_reconcile_resolved')|e('js') }}';
    window.transMarketingDomainReconcileUnresolved = '{{ t('notify_marketing_domain_reconcile_unresolved')|e('js') }}';
    window.transMarketingDomainReconcileError = '{{ t('notify_marketing_domain_reconcile_error')|e('js') }}';
    window.domainStartPageSecretPlaceholder = '{{ constant('App\\Service\\DomainStartPageService::SECRET_PLACEHOLDER')|e('js') }}';
    window.transDomainContactTemplateEdit = '{{ t('action_edit_contact_template')|e('js') }}';
    window.transDomainContactTemplateSaved = '{{ t('notify_domain_contact_template_saved')|e('js') }}';
    window.transDomainContactTemplateError = '{{ t('notify_domain_contact_template_error')|e('js') }}';
    window.transDomainContactTemplateLoadError = '{{ t('notify_domain_contact_template_load_error')|e('js') }}';
    window.transDomainContactTemplateInvalidDomain = '{{ t('notify_domain_contact_template_invalid_domain')|e('js') }}';
    window.transMarketingNewsletterSaved = '{{ t('message_marketing_newsletter_saved')|e('js') }}';
    window.transMarketingNewsletterError = '{{ t('message_marketing_newsletter_error')|e('js') }}';
    window.transMarketingNewsletterInvalidSlug = '{{ t('error_marketing_newsletter_invalid_slug')|e('js') }}';
    window.transMarketingNewsletterRemove = '{{ t('button_marketing_newsletter_remove_entry')|e('js') }}';
    window.transMarketingNewsletterEmpty = '{{ t('text_marketing_newsletter_empty')|e('js') }}';
    window.domainChatDomains = {{ domain_chat_domains|default([])|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.domainChatPages = {{ domain_chat_pages|default([])|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.domainChatTranslations = {{ {
      'loading': t('text_domain_chat_loading'),
      'empty': t('text_domain_chat_empty'),
      'error': t('notify_domain_chat_error'),
      'uploaded': t('notify_domain_chat_uploaded'),
      'deleted': t('notify_domain_chat_deleted'),
      'rebuild': t('notify_domain_chat_rebuild_success'),
      'rebuildCleared': t('notify_domain_chat_rebuild_cleared'),
      'rebuildQueued': t('notify_domain_chat_rebuild_queued'),
      'rebuildThrottled': t('notify_domain_chat_rebuild_throttled'),
      'rebuildError': t('notify_domain_chat_rebuild_error'),
      'downloadError': t('notify_domain_chat_download_error'),
      'downloadMissing': t('notify_domain_chat_download_missing'),
      'confirmDelete': t('confirm_domain_chat_delete'),
      'wikiSaved': t('notify_domain_chat_wiki_saved'),
      'wikiError': t('notify_domain_chat_wiki_error'),
      'wikiUnavailable': t('text_domain_chat_wiki_unavailable'),
      'wikiEmpty': t('text_domain_chat_wiki_empty')
    }|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.domainChatMaxSize = {{ constant('App\\Service\\RagChat\\DomainDocumentStorage::MAX_FILE_SIZE') }};
    window.pagesContent = {{ page_contents|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.transUpgradeTitle = '{{ t('heading_limit_reached') }}';
    window.transUpgradeText = '{{ t('text_upgrade_required') }}';
    window.transUpgradeAction = '{{ t('action_upgrade') }}';
    window.transUpgradeDocker = '{{ t('action_upgrade_docker') }}';
    window.transRestartTenant = '{{ t('action_restart_tenant') }}';
    window.transImageReady = '{{ t('text_background_uploaded') }}';
    window.transEventSettingsHelp = '{{ t('text_event_settings_help')|e('js') }}';
    window.transCountdownInvalid = '{{ t('message_countdown_invalid')|e('js') }}';
    window.transEventsFetchError = '{{ t('text_events_fetch_error')|e('js') }}';
    window.transDashboardLinkCopied = '{{ t('notify_dashboard_link_copied')|e('js') }}';
    window.transDashboardLinkMissing = '{{ t('notify_dashboard_link_missing')|e('js') }}';
    window.transDashboardCopyFailed = '{{ t('error_dashboard_copy_failed')|e('js') }}';
    window.transDashboardTokenRotated = '{{ t('notify_dashboard_token_rotated')|e('js') }}';
    window.transDashboardTokenRotateError = '{{ t('error_dashboard_token_rotate')|e('js') }}';
    window.transDashboardNoEvent = '{{ t('error_dashboard_no_event')|e('js') }}';
    window.transSummaryLoadingCatalogs = '{{ t('text_summary_loading_catalogs')|e('js') }}';
    window.transSummaryLoadingTeams = '{{ t('text_summary_loading_teams')|e('js') }}';
    window.transSummaryLoadingEvent = '{{ t('text_summary_loading_event')|e('js') }}';
    window.transSummaryCatalogProgress = '{{ t('text_summary_catalogs_progress')|e('js') }}';
    window.transSummaryTeamProgress = '{{ t('text_summary_teams_progress')|e('js') }}';
    window.transSummaryLoadError = '{{ t('text_summary_load_error')|e('js') }}';
    window.transSummaryNoCatalogs = '{{ t('text_no_catalogs')|e('js') }}';
    window.transSummaryNoTeams = '{{ t('text_no_data')|e('js') }}';
    window.transTeamPdf = '{{ t('tip_team_pdf') }}';
    window.transTeamDeleteTitle = '{{ t('heading_delete_team')|e('js') }}';
    window.transTeamDeleteConfirm = '{{ t('confirm_team_delete')|e('js') }}';
    window.transTeamDeleteAllEmpty = '{{ t('message_team_delete_all_empty')|e('js') }}';
    window.transTeamDeleteAllSuccess = '{{ t('message_team_delete_all_success')|e('js') }}';
    window.transTeamDeleteAllError = '{{ t('message_team_delete_all_error')|e('js') }}';
    window.transActions = '{{ t('column_actions') }}';
    window.transDelete = '{{ t('action_delete') }}';
    window.transDeletePageConfirm = '{{ t('confirm_delete_page')|e('js') }}';
    window.transPageDeleted = '{{ t('notify_page_deleted')|e('js') }}';
    window.transPageDeleteError = '{{ t('notify_page_delete_error')|e('js') }}';
    window.transMarketingPagesEmpty = '{{ t('text_no_marketing_pages')|e('js') }}';
    window.transUsernameRequired = '{{ t('text_username_required') }}';
    window.stripeDashboard = '{{ stripe_sandbox ? 'https://dashboard.stripe.com/test' : 'https://dashboard.stripe.com' }}';
    window.initialEvents = {{ events|json_encode(constant('JSON_HEX_TAG') b-or constant('JSON_HEX_AMP') b-or constant('JSON_HEX_APOS') b-or constant('JSON_HEX_QUOT'))|raw }};
    window.initialEventSlug = '{{ event.slug|default('') }}';
    window.transWikiSettingsSaved = 'Wiki-Einstellungen gespeichert';
    window.transWikiSettingsError = 'Einstellungen konnten nicht gespeichert werden.';
    window.transWikiArticleSaved = 'Wiki-Artikel gespeichert.';
    window.transWikiArticleError = 'Artikel konnte nicht gespeichert werden.';
    window.transWikiArticleDeleted = 'Artikel gelöscht.';
    window.transWikiArticleDeleteConfirm = 'Diesen Artikel wirklich löschen?';
    window.transWikiArticleDuplicate = 'Artikel dupliziert.';
    window.transWikiArticleDuplicateError = 'Duplizieren fehlgeschlagen.';
    window.transWikiSortSaved = 'Reihenfolge gespeichert.';
    window.transWikiSortError = 'Reihenfolge konnte nicht gespeichert werden.';
    window.transWikiStatusDraft = 'Entwurf';
    window.transWikiStatusPublished = 'Veröffentlicht';
    window.transWikiStatusArchived = 'Archiviert';
    window.transWikiLoading = 'Lädt…';
    window.transWikiEmpty = 'Keine Artikel vorhanden.';
    window.transWikiArticleImport = 'Markdown importiert.';
    window.transWikiArticleImportError = 'Markdown-Import fehlgeschlagen.';
    window.transWikiArticleImportInvalid = 'Bitte eine Markdown-Datei auswählen.';
    window.transWikiArticleImportNoPage = 'Bitte zuerst eine Marketing-Seite auswählen.';
    window.transWikiArticleStartMarked = 'Startdokument gespeichert.';
    window.transWikiArticleStartRemoved = 'Startdokument entfernt.';
    window.transWikiArticleStartBadge = 'Start';
  </script>
  <script src="{{ basePath }}/js/dashboard.js"></script>
  <script type="module" src="{{ basePath }}/js/events.js"></script>
  <script type="module" src="{{ basePath }}/js/admin.js"></script>
  <script type="module" src="{{ basePath }}/js/wiki-admin.js"></script>
  <script type="module" src="{{ basePath }}/js/media-manager.js"></script>
  <script type="module" src="{{ basePath }}/js/sticker-editor.js"></script>
  <script src="{{ basePath }}/js/subscription.js"></script>
  <script src="{{ basePath }}/js/storage.js"></script>
  <script type="module" src="{{ basePath }}/js/results.js"></script>
  <script src="{{ basePath }}/js/stats.js"></script>
{% endblock %}
