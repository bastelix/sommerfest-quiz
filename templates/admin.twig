{% extends 'layout.twig' %}

{% block title %}{{ t('admin_title') }}{% endblock %}

{% block head %}
  <meta name="csrf-token" content="{{ csrf_token }}">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css">
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/trumbowyg@2/dist/ui/trumbowyg.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/trumbowyg@2/dist/trumbowyg.min.js"></script>
  <script>
    window.profileVars = {
      NAME: {{ tenant.imprint_name|default('')|json_encode|raw }},
      STREET: {{ tenant.imprint_street|default('')|json_encode|raw }},
      ZIP: {{ tenant.imprint_zip|default('')|json_encode|raw }},
      CITY: {{ tenant.imprint_city|default('')|json_encode|raw }},
      EMAIL: {{ tenant.imprint_email|default('')|json_encode|raw }}
    };
  </script>
  <script>
    window.csrfToken = '{{ csrf_token|e('js') }}';
  </script>
    <script type="module" src="{{ basePath }}/js/trumbowyg-pages.js"></script>
    <script type="module" src="{{ basePath }}/js/seo-form.js"></script>
  {% endblock %}

{% block body_class %}uk-background-muted uk-padding admin-page{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}
    {% block left %}
      <a class="uk-navbar-toggle uk-hidden@m" uk-toggle="target: #qr-offcanvas" aria-label="{{ t('menu') }}">
        <span uk-navbar-toggle-icon></span>
      </a>
      <a href="{{ basePath }}/admin/summary" class="uk-navbar-item uk-logo uk-margin-small-left uk-visible@s">
        QuizRace Admin
        <div class="uk-text-meta uk-text-small">v{{ version }}</div>
      </a>
    {% endblock %}
    {% block center %}
      <div class="uk-flex uk-flex-middle">
        <div id="eventSelectWrap" class="uk-form-custom uk-flex-1" uk-form-custom="target: > * > span:first-child">
          <select id="eventSelect" aria-label="{{ t('label_events') }}"></select>
          <button class="uk-button uk-button-default" type="button" tabindex="-1">
            <span></span>
            <span uk-icon="icon: chevron-down"></span>
          </button>
        </div>
        <button id="eventOpenBtn" class="uk-icon-button uk-margin-small-left" uk-icon="icon: link-external" aria-label="{{ t('tip_event_open') }}" uk-tooltip="title: {{ t('tip_event_open') }}; pos: bottom"></button>
      </div>
    {% endblock %}
    {% block right %}
      <div class="theme-switch">
        <button id="theme-toggle" class="uk-icon-button" uk-icon="icon: moon; ratio: 2" aria-label="Design wechseln"></button>
      </div>
      <div class="contrast-switch uk-margin-small-left">
        <button id="contrast-toggle" class="uk-icon-button" uk-icon="icon: paint-bucket; ratio: 2" aria-label="Kontrastmodus"></button>
      </div>
      <button id="helpBtn" class="uk-icon-button uk-margin-small-left" uk-icon="icon: question; ratio: 2" aria-label="Hilfe"></button>
    {% endblock %}
    {% block nav_placeholder %}
      {% set activeRoute = currentPath|split('/admin/')|last %}
      {% if activeRoute == '' %}
        {% set activeRoute = 'dashboard' %}
      {% endif %}
      {% if activeRoute == 'dashboard' %}
        <div class="nav-placeholder">
          <div class="uk-container uk-container-large">
            <h2 class="uk-heading-bullet">Willkommen {{ username }}</h2>
          </div>
        </div>
      {% else %}
        <div class="nav-placeholder"></div>
      {% endif %}
    {% endblock %}
  {% endembed %}
  {% if not stripe_configured %}
    <div class="uk-container uk-container-large">
      <div class="uk-alert-danger uk-margin" uk-alert>
        {{ t('text_stripe_config_missing') }}
      </div>
    </div>
  {% endif %}
  <div class="uk-grid-collapse" uk-grid>
    <aside class="uk-width-1-4@m uk-width-1-5@l uk-visible@m qr-sidebar">
      <div class="uk-card uk-card-default uk-card-body qr-sidebar-card">
        {% include 'admin/_nav.twig' %}
      </div>
    </aside>
    <main class="uk-width-expand uk-padding-small@xs uk-padding">
      {% set activeRoute = currentPath|split('/admin/')|last %}
      {% if activeRoute == '' %}
        {% set activeRoute = 'dashboard' %}
      {% endif %}
      <ul id="adminSwitcher" class="uk-switcher uk-margin">
    <li class="{{ activeRoute == 'dashboard' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div id="dashboard" class="uk-margin-large-top">
          <div class="uk-grid-large" uk-grid>
            <!-- Spalte 2–3: Inhalt -->
            <div class="uk-width-1-1 uk-width-2-3@m">
              <div class="uk-card uk-card-default uk-card-body uk-margin-small">
                <div class="uk-flex uk-flex-between uk-flex-middle">
                  <h3 class="uk-card-title uk-margin-remove">Für heute geplant</h3>
                  <div>
                    <a
                      href="{{ basePath }}/admin/events"
                      class="uk-button uk-button-primary uk-button-small"
                      aria-label="{{ t('tip_event_add') }}"
                    >
                      <span uk-icon="plus"></span>
                      <span class="button-text">{{ t('tip_event_add') }}</span>
                    </a>
                  </div>
                </div>
                <div id="today-empty" class="uk-text-meta uk-margin-small">Für heute nichts geplant</div>
                <ul id="upcoming-list" class="uk-list uk-list-divider uk-margin-small-top"></ul>
              </div>
              <div class="uk-margin-small">
                <span class="uk-badge" id="badge-events">0 Veranstaltungen</span>
                <span class="uk-badge" id="badge-upcoming">0 kommende</span>
                <span class="uk-badge" id="badge-past">0 vergangene</span>
              </div>

              <div class="uk-child-width-1-2@m uk-grid-small uk-margin-small" uk-grid>
                <div>
                  <div class="uk-card uk-card-default uk-card-body">
                    <h4 class="uk-margin-remove-bottom">Teams anlegen & organisieren</h4>
                    <p class="uk-text-meta uk-margin-small-top">Erstelle Teams, generiere QR-Codes und teile Einladungen.</p>
                    <a href="{{ basePath }}/admin/teams" class="uk-link-reset uk-text-bold">Teams verwalten →</a>
                  </div>
                </div>
                <div>
                  <div class="uk-card uk-card-default uk-card-body">
                    <h4 class="uk-margin-remove-bottom">Auswertung & Ergebnisse</h4>
                    <p class="uk-text-meta uk-margin-small-top">Live-Ergebnisse prüfen und PDF-Berichte exportieren.</p>
                    <a href="{{ basePath }}/admin/results" class="uk-link-reset uk-text-bold">Zur Auswertung →</a>
                  </div>
                </div>
              </div>

              <div class="uk-card uk-card-default uk-card-body uk-margin-small">
                <h3 class="uk-card-title uk-margin-remove">{{ t('heading_subscription_usage') }}</h3>
                <div data-subscription
                     data-label-plan="{{ t('label_plan') }}"
                     data-label-events="{{ t('label_events') }}"
                     data-label-catalogs="{{ t('label_catalogs') }}"
                     data-label-questions="{{ t('label_questions') }}"
                     data-label-of="{{ t('word_of') }}"
                     data-plan-starter="{{ t('plan_starter') }}"
                     data-plan-standard="{{ t('plan_standard') }}"
                     data-plan-professional="{{ t('plan_professional') }}"></div>
                {% if domainType == 'main' and role == 'admin' %}
                  <label for="planSelect" class="uk-form-label uk-margin-small-top">{{ t('label_plan') }}</label>
                  <select id="planSelect" class="uk-select">
                    <option value="">{{ t('plan_none') }}</option>
                    <option value="starter">{{ t('plan_starter') }}</option>
                    <option value="standard">{{ t('plan_standard') }}</option>
                    <option value="professional">{{ t('plan_professional') }}</option>
                  </select>
                {% endif %}
              </div>
            </div>

            <!-- Spalte 1: Kalender -->
            <div class="uk-width-1-1 uk-width-1-3@m">
              <div class="uk-card uk-card-default uk-card-small uk-card-body uk-margin-small">
                <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
                  <h3 class="uk-card-title uk-margin-remove">August 2025</h3>
                  <div>
                    <button class="uk-button uk-button-default uk-button-small" id="cal-prev" aria-label="Vorheriger Monat">‹</button>
                    <button class="uk-button uk-button-default uk-button-small" id="cal-next" aria-label="Nächster Monat">›</button>
                  </div>
                </div>
                <div id="calendar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'events' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_events') }}</h2>
        <p class="uk-hidden">Professionelles Quiz-Hosting</p>
        <div class="uk-overflow-auto">
          <table id="eventsTable" class="uk-table uk-table-divider uk-table-small">
            <thead class="table-headings">
              <tr>
                <th><span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_sort_rows') }}; pos: top"></span></th>
                <th>{{ t('column_number') }}</th>
                <th>{{ t('column_name') }}</th>
                <th>{{ t('column_start') }}</th>
                <th>{{ t('column_end') }}</th>
                <th>{{ t('column_description') }}</th>
                <th>{{ t('column_active') }}</th>
                <th><span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_event_remove') }}; pos: top"></span></th>
              </tr>
            </thead>
            <tbody id="eventsList" uk-sortable="handle: .uk-sortable-handle; group: sortable-group"></tbody>
          </table>
        </div>
        <div class="uk-margin">
          <button id="eventAddBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_event_add') }}; pos: left"></button>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'event/settings' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_event_settings') }}</h2>
        <form id="configForm" class="uk-form-stacked">
          <div class="uk-child-width-1-1 uk-child-width-1-2@m uk-grid-small" uk-grid>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgLogoFile">{{ t('label_logo_upload') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_logo_upload') }}; pos: right"></span>
                </label>
                <div class="uk-form-controls">
                  <div class="js-upload uk-placeholder uk-text-center">
                    <span uk-icon="icon: cloud-upload"></span>
                    <span class="uk-text-middle">{{ t('label_drag_file') }}&nbsp;</span>
                    <div uk-form-custom>
                      <input type="file" id="cfgLogoFile" accept="image/png,image/webp">
                      <span class="uk-link">{{ t('action_select') }}</span>
                    </div>
                  </div>
                  <progress id="cfgLogoProgress" class="uk-progress" value="0" max="100" hidden></progress>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgLogoPreview">{{ t('label_logo_preview') }}</label>
                <div class="uk-form-controls">
                  <div class="logo-frame uk-margin-small-top">
                    <img
                      id="cfgLogoPreview"
                      src="{% if config.logoPath %}
                            {{ basePath ~ config.logoPath }}
                          {% else %}
                            https://via.placeholder.com/160x240?text=Logo
                          {% endif %}"
                      alt="{{ t('label_logo_preview') }}"
                      class="logo-placeholder"
                      width="160"
                      height="240"
                      loading="lazy">
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label class="uk-form-label" for="cfgPageTitle">{{ t('label_page_title') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_page_title') }}; pos: right"></span>
                </label>
                <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgPageTitle"></div>
              </div>
            </div>
            <div>
              <div class="uk-margin uk-child-width-1-2@s uk-grid-small" uk-grid>
                <div>
                  <label class="uk-form-label" for="cfgBackgroundColor">{{ t('label_background_color') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_background_color') }}; pos: right"></span>
                  </label>
                  <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgBackgroundColor"></div>
                </div>
                <div>
                  <label class="uk-form-label" for="cfgButtonColor">{{ t('label_button_color') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_button_color') }}; pos: right"></span>
                  </label>
                  <div class="uk-form-controls"><input class="uk-input" type="color" id="cfgButtonColor"></div>
                </div>
              </div>
            </div>
            <div class="uk-width-1-1">
              <h3 class="uk-heading-bullet">{{ t('heading_game_options') }}</h3>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgCheckAnswerButton"> {{ t('label_check_button') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_check_button') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgQRUser"> {{ t('label_qr_login') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_qr_button') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgQRRemember"> {{ t('label_qr_remember') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_qr_remember') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgRandomNames"> {{ t('label_random_names') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_random_names') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgTeamRestrict"> {{ t('label_team_restrict') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_team_restrict') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgCompetitionMode"> {{ t('label_competition_mode') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_competition_mode') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgTeamResults"> {{ t('label_team_results') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_team_results') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgPhotoUpload"> {{ t('label_photo_upload') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_photo_upload') }}; pos: right"></span>
                </label>
              </div>
            </div>
            <div>
              <div class="uk-margin">
                <label><input class="uk-checkbox" type="checkbox" id="cfgPuzzleEnabled"> {{ t('label_puzzle_word') }}
                  <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_puzzle_word') }}; pos: right"></span>
                </label>
                <div id="cfgPuzzleWordWrap" class="uk-margin-small-top uk-grid uk-child-width-1-2@m uk-grid-small uk-flex-middle" uk-grid>
                  <div>
                    <input class="uk-input" type="text" id="cfgPuzzleWord" placeholder="{{ t('placeholder_puzzle_word') }}">
                  </div>
                  <div>
                    <button id="puzzleFeedbackBtn" class="uk-button uk-button-default uk-width-1-1@m" type="button" uk-toggle="target: #puzzleFeedbackModal">
                      <span id="puzzleFeedbackIcon" uk-icon="icon: check"></span>
                      <span id="puzzleFeedbackLabel">{{ t('action_edit_feedback') }}</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>

        <div id="puzzleFeedbackModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_feedback') }}</h2>
            <textarea id="puzzleFeedbackTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_feedback') }}"></textarea>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="puzzleFeedbackSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>

        <div id="catalogCommentModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">{{ t('heading_catalog_comment') }}</h2>
            <div id="catalogCommentToolbar" class="uk-margin-small-bottom">
              <button class="uk-button uk-button-default" type="button" data-format="h2">H2</button>
              <button class="uk-button uk-button-default" type="button" data-format="h3">H3</button>
              <button class="uk-button uk-button-default" type="button" data-format="h4">H4</button>
              <button class="uk-button uk-button-default" type="button" data-format="h5">H5</button>
              <button class="uk-button uk-button-default" type="button" data-format="bold"><strong>B</strong></button>
              <button class="uk-button uk-button-default" type="button" data-format="italic"><em>I</em></button>
            </div>
            <textarea id="catalogCommentTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_catalog_comment') }}"></textarea>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="catalogCommentSave" class="uk-icon-button uk-button-primary" uk-icon="check" type="button"></button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>

      </div>
    </li>
    <li class="{{ activeRoute == 'catalogs' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div>
          <h2 class="uk-heading-bullet">{{ t('heading_catalogs') }}</h2>
          <div class="uk-overflow-auto">
          <table id="catalogTable" class="uk-table uk-table-divider uk-table-small">
            <thead class="table-headings">
              <tr>
                <th>
                  <span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_sort_rows') }}; pos: top"></span>
                </th>
                  <th>{{ t('column_slug') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_slug') }}; pos: top"></span>
                  </th>
                  <th>{{ t('column_name') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_cat_name') }}; pos: top"></span>
                  </th>
                  <th>{{ t('column_description') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_cat_desc') }}; pos: top"></span>
                  </th>
                  <th>{{ t('column_letter') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_cat_puzzle_letter') }}; pos: top"></span>
                  </th>
                  <th>{{ t('column_comment') }}
                    <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_cat_comment') }}; pos: top"></span>
                  </th>
                  <th>
                    <span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_cat_remove') }}; pos: top"></span>
                  </th>
              </tr>
            </thead>
            <tbody id="catalogList" uk-sortable="handle: .uk-sortable-handle; group: sortable-group"></tbody>
          </table>
        </div>
        <div class="uk-margin">
          <button id="newCatBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_cat_add') }}; pos: left"></button>
        </div>
        <div class="uk-margin uk-flex uk-flex-right">
          <button id="catalogsSaveBtn" class="uk-icon-button uk-button-primary fab fab-save" uk-icon="check" uk-tooltip="title: {{ t('tip_cat_save') }}; pos: left"></button>
        </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'questions' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_questions') }}</h2>
        <div class="uk-margin">
          <label class="uk-form-label" for="catalogSelect">{{ t('label_catalog_select') }}
            <span class="uk-margin-small-left" uk-icon="icon: question" uk-tooltip="title: {{ t('tip_catalog_select') }}; pos: right"></span>
          </label>
          <div class="uk-form-controls">
            <select id="catalogSelect" class="uk-select uk-margin-small-top"></select>
          </div>
        </div>
        <!-- Hauptdatenbereich: Frageneditor -->
        <div id="questions" class="uk-margin"></div>
        <!-- Bedienleiste fuer Frageneditor -->
        <div id="questionActions">
          <div class="uk-margin">
            <button id="addBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_question_add') }}; pos: left"></button>
          </div>
          <div class="uk-margin uk-flex uk-flex-right">
            <button id="resetBtn" class="uk-button uk-button-default uk-margin-right" uk-tooltip="title: {{ t('tip_question_reset') }}; pos: left">{{ t('action_reset') }}</button>
            <button id="saveBtn" class="uk-icon-button uk-button-primary fab fab-save" uk-icon="check" uk-tooltip="title: {{ t('tip_question_save') }}; pos: left"></button>
          </div>
        </div>
        <!-- Ende Hauptdatenbereich -->

      </div>
    </li>
    <li class="{{ activeRoute == 'teams' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_teams') }}</h2>
        <div class="uk-overflow-auto">
          <table id="teamsTable" class="uk-table uk-table-divider uk-table-small">
            <thead class="table-headings">
              <tr>
                <th></th>
                <th>{{ t('column_name') }}</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="teamsList" uk-sortable="handle: .uk-sortable-handle; group: sortable-group"></tbody>
          </table>
        </div>
        <div class="uk-margin">
          <button id="teamAddBtn" class="uk-icon-button uk-button-primary fab" uk-icon="plus" uk-tooltip="title: {{ t('tip_team_add') }}; pos: left"></button>
        </div>
        <div class="uk-margin uk-flex uk-flex-right">
          <button id="teamsSaveBtn" class="uk-icon-button uk-button-primary fab fab-save" uk-icon="check" uk-tooltip="title: {{ t('tip_team_save') }}; pos: left"></button>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'summary' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div class="uk-flex uk-flex-between uk-flex-middle" id="summaryEvent">
          <div>
            <h2 class="uk-heading-bullet" id="summaryEventName">{{ event.name }}</h2>
            <p id="summaryEventDesc">{{ event.description }}</p>
          </div>
          <div class="uk-text-center uk-margin-small-bottom">
            <img id="summaryEventQr" class="qr-img" src="{{ basePath }}/qr/event?t={{ (baseUrl ? baseUrl : '?event=' ~ event.uid)|url_encode }}" alt="QR" width="96" height="96">
            <div id="summaryEventLabel" class="qr-label">{{ event.name }}</div>
            <button id="summaryEventDesignBtn" class="uk-icon-button uk-margin-small-top" uk-icon="icon: paint-bucket" aria-label="QR-Design" type="button"></button>
          </div>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_catalogs') }}</h3>
        <div class="card-grid" uk-grid id="summaryCatalogs">
          {% for c in catalogs %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card uk-card-default uk-card-body">
              {% if event.uid %}
                {% set link = baseUrl ? baseUrl ~ '/?event=' ~ event.uid ~ '&katalog=' ~ c.slug : '?event=' ~ event.uid ~ '&katalog=' ~ c.slug %}
              {% else %}
                {% set link = baseUrl ? baseUrl ~ '/?katalog=' ~ c.slug : '?katalog=' ~ c.slug %}
              {% endif %}
              <h4 class="uk-card-title"><a href="{{ link }}" target="_blank">{{ c.name }}</a></h4>
              <p>{{ c.description }}</p>
              <img class="qr-img" src="{{ basePath }}/qr/catalog?t={{ link|url_encode }}" alt="QR" width="96" height="96">
              <div class="qr-label">{{ c.name }}</div>
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card uk-card-default uk-card-body">{{ t('text_no_catalogs') }}</div>
          </div>
          {% endfor %}
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_teams') }}</h3>
        <div class="card-grid" uk-grid id="summaryTeams">
          {% for t in teams %}
          <div class="uk-width-1-1 uk-width-1-2@s">
            <div class="export-card uk-card uk-card-default uk-card-body uk-position-relative">
              <button class="qr-print-btn uk-icon-button uk-position-top-right" data-team="{{ t }}" uk-icon="icon: print" aria-label="QR-Code drucken"></button>
              <h4 class="uk-card-title">{{ t }}</h4>
              <img class="qr-img" src="{{ basePath }}/qr/team?t={{ t|url_encode }}" alt="Team QR" width="96" height="96">
              <div class="qr-label">{{ t }}</div>
            </div>
          </div>
          {% else %}
          <div class="uk-width-1-1">
            <div class="export-card uk-card uk-card-default uk-card-body">{{ t('text_no_data') }}</div>
          </div>
          {% endfor %}
        </div>
        <div class="uk-margin uk-flex uk-flex-between uk-flex-middle">
          <button id="inviteTextBtn" class="uk-button uk-button-default uk-margin-right" type="button" uk-toggle="target: #inviteTextModal">
            <span id="inviteTextIcon" uk-icon="icon: pencil"></span>
            <span id="inviteTextLabel">{{ t('action_invite_text') }}</span>
          </button>
          <div class="uk-flex">
            <button id="openInvitesBtn" class="uk-button uk-button-default uk-margin-right" uk-tooltip="title: {{ t('tip_invitations_open') }}; pos: right">{{ t('action_open_invitations') }}</button>
            <button id="summaryPrintBtn" class="uk-button uk-button-default uk-margin-right" uk-tooltip="title: {{ t('tip_summary_print') }}; pos: right">{{ t('action_print_summary') }}</button>
            <button id="summaryDesignAllBtn" class="uk-button uk-button-default" type="button">{{ t('action_design_qrcodes') }}</button>
          </div>
        </div>
        <div id="inviteTextModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
          <h2 class="uk-modal-title">{{ t('heading_invite_text') }}</h2>
            <div id="inviteTextToolbar" class="uk-margin-small-bottom">
              <div class="uk-inline">
                <button class="uk-button uk-button-default" type="button">
                  Tags <span uk-icon="icon: triangle-down"></span>
                </button>
                <div uk-dropdown="mode: click">
                  <ul class="uk-nav uk-dropdown-nav">
                    <li><button class="uk-button uk-button-text" type="button" data-format="h2">H2</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h3">H3</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h4">H4</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="h5">H5</button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="bold"><strong>B</strong></button></li>
                    <li><button class="uk-button uk-button-text" type="button" data-format="italic"><em>I</em></button></li>
                  </ul>
                </div>
              </div>
              <button class="uk-button uk-button-default" type="button" data-insert="[TEAM]">[TEAM]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_NAME]">[EVENT_NAME]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_START]">[EVENT_START]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_END]">[EVENT_END]</button>
              <button class="uk-button uk-button-default" type="button" data-insert="[EVENT_DESCRIPTION]">[EVENT_DESCRIPTION]</button>
            </div>
            <textarea id="inviteTextTextarea" class="uk-textarea" rows="5" placeholder="{{ t('placeholder_invite_text') }}"></textarea>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="inviteTextSave" class="uk-button uk-button-primary" type="button">{{ t('action_save') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
        <div id="qrDesignModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">QR-Design</h2>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrLabelInput">Label</label>
              <textarea class="uk-textarea" id="qrLabelInput" rows="2"></textarea>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrColorInput">Farbe</label>
              <input class="uk-input" id="qrColorInput" type="color">
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrLogoFile">{{ t('label_custom_logo') }}</label>
              <input class="uk-input" id="qrLogoFile" type="file" accept="image/png,image/webp">
            </div>
            <div class="uk-margin">
              <label><input class="uk-checkbox" id="qrPunchoutInput" type="checkbox"> Logo-Hintergrund ausstanzen</label>
            </div>
            <div class="uk-margin">
              <label><input class="uk-checkbox" id="qrRoundedInput" type="checkbox"> Runde Marker</label>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="qrRoundModeSelect">Rundungsmodus</label>
              <select class="uk-select" id="qrRoundModeSelect">
                <option value="margin">Margin</option>
                <option value="enlarge">Enlarge</option>
                <option value="shrink">Shrink</option>
                <option value="none">None</option>
              </select>
            </div>
            <div class="uk-margin uk-text-center">
              <img id="qrDesignPreview" src="" alt="Preview" width="150" height="150">
            </div>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="qrDesignApply" class="uk-button uk-button-primary" type="button">Übernehmen</button>
              <button class="uk-button uk-button-default uk-modal-close uk-margin-small-left" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
        </div>
      </li>
    <li class="{{ activeRoute == 'results' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div class="uk-flex uk-flex-between uk-flex-middle">
          <h2 class="uk-heading-bullet">{{ t('heading_results') }}</h2>
          <button id="resultsRefreshBtn" class="uk-icon-button" uk-icon="icon: refresh; ratio: 1.2" title="{{ t('action_refresh') }}" aria-label="{{ t('action_refresh') }}"></button>
        </div>
        <div id="rankingGrid" class="uk-grid-small uk-child-width-1-1 uk-child-width-1-3@m uk-margin-bottom" uk-grid uk-height-match="target: > div > .uk-card"></div>
        <div style="overflow-x: auto">
        <table class="uk-table uk-table-divider uk-table-responsive">
          <thead>
            <tr><th>{{ t('column_name') }}</th><th>{{ t('column_attempt') }}</th><th>{{ t('column_catalog') }}</th><th>{{ t('column_correct') }}</th><th>{{ t('column_time') }}</th><th>{{ t('column_puzzle_solved') }}</th><th>{{ t('column_proof_photo') }}</th></tr>
          </thead>
          <tbody id="resultsTableBody" uk-lightbox="nav: thumbnav; slidenav: false">
            {% for r in results %}
            <tr>
              <td>{{ r.name }}</td>
              <td>{{ r.attempt }}</td>
              <td>{{ r.catalogName ?? r.catalog }}</td>
              <td>{{ r.correct }}/{{ r.total }}</td>
              <td>{{ r.time | date('Y-m-d H:i') }}</td>
              <td>{% if r.puzzleTime is defined %}{{ r.puzzleTime | date('Y-m-d H:i') }}{% endif %}</td>
              <td>
                {% if r.photo is defined and r.photo %}
                <span class="photo-wrapper">
                  <a class="uk-inline rotate-link" href="{{ basePath ~ r.photo }}" data-caption='<button class="uk-icon-button lightbox-rotate-btn" type="button" uk-icon="history" data-path="{{ basePath ~ r.photo }}" aria-label="Drehen"></button>' data-attrs="class: uk-inverse-light">
                    <img src="{{ basePath ~ r.photo }}" alt="Beweisfoto" class="proof-thumb">
                  </a>
                </span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="7">{{ t('text_no_data') }}</td></tr>
            {% endfor %}
          </tbody>
        </table>
        </div>
        <ul id="resultsPagination" class="uk-pagination uk-flex-center"></ul>
        <div class="uk-margin uk-flex uk-flex-between">
          <button id="resultsResetBtn" class="uk-button uk-button-default" uk-tooltip="title: {{ t('tip_results_reset') }}; pos: right">{{ t('action_reset') }}</button>
          <div class="uk-flex">
            <button id="resultsPdfBtn" class="uk-button uk-button-primary uk-margin-right" uk-tooltip="title: {{ t('tip_results_pdf') }}; pos: right">{{ t('action_open_evaluation') }}</button>
            <button id="resultsDownloadBtn" class="uk-button uk-button-primary" uk-tooltip="title: {{ t('tip_results_download') }}; pos: right">{{ t('action_download') }}</button>
          </div>
        </div>

        <div id="resultsResetModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <p>Beim Zurücksetzen der Statistik werden auch alle hochgeladenen Beweisfotos unwiderruflich gelöscht. Dieser Vorgang kann nicht rückgängig gemacht werden.<br>Soll die Statistik nun zurückgesetzt werden?</p>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="resultsResetConfirm" class="uk-button uk-button-danger" type="button">{{ t('action_delete') }}</button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="{{ activeRoute == 'statistics' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <div class="uk-flex uk-flex-middle uk-flex-column uk-flex-row@s uk-flex-between@s">
          <h2 class="uk-heading-bullet">{{ t('heading_statistics') }}</h2>
          <div class="uk-flex uk-flex-middle uk-margin-small-top uk-margin-remove-top@s">
            <select id="statsFilter" class="uk-select uk-width-small uk-margin-right">
              <option value="">Alle</option>
            </select>
            <button id="statsRefreshBtn" class="uk-icon-button" uk-icon="icon: refresh; ratio: 1.2" title="{{ t('action_refresh') }}" aria-label="{{ t('action_refresh') }}"></button>
          </div>
        </div>
        <div style="overflow-x: auto">
        <table class="uk-table uk-table-divider uk-table-responsive">
          <thead>
            <tr><th>{{ t('column_name') }}</th><th>{{ t('column_attempt') }}</th><th>{{ t('column_catalog') }}</th><th>{{ t('column_question') }}</th><th>{{ t('column_answer') }}</th><th>{{ t('column_correct') }}</th><th>{{ t('column_proof_photo') }}</th></tr>
          </thead>
          <tbody id="statsTableBody" uk-lightbox="nav: thumbnav; slidenav: false"></tbody>
        </table>
        </div>
      </div>
    </li>
      {% if role == 'admin' %}
      <li class="{{ activeRoute == 'pages' ? 'uk-active' }}">
        <div class="uk-container uk-container-large">
          <h2 class="uk-heading-bullet">{{ t('heading_pages') }}</h2>
          <ul id="pageTabs" class="uk-tab" uk-tab="connect: #pageSwitcher">
            <li class="uk-active"><a href="#">{{ t('tab_landingpage_seo') }}</a></li>
            <li data-slug="landing"><a href="#">Landing</a></li>
            <li data-slug="impressum"><a href="#">Impressum</a></li>
            <li data-slug="datenschutz"><a href="#">Datenschutz</a></li>
            <li data-slug="faq"><a href="#">FAQ</a></li>
          </ul>
          <ul id="pageSwitcher" class="uk-switcher uk-margin">
            <li>
              <form class="uk-form-stacked seo-form" action="{{ basePath }}/admin/landingpage/seo" method="post">
                <input type="hidden" name="pageId" value="1">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="uk-margin">
                  <label class="uk-form-label" for="metaTitle">Meta Title</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="metaTitle" name="meta_title" type="text" required data-maxlength="60" value="{{ seo_config.metaTitle|default('') }}">
                    <small class="uk-text-meta char-count" data-for="metaTitle">0/60</small>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="metaDescription">Meta Description</label>
                  <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="metaDescription" name="meta_description" required data-maxlength="160">{{ seo_config.metaDescription|default('') }}</textarea>
                    <small class="uk-text-meta char-count" data-for="metaDescription">0/160</small>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="slug">Slug</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="slug" name="slug" type="text" required data-maxlength="100" value="{{ seo_config.slug|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="canonical">Canonical</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="canonical" name="canonical" type="url" value="{{ seo_config.canonicalUrl|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="robots">Robots</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="robots" name="robots" type="text" placeholder="index, follow" value="{{ seo_config.robotsMeta|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label">OG-Tags</label>
                  <div class="uk-form-controls">
                    <input class="uk-input uk-margin-small-bottom" id="ogTitle" name="og_title" type="text" placeholder="og:title" data-maxlength="60" value="{{ seo_config.ogTitle|default('') }}">
                    <input class="uk-input uk-margin-small-bottom" id="ogDescription" name="og_description" type="text" placeholder="og:description" data-maxlength="160" value="{{ seo_config.ogDescription|default('') }}">
                    <input class="uk-input" id="ogImage" name="og_image" type="url" placeholder="og:image" value="{{ seo_config.ogImage|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="schema">Schema.org</label>
                  <div class="uk-form-controls">
                    <textarea class="uk-textarea" id="schema" name="schema" rows="4" placeholder="{ }">{{ seo_config.schemaJson|default('') }}</textarea>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label" for="hreflang">hreflang</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" id="hreflang" name="hreflang" type="text" placeholder="de, en, ..." value="{{ seo_config.hreflang|default('') }}">
                  </div>
                </div>
                <div class="uk-margin">
                  <button type="button" class="uk-button uk-button-default import-seo-example">Beispiel importieren</button>
                  <button type="submit" class="uk-button uk-button-primary uk-margin-left">Speichern</button>
                </div>
              </form>
            </li>
            {% for slug, html in pages %}
            <li>
              <form class="page-form" data-slug="{{ slug }}">
                <input type="hidden" id="page_{{ slug }}" name="content" value="{{ html|e('html_attr') }}">
                <div class="page-editor" data-content="{{ html|e('html_attr') }}"></div>
                <div class="uk-margin-top">
                  <button class="uk-button uk-button-primary save-page-btn">Speichern</button>
                  <a class="uk-button uk-button-default preview-link" href="{{ basePath }}/{{ slug }}" target="_blank">Vorschau</a>
                </div>
              </form>
            </li>
            {% endfor %}
          </ul>
        </div>
      </li>
      <li class="{{ activeRoute == 'management' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_management') }}</h2>

        <h3 class="uk-heading-bullet">{{ t('heading_homepage') }}</h3>
        <div class="uk-margin uk-flex uk-flex-middle">
          <select id="cfgHomePage" class="uk-select uk-width-auto">
            <option value="help"{% if settings.home_page != 'events' and settings.home_page != 'landing' %} selected{% endif %}>{{ t('option_help_page') }}</option>
            <option value="events"{% if settings.home_page == 'events' %} selected{% endif %}>{{ t('option_events_page') }}</option>
            <option value="landing"{% if settings.home_page == 'landing' %} selected{% endif %}>{{ t('option_landing_page') }}</option>
          </select>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_registration') }}</h3>
        <div class="uk-margin uk-flex uk-flex-middle">
          <label><input class="uk-checkbox" type="checkbox" id="cfgRegistrationEnabled" {% if settings.registration_enabled == '1' %}checked{% endif %}> {{ t('label_registration_enabled') }}</label>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_users') }}</h3>
        <div class="uk-overflow-auto">
          <table class="uk-table uk-table-divider uk-table-small">
            <thead>
              <tr>
                <th><span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_sort_rows') }}; pos: top"></span></th>
                <th>{{ t('column_username') }}</th>
                <th>{{ t('column_role') }}</th>
                <th>Aktiv</th>
                <th><span uk-icon="icon: key" uk-tooltip="title: {{ t('tip_user_pass') }}; pos: top"></span></th>
                <th><span uk-icon="icon: question" uk-tooltip="title: {{ t('tip_user_remove') }}; pos: top"></span></th>
              </tr>
            </thead>
            <tbody id="usersList" uk-sortable="handle: .uk-sortable-handle; group: sortable-group"></tbody>
          </table>
        </div>
        <div class="uk-margin">
          <button id="userAddBtn" class="uk-icon-button uk-button-default" uk-icon="plus" uk-tooltip="title: {{ t('tip_user_add') }}; pos: right"></button>
        </div>

        <div id="userPassModal" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">Passwort setzen</h2>
            <div class="uk-margin"><input id="userPassInput" class="uk-input" type="password" placeholder="Passwort"></div>
            <div class="uk-margin"><input id="userPassRepeat" class="uk-input" type="password" placeholder="Wiederholen"></div>
            <div class="uk-flex uk-flex-right uk-margin-top">
              <button id="userPassSave" class="uk-icon-button uk-button-primary" uk-icon="check" type="button"></button>
              <button class="uk-button uk-button-default uk-modal-close" type="button">{{ t('action_cancel') }}</button>
            </div>
          </div>
        </div>

        <h3 class="uk-heading-bullet">{{ t('heading_backups') }}</h3>
        <div class="uk-margin uk-child-width-1-1 uk-child-width-auto@s uk-grid-small uk-flex-right@s" uk-grid>
          <div>
            <button id="exportJsonBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_export') }}; pos: right">{{ t('action_create_backup') }}</button>
          </div>
          <div>
            <button id="importJsonBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_import') }}; pos: right">{{ t('action_restore_demo') }}</button>
          </div>
          <div>
            <button id="saveDemoBtn" class="uk-button uk-button-default uk-width-1-1" uk-tooltip="title: {{ t('tip_backup_save') }}; pos: right">{{ t('action_save_demo') }}</button>
          </div>
        </div>
        <table class="uk-table uk-table-divider">
          <thead>
            <tr><th>{{ t('column_folder') }}</th><th>{{ t('column_actions') }}</th></tr>
          </thead>
          <tbody id="backupTableBody">
            <tr><td colspan="2">{{ t('text_no_backups') }}</td></tr>
          </tbody>
        </table>
      </div>
    </li>
    {% if domainType == 'main' %}
    <li class="{{ activeRoute == 'tenants' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_tenants') }}</h2>

        <!-- FILTER / TOOLBAR -->
        <div class="uk-flex uk-flex-wrap uk-flex-middle uk-margin">
          <div class="uk-margin-small-right">
            <select id="tenantStatusFilter" class="uk-select uk-form-small" aria-label="Status filtern">
              <option value="">Alle</option>
              <option value="active">Aktiv</option>
              <option value="canceled">Gekündigt</option>
              <option value="simulated">Simuliert</option>
            </select>
          </div>

          <div class="uk-margin-small-right uk-width-expand">
            <div class="uk-inline uk-width-1-1">
              <span class="uk-form-icon" uk-icon="icon: search"></span>
              <input id="tenantSearchInput" class="uk-input uk-form-small" type="search" placeholder="Suchen (Subdomain, Kunde, E-Mail)">
            </div>
          </div>

          <div class="uk-button-group uk-margin-small-top@s">
            <button class="uk-button uk-button-default uk-button-small">Exportieren</button>
            <button class="uk-button uk-button-default uk-button-small">Auswertung</button>
            <button class="uk-button uk-button-default uk-button-small">Spalten</button>
            <button id="tenantSyncBtn" class="uk-button uk-button-default uk-button-small">Sync</button>
          </div>
        </div>

        <!-- DESKTOP TABLE -->
        <div class="uk-visible@s uk-overflow-auto">
          <table class="uk-table uk-table-divider uk-table-middle uk-table-striped qr-table">
            <thead>
              <tr>
                <th class="sticky">{{ t('column_subdomain') }}</th>
                <th>{{ t('column_plan') }}</th>
                <th>{{ t('column_billing') }}</th>
                <th>{{ t('column_created') }}</th>
                <th class="uk-text-right">{{ t('column_actions') }}</th>
              </tr>
            </thead>
            <tbody id="tenantTableBody"></tbody>
          </table>
        </div>

        <!-- MOBILE CARDS -->
        <div id="tenantCards" class="uk-hidden@s"></div>
      </div>
    </li>
    {% endif %}
    {% endif %}
    {% if activeRoute == 'profile' %}
    <li class="{{ activeRoute == 'profile' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_profile') }}</h2>
        {% if tenant %}
        <form id="profileForm" class="uk-form-stacked">
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_subdomain') }}</label>
              <input class="uk-input" type="text" name="subdomain" value="{{ tenant.subdomain }}" readonly>
            </div>
            <div class="uk-width-1-1">
              <label class="uk-form-label">{{ t('language') }}</label>
              <select id="langSelect" class="uk-select uk-form-width-small">
                <option value="de" {{ locale() == 'de' ? 'selected' }}>{{ t('german') }}</option>
                <option value="en" {{ locale() == 'en' ? 'selected' }}>{{ t('english') }}</option>
              </select>
            </div>
            <div class="uk-width-1-1">
              <label class="uk-form-label">{{ t('column_imprint_name') }}</label>
              <input class="uk-input" type="text" name="imprint_name" value="{{ tenant.imprint_name|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_street') }}</label>
              <input class="uk-input" type="text" name="imprint_street" value="{{ tenant.imprint_street|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_zip') }}</label>
              <input class="uk-input" type="text" name="imprint_zip" value="{{ tenant.imprint_zip|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_city') }}</label>
              <input class="uk-input" type="text" name="imprint_city" value="{{ tenant.imprint_city|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_imprint_email') }}</label>
              <input class="uk-input" type="email" name="imprint_email" value="{{ tenant.imprint_email|default('') }}">
            </div>
            <div class="uk-width-1-2@s">
              <label class="uk-form-label">{{ t('column_created') }}</label>
              <input class="uk-input" type="text" value="{{ tenant.created_at }}" readonly>
            </div>
          </div>
          {% if domainType == 'tenant' %}
          <div class="uk-margin">
            <button id="welcomeMailBtn" type="button" class="uk-button uk-button-default">{{ t('action_send_welcome_mail') }}</button>
          </div>
          {% endif %}
          <button id="profileSaveBtn" class="uk-icon-button uk-button-primary fab fab-save" uk-icon="check" uk-tooltip="title: {{ t('tip_save_changes') }}; pos: left"></button>
        </form>
        {% else %}
        <p>{{ t('text_no_data') }}</p>
        {% endif %}
      </div>
    </li>
    {% endif %}
    <li class="{{ activeRoute == 'subscription' ? 'uk-active' }}">
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">{{ t('heading_subscription') }}</h2>
        {% set hasCustomer = tenant and tenant.stripe_customer_id %}
        <div class="uk-card uk-card-default uk-card-body uk-margin-small" id="subscription-card">
          <div id="subscription-details"
            data-label-plan="{{ t('label_plan') }}"
            data-label-price="{{ t('label_price') }}"
            data-label-status="{{ t('label_invoice_status') }}"
            data-label-next="{{ t('label_next_payment') }}"
            data-action-cancel="{{ t('action_cancel_subscription') }}"
            data-plan-starter="{{ t('plan_starter') }}"
            data-plan-standard="{{ t('plan_standard') }}"
            data-plan-professional="{{ t('plan_professional') }}"></div>
          <div data-subscription
            data-label-plan="{{ t('label_plan') }}"
            data-label-events="{{ t('label_events') }}"
            data-label-catalogs="{{ t('label_catalogs') }}"
            data-label-questions="{{ t('label_questions') }}"
            data-plan-starter="{{ t('plan_starter') }}"
            data-plan-standard="{{ t('plan_standard') }}"
            data-plan-professional="{{ t('plan_professional') }}"></div>
          {% if tenant and tenant.imprint_email %}
            <p>{{ t('subscription_email') }}: {{ tenant.imprint_email }}</p>
          {% endif %}
        </div>
        {% if stripe_configured %}
        <script src="https://js.stripe.com/v3/"></script>
        <div id="stripe-checkout"></div>
          {% if not tenant or not tenant.imprint_email %}
          <div class="uk-margin-top uk-width-1-2@s">
            <label class="uk-form-label">E-Mail für Abrechnung</label>
            <input class="uk-input" type="email" id="subscription-email" placeholder="name@firma.de" required>
            <div class="uk-text-meta">Wird für Stripe-Kund*in verwendet.</div>
          </div>
          {% endif %}
        <div class="uk-child-width-1-1 uk-child-width-1-3@m uk-grid-small uk-margin-top" uk-grid>
          <div>
            <div class="uk-card uk-card-price uk-card-quizrace uk-text-center">
              <span class="uk-label uk-label-success uk-label-large">Kostenlos testen</span>
              <h3 class="uk-card-title uk-text-primary uk-margin-small-top">{{ t('plan_starter') }}</h3>
              <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700;">9&nbsp;€/Monat</div>
              <div class="uk-text-meta uk-margin-small-bottom">Für kleine Events &amp; Einsteiger</div>
              <ul class="uk-list uk-text-left uk-margin-small-bottom">
                <li><b>7 Tage kostenlos testen</b></li>
                <li><b>1 Event gleichzeitig</b></li>
                <li>5 Teams &amp; 5 Kataloge à 5 Fragen</li>
                <li>Unbegrenzte Teilnehmende pro Team¹</li>
                <li>Live-Ranking &amp; Basis-PDF-Export²</li>
                <li>Alle Fragetypen &amp; QR-Codes</li>
                <li>Backup &amp; editierbare Texte³</li>
              </ul>
              <button class="uk-button uk-button-default uk-width-1-1 plan-select" data-plan="starter">{{ t('action_start_subscription') }}</button>
            </div>
          </div>
          <div>
            <div class="uk-card uk-card-popular uk-card-quizrace uk-text-center">
              <span class="uk-label uk-label-large">Meist gewählt</span>
              <h3 class="uk-card-title uk-margin-small-top" style="color:#fff;">{{ t('plan_standard') }}</h3>
              <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700; color:#fff;">39&nbsp;€/Monat</div>
              <div class="uk-text-meta uk-margin-small-bottom" style="color:#fff;">Beliebt bei Schulen &amp; Teams</div>
              <ul class="uk-list uk-text-left uk-margin-small-bottom" style="color:#fff;">
                <li><b>7 Tage kostenlos testen</b></li>
                <li><b>Alle Starter-Funktionen</b></li>
                <li>Bis zu 3 Events gleichzeitig</li>
                <li>10 Teams &amp; 10 Kataloge à 10 Fragen</li>
                <li>Eigene Subdomain</li>
                <li>Vollständiger PDF-Export</li>
              </ul>
              <button class="uk-button uk-button-primary uk-width-1-1 plan-select" data-plan="standard">{{ t('action_start_subscription') }}</button>
            </div>
          </div>
          <div>
            <div class="uk-card uk-card-price uk-card-quizrace uk-text-center">
              <span class="uk-label uk-label-primary uk-label-large">Professional</span>
              <h3 class="uk-card-title uk-text-primary uk-margin-small-top">{{ t('plan_professional') }}</h3>
              <div class="uk-text-xxlarge uk-margin-small-bottom" style="font-weight:700;">79&nbsp;€/Monat</div>
              <div class="uk-text-meta uk-margin-small-bottom">Für Agenturen &amp; Unternehmen</div>
              <ul class="uk-list uk-text-left uk-margin-small-bottom">
                <li><b>7 Tage kostenlos testen</b></li>
                <li><b>Alle Standard-Funktionen</b></li>
                <li>20 Events gleichzeitig (mehr auf Anfrage)</li>
                <li>100 Teams &amp; 50 Kataloge à 50 Fragen</li>
                <li>White-Label &amp; Rollenverwaltung</li>
              </ul>
              <button class="uk-button uk-button-default uk-width-1-1 plan-select" data-plan="professional">{{ t('action_start_subscription') }}</button>
            </div>
          </div>
        </div>
        {% endif %}
        {% if domainType == 'tenant' and hasCustomer %}
        <p class="uk-margin-top"><a class="uk-button uk-button-text" href="{{ basePath }}/admin/subscription/portal">{{ t('action_open_subscription') }}</a></p>
        {% endif %}
        <script>
          window.upgradeUrl = '{{ basePath }}/admin/subscription';
        </script>
      </div>
    </li>
      </ul>
    </main>
  </div>
  <div id="helpSidebar" uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar uk-width-medium">
      <h3 class="uk-margin-remove-top">Hilfe</h3>
      <div id="helpContent"></div>
    </div>
  </div>
  <div id="qr-offcanvas" uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar">
      <button class="uk-offcanvas-close" type="button" uk-close aria-label="{{ t('menu') }}"></button>
      <h3 class="uk-margin-small">QuizRace</h3>
      {% include 'admin/_nav.twig' %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ basePath }}/js/custom-icons.js"></script>
  <script>
    window.quizConfig = {{ config|json_encode|raw }};
    window.quizSettings = {{ settings|json_encode|raw }};
    window.roles = {{ roles|json_encode|raw }};
    window.baseUrl = '{{ baseUrl }}';
    window.mainDomain = '{{ main_domain }}';
    window.domainType = '{{ domainType }}';
    window.pagesContent = {{ pages|json_encode|raw }};
    window.transUpgradeTitle = '{{ t('heading_limit_reached') }}';
    window.transUpgradeText = '{{ t('text_upgrade_required') }}';
    window.transUpgradeAction = '{{ t('action_upgrade') }}';
    window.transUpgradeDocker = '{{ t('action_upgrade_docker') }}';
    window.stripeDashboard = '{{ stripe_sandbox ? 'https://dashboard.stripe.com/test' : 'https://dashboard.stripe.com' }}';
  </script>
  <script src="{{ basePath }}/js/dashboard.js"></script>
  <script src="{{ basePath }}/js/admin.js"></script>
  <script src="{{ basePath }}/js/subscription.js"></script>
  <script src="{{ basePath }}/js/app.js"></script>
  <script src="{{ basePath }}/js/results.js"></script>
  <script src="{{ basePath }}/js/stats.js"></script>
{% endblock %}
