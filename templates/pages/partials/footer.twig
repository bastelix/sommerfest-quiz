{% set footerColumns = cmsFooterColumns|default([]) %}
{% set footerBlocks = cmsFooterBlocks|default({}) %}
{% set footerNavigation = cmsFooterNavigation|default([]) %}
{% set legalLinks = cmsLegalNavigation|default([]) %}
{% set hasFooterColumns = false %}
{% set hasFooterBlocks = false %}

{% for column in footerColumns %}
  {% if column.items|default([]) %}
    {% set hasFooterColumns = true %}
  {% endif %}
{% endfor %}

{% for slot, blocks in footerBlocks %}
  {% if blocks|length > 0 %}
    {% set hasFooterBlocks = true %}
  {% endif %}
{% endfor %}

{% if hasFooterBlocks or hasFooterColumns or footerNavigation or legalLinks %}
  <div class="cms-footer">
    {# New footer blocks system #}
    {% if hasFooterBlocks %}
      <div class="cms-footer__section">
        <div class="cms-footer__blocks uk-grid-small uk-child-width-1-1 uk-child-width-1-3@m" uk-grid>
          {% for slot in ['footer_1', 'footer_2', 'footer_3'] %}
            {% if footerBlocks[slot]|default([]) %}
              <div class="cms-footer__column">
                {% for block in footerBlocks[slot] %}
                  {% if block.isActive|default(true) %}
                    {% include 'pages/partials/footer-block.twig' with {'block': block} %}
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {# Legacy menu columns system #}
    {% elseif hasFooterColumns %}
      <div class="cms-footer__section">
        <div class="cms-footer__columns uk-grid-small uk-child-width-1-1 uk-child-width-1-3@m" uk-grid>
          {% for column in footerColumns %}
            {% if column.items|default([]) %}
              <div class="cms-footer__column">
                <ul class="uk-subnav uk-subnav-divider">
                  {% for link in column.items|default([]) %}
                    <li>
                      <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% elseif footerNavigation %}
      <div class="cms-footer__section">
        <ul class="uk-subnav uk-subnav-divider">
          {% for link in footerNavigation %}
            <li>
              <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if legalLinks %}
      <div class="cms-footer__section">
        <ul class="uk-subnav uk-subnav-divider">
          {% for link in legalLinks %}
            <li>
              <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
{% endif %}
