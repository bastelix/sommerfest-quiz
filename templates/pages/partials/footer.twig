{% set footerColumns = cmsFooterColumns|default([]) %}
{% set footerBlocks = cmsFooterBlocks|default({}) %}
{% set footerNavigation = cmsFooterNavigation|default([]) %}
{% set legalLinks = cmsLegalNavigation|default([]) %}
{% set footerLayout = cmsFooterLayout|default('equal') %}
{% set hasFooterColumns = false %}
{% set hasFooterBlocks = false %}

{% for column in footerColumns %}
  {% if column.items|default([]) %}
    {% set hasFooterColumns = true %}
  {% endif %}
{% endfor %}

{% for slot, blocks in footerBlocks %}
  {% if blocks|length > 0 %}
    {% set hasFooterBlocks = true %}
  {% endif %}
{% endfor %}

{% if hasFooterBlocks or hasFooterColumns or footerNavigation or legalLinks %}
  <div class="cms-footer">
    <div class="cms-footer__section">
      {# New footer blocks system #}
      {% if hasFooterBlocks %}
        <div class="cms-footer__blocks" data-layout="{{ footerLayout }}">
          {% for slot in ['footer_1', 'footer_2', 'footer_3'] %}
            {% if footerBlocks[slot]|default([]) %}
              <div class="cms-footer__column">
                {% for block in footerBlocks[slot] %}
                  {% if block.isActive|default(true) %}
                    {% include 'pages/partials/footer-block.twig' with {'block': block} %}
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {# Legacy menu columns system #}
      {% elseif hasFooterColumns %}
        <div class="cms-footer__blocks">
          {% for column in footerColumns %}
            {% if column.items|default([]) %}
              <div class="cms-footer__column">
                <ul class="footer-block__menu" style="list-style:none;padding:0;margin:0">
                  {% for link in column.items|default([]) %}
                    <li style="margin-bottom:0.5rem">
                      <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% elseif footerNavigation %}
        <div class="cms-footer__blocks" data-layout="centered">
          <div class="cms-footer__column">
            <ul class="uk-subnav uk-subnav-divider" style="justify-content:center">
              {% for link in footerNavigation %}
                <li>
                  <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}

      {% if legalLinks %}
        <div class="cms-footer__legal">
          <ul class="uk-subnav uk-subnav-divider">
            {% for link in legalLinks %}
              <li>
                <a href="{{ link.href|default('#') }}"{% if link.isExternal|default(false) %} target="_blank" rel="noopener"{% endif %}>{{ link.label }}</a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}
