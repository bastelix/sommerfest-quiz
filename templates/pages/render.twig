{% extends 'layouts/cms_base.twig' %}

{% set normalizedNamespace = pageNamespace|default('default') %}
{% set pageTitle = metaTitle|default('') %}
{% set incomingDesign = design|default({}) %}
{% set effectiveAppearance = incomingDesign.appearance|default(appearance|default({})) %}
{% set design = incomingDesign|merge({
  theme: pageTheme|default(incomingDesign.theme|default('light')),
  appearance: effectiveAppearance
}) %}
{% set headerTheme = pageTheme|default(design.theme|default('light')) %}

{% set menuItems = menu|default([]) %}
{% set cmsMenuItems = menuItems|default([]) %}
{% set logoSettings = headerLogo|default({}) %}
{% set logoMode = logoSettings.mode|default('text') %}
{% set logoSrc = logoSettings.src|default(null) %}
{% set logoLabel = logoSettings.label|default(pageTitle|default('QuizRace')) %}
{% set logoAlt = logoSettings.alt|default(logoLabel) %}

{% block body_theme %}
  {{ pageTheme|default('light') }}
{% endblock %}

{% block title %}{{ pageTitle|default('QuizRace') }}{% endblock %}

{% block body_class %}page-render uk-background-default{% endblock %}

{% block body %}
  {% set renderContextData = renderContext is defined ? renderContext : {} %}
  {% set renderContextDesign = renderContextData.design|default({}) %}
  {% set renderTokens = renderContextDesign.tokens|default({}) %}
  {% set renderBrand = renderTokens.brand|default({}) %}
  {% set renderLayout = renderContextDesign.layout|default(renderTokens.layout|default({})) %}
  {% set renderTypography = renderTokens.typography|default({}) %}
  {% set renderComponents = renderTokens.components|default({}) %}

  {% if renderContextData is not empty %}
    <style data-render-context>
      [data-namespace="{{ renderContextData.namespace|default(normalizedNamespace)|e('css') }}"] {
        {% if renderBrand.primary is defined %}
        --brand-primary: {{ renderBrand.primary|e('css') }};
        {% endif %}
        {% if renderBrand.accent is defined %}
        --brand-accent: {{ renderBrand.accent|e('css') }};
        {% endif %}
        {% if renderLayout.profile is defined %}
        --layout-profile: {{ renderLayout.profile|e('css') }};
        {% endif %}
        {% if renderTypography.preset is defined %}
        --typography-preset: {{ renderTypography.preset|e('css') }};
        {% endif %}
        {% if renderComponents.cardStyle is defined %}
        --components-card-style: {{ renderComponents.cardStyle|e('css') }};
        {% endif %}
        {% if renderComponents.buttonStyle is defined %}
        --components-button-style: {{ renderComponents.buttonStyle|e('css') }};
        {% endif %}
      }
    </style>
  {% endif %}

  {% include 'pages/partials/header.twig' with {
    normalizedNamespace: normalizedNamespace,
    headerTheme: headerTheme,
    headerLogo: logoSettings,
    cmsMenuItems: cmsMenuItems,
    cmsMainNavigation: cmsMainNavigation|default([]),
    headerConfig: headerConfig|default({}),
    basePath: basePath,
    cmsSlug: cmsSlug,
    pageTitle: pageTitle
  } only %}

  <div class="uk-container uk-container-expand">
    <main class="cms-page qr-page-renderer">
      <script
        type="application/json"
        data-json="page"
        data-page-slug="{{ cmsSlug }}"
        data-page-namespace="{{ pageJson.namespace ?? pageNamespace }}"
        data-content-namespace="{{ pageJson.contentNamespace ?? contentNamespace }}"
      >
        {{ pageJson|json_encode(constant('JSON_UNESCAPED_UNICODE'))|raw }}
      </script>

      <div
        class="qr-page-renderer"
        data-page-root
        data-page-slug="{{ cmsSlug }}"
        data-page-namespace="{{ pageNamespace }}"
        data-content-namespace="{{ contentNamespace }}"
      ></div>
    </main>

    <noscript>
      {{ content|raw }}
    </noscript>
  </div>
{% endblock %}
