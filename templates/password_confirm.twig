{% extends 'layout.twig' %}

{% block title %}Neues Passwort{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ basePath }}/css/main.css">
  <link rel="stylesheet" href="{{ basePath }}/css/dark.css" media="all">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
{% endblock %}

{% block body_class %}uk-padding{% endblock %}

{% block body %}
  {% embed 'topbar.twig' %}{% endembed %}
  <div class="uk-container uk-flex uk-flex-center uk-margin-large-top">
    <div class="uk-width-1-1@s uk-width-1-2@m uk-width-1-3@l">
      <div class="uk-width-1-1 uk-margin-auto uk-card qr-card uk-card-body uk-box-shadow-large">
        <h3 class="uk-card-title uk-text-center">Neues Passwort</h3>
          {% if success %}
          <div class="uk-alert-success" uk-alert>
            <p>Passwort erfolgreich geändert.</p>
          </div>
          {% elseif mismatch %}
          <div class="uk-alert-danger" uk-alert>
            <p>Passwörter stimmen nicht überein.</p>
          </div>
          {% elseif error %}
          <div class="uk-alert-danger" uk-alert>
            <p>Passwort konnte nicht geändert werden.</p>
          </div>
          {% endif %}
          <div id="mismatch" class="uk-alert-danger" uk-alert hidden>
            <p>Passwörter stimmen nicht überein.</p>
          </div>
          <form method="post" action="{{ action|default('/password/reset/confirm') }}">
            <input type="hidden" name="token" value="{{ token }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}
          <div class="uk-margin">
            <div class="uk-inline uk-width-1-1">
              <span class="uk-form-icon" uk-icon="icon: lock"></span>
              <input class="uk-input uk-form-large" type="password" name="password" placeholder="Passwort" required>
            </div>
          </div>
          <div class="uk-margin">
            <div class="uk-inline uk-width-1-1">
              <span class="uk-form-icon" uk-icon="icon: lock"></span>
              <input class="uk-input uk-form-large" type="password" name="password_repeat" placeholder="Passwort wiederholen" required>
            </div>
          </div>
          <div class="uk-margin">
            <button class="uk-button uk-button-primary uk-button-large uk-width-1-1">Passwort setzen</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

  {% block scripts %}
    <script src="{{ basePath }}/js/custom-icons.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        if (!form) {
          return;
        }
        const pass = form.querySelector('input[name="password"]');
        const repeat = form.querySelector('input[name="password_repeat"]');
        const alert = document.getElementById('mismatch');
        form.addEventListener('submit', function (e) {
          if (pass.value !== repeat.value) {
            e.preventDefault();
            if (alert) {
              alert.hidden = false;
            }
          }
        });
      });
    </script>
  {% endblock %}
