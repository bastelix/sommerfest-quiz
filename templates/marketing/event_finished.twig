{% extends 'layout.twig' %}

{% block title %}{{ event.name }} – Vielen Dank fürs Mitmachen{% endblock %}

{% block body_theme %}light{% endblock %}
{% block body_class %}marketing-page marketing-event-finished uk-background-muted{% endblock %}

{% block head %}
  <link rel="preload" href="{{ basePath }}/css/landing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/landing.css">
  <meta name="page-name" content="Event finished marketing">
  {% set eventConfig = config|default({}) %}
  {% set colorConfig = eventConfig.colors|default({}) %}
  {% set landingPrimary = eventConfig.buttonColor|default(colorConfig.accent|default(null)) %}
  {% set landingBackground = eventConfig.backgroundColor|default(colorConfig.background|default(colorConfig.primary|default(null))) %}
  {% set landingForeground = colorConfig.foreground|default(colorConfig.text|default(null)) %}
  {% set heroStart = colorConfig.heroStart|default(colorConfig.gradientStart|default(landingBackground)) %}
  {% set heroEnd = colorConfig.heroEnd|default(colorConfig.gradientEnd|default(landingPrimary|default(null))) %}
  {% set landingContrast = colorConfig.contrastOnPrimary|default(colorConfig.onPrimary|default(null)) %}
  {% if landingPrimary or landingBackground or landingForeground or heroStart or heroEnd or landingContrast %}
    <style>
      :root {
        {% if landingPrimary %}--qr-landing-primary: {{ landingPrimary }};{% endif %}
        {% if landingBackground %}--qr-bg: {{ landingBackground }};{% endif %}
        {% if landingForeground %}--qr-fg: {{ landingForeground }};{% endif %}
        {% if landingContrast %}--qr-contrast-on-primary: {{ landingContrast }};{% endif %}
        {% if heroStart %}--qr-hero-grad-start: {{ heroStart }};{% endif %}
        {% if heroEnd %}
          --qr-hero-grad-end: {{ heroEnd }};
        {% elseif landingPrimary %}
          --qr-hero-grad-end: {{ landingPrimary }};
        {% endif %}
      }
    </style>
  {% endif %}
{% endblock %}

{% block body %}
  {% set eventConfig = config|default({}) %}
  {% set heroSubtitleSource = event.description|default(null) %}
  {% set heroCommentSource = eventConfig.inviteText|default(null) %}
  {% set heroSubtitleHtml = heroSubtitleSource ? heroSubtitleSource|uikitify : null %}
  {% set heroCommentHtml = heroCommentSource ? heroCommentSource|uikitify : null %}
  {% set heroSubtitleStory = heroSubtitleHtml is not null and (heroSubtitleSource matches '~</?h[2-6]~i' or heroSubtitleSource matches '/<p/i' or heroSubtitleSource|striptags|length > 180) %}
  {% set heroCommentStory = heroCommentHtml is not null and (heroCommentSource matches '~</?h[2-6]~i' or heroCommentSource matches '/<p/i' or heroCommentSource|striptags|length > 180) %}
  <section class="uk-section uk-section-large uk-text-center">
    <div class="uk-container uk-container-small">
      {{ block('marketing_event_title') }}
      {{ block('marketing_event_schedule') }}
      {{ block('marketing_event_story') }}
      {{ block('marketing_event_teaser') }}
      {{ block('marketing_event_followup') }}
    </div>
  </section>
{% endblock %}

{% block marketing_event_title %}
  {% set eventConfig = eventConfig|default(config|default({})) %}
  {% set heroTitle = eventConfig.pageTitle|default(event.name) %}
  {% set hasHeroSubtitle = heroSubtitleHtml is not null and not heroSubtitleStory %}
  {% set hasHeroComment = heroCommentHtml is not null and not heroCommentStory %}
  {% set rawLogo = eventConfig.logoPath|default('/logo-160.svg') %}
  {% set hasLogo = rawLogo is not empty %}
  {% if hasLogo %}
    {% if rawLogo matches '/^https?:\\/\\//i' %}
      {% set logoSrc = rawLogo %}
    {% else %}
      {% set logoSrc = basePath ~ rawLogo %}
    {% endif %}
  {% endif %}
  <div class="marketing-event-hero uk-flex uk-flex-column uk-flex-middle uk-text-center">
    {% if hasLogo %}
      <img class="marketing-event-hero__logo" src="{{ logoSrc }}" alt="{{ heroTitle }}" loading="lazy">
    {% endif %}
    <span class="qr-badge pill pill--soft">Event abgeschlossen</span>
    <h1 class="marketing-event-hero__title uk-heading-medium uk-margin-small-top">{{ heroTitle }}</h1>
    {% if hasHeroSubtitle %}
      <div class="marketing-event-hero__subtitle uk-text-lead uk-margin-small-top">{{ heroSubtitleHtml|raw }}</div>
    {% endif %}
    {% if hasHeroComment %}
      <div class="marketing-event-hero__comment uk-text-meta">{{ heroCommentHtml|raw }}</div>
    {% endif %}
  </div>
{% endblock %}

{% block marketing_event_story %}
  {% set hasStorySubtitle = heroSubtitleHtml is not null and heroSubtitleStory %}
  {% set hasStoryComment = heroCommentHtml is not null and heroCommentStory %}
  {% if hasStorySubtitle or hasStoryComment %}
    <div class="marketing-event-story uk-text-left uk-margin-large-top">
      {% if hasStorySubtitle %}
        {{ heroSubtitleHtml|raw }}
      {% endif %}
      {% if hasStoryComment %}
        {{ heroCommentHtml|raw }}
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

{% block marketing_event_schedule %}
  <div class="marketing-event-schedule">
    <p class="uk-text-lead">Das Event ist beendet{% if end %} – Finale war am {{ end|format_datetime(pattern="dd.MM.yyyy 'um' HH:mm 'Uhr'", locale='de') }}{% endif %}.</p>
    {% if start %}
      <p class="uk-text-muted">Startzeit: {{ start|format_datetime(pattern="dd.MM.yyyy 'um' HH:mm 'Uhr'", locale='de') }}</p>
    {% endif %}
  </div>
{% endblock %}

{% block marketing_event_teaser %}
  {% if not event.description and not heroCommentHtml %}
    <div class="marketing-event-teaser">
      <p class="uk-margin-large-top uk-text-large">Wir hoffen, dass QuizRace für Begeisterung gesorgt hat. Für das nächste Team-Event stehen wir gerne bereit.</p>
    </div>
  {% endif %}
{% endblock %}

{% block marketing_event_followup %}
  <div class="uk-margin-large-top">
    <h2 class="uk-heading-bullet">So geht es weiter</h2>
    <ul class="uk-list uk-list-large uk-text-left">
      <li><strong>Feedback teilen:</strong> Schreibe uns unter <a href="mailto:team@quizrace.app">team@quizrace.app</a>.</li>
      <li><strong>Nächstes Event planen:</strong> Buche eine Beratung über unser <a href="{{ basePath }}/calhelp#contact-us">Kontaktformular</a>.</li>
      <li><strong>Immer informiert bleiben:</strong> Abonniere den <a href="{{ basePath }}/newsletter">QuizRace Newsletter</a>.</li>
    </ul>
  </div>
{% endblock %}
