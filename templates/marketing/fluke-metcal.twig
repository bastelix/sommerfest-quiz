{% extends 'layout.twig' %}

{% import 'marketing/partials/menu.twig' as menu %}
{% import 'marketing/partials/footer-menu.twig' as footerMenu %}

{% set calserverContactHref = basePath ~ '/calserver#contact-us' %}

{% set cmsMainNavigation = cmsMainNavigation|default([]) %}
{% set menuItems = cmsMainNavigation is not empty ? cmsMainNavigation : cmsMenuItems|default([]) %}
{% set footerNavigation = cmsFooterNavigation|default([]) %}
{% set legalNavigation = cmsLegalNavigation|default([]) %}

{% block title %}{{ metaTitle|default('FLUKE MET/CAL mit calServer – Migration & Integration') }}{% endblock %}

{% block head %}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
  <link rel="preload" href="{{ basePath }}/css/marketing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/marketing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/calserver.css">
  <link rel="stylesheet" href="{{ basePath }}/css/fluke-metcal.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/onboarding.css">
  <link rel="stylesheet" href="{{ basePath }}/css/topbar.marketing.css">
  <meta name="page-name" content="FLUKE MET/CAL mit calServer">
{% endblock %}

{% block body_class %}marketing-page calserver-theme{% endblock %}

{% block body %}
  {% set heroLocale = locale() == 'en' ? 'en' : 'de' %}
  {% set heroCopy = {
    'de': {
      'badge': 'MET/TRACK → calServer',
      'title': 'FLUKE MET/CAL mit calServer – sicher migrieren, sauber integrieren.',
      'subtitle': 'Vom MET/TRACK-Altsystem in den calServer – ohne Stillstand. Hybridbetrieb, geprüfte Datenflüsse und DAkkS-taugliche Nachweise in einem Setup.',
      'claim': 'Ein System. Klare Prozesse. Kalibrierscheine im Griff.',
      'bullets': [
        'Umstieg ohne Produktionspause',
        'Hybridbetrieb mit METTEAM',
        'Hosting und Entwicklung in Deutschland'
      ],
      'ctaPrimary': 'Berichte ansehen',
      'ctaSecondary': 'Kontakt aufnehmen',
      'proof': 'Auditfest. DSGVO-konform. Betriebsbereit.',
      'illustrationAlt': 'Illustration: calServer orchestriert MET/CAL, METTEAM und Reporting-Workflows.'
    },
    'en': {
      'badge': 'MET/TRACK → calServer',
      'title': 'FLUKE MET/CAL with calServer – migrate safely, integrate cleanly.',
      'subtitle': 'Move from legacy MET/TRACK into calServer without downtime. Hybrid operations, validated data flows and audit-proof certificates in one setup.',
      'claim': 'One system. Clear processes. Guardband-ready reporting on tap.',
      'bullets': [
        'Transition without production stop',
        'Hybrid with METTEAM',
        'Hosting and Development in Germany'
      ],
      'ctaPrimary': 'View reports',
      'ctaSecondary': 'Contact us',
      'proof': 'Audit ready. GDPR aligned. Production proven.',
      'illustrationAlt': 'Illustration: calServer connects MET/CAL, METTEAM and reporting workflows.'
    }
  }[heroLocale] %}
  <div class="marketing-layout">
    <header class="qr-topbar">
      <nav class="uk-navbar-container topbar" data-uk-navbar>
        <div class="uk-navbar-left">
          <div class="uk-navbar-item">
            <button id="offcanvas-toggle"
                    class="uk-navbar-toggle uk-hidden@m git-btn"
                    data-uk-navbar-toggle-icon
                    data-uk-toggle="target: #qr-offcanvas"
                    aria-controls="qr-offcanvas"
                    aria-expanded="false"
                    aria-label="Menü"></button>
            <a class="uk-logo cs-logo" href="{{ basePath }}/calserver">
              <span class="cs-logo__sr">FLUKE MET/CAL mit calServer</span>
              <span class="cs-logo__image" aria-hidden="true">
                <img class="cs-logo__img"
                     src="{{ basePath }}/uploads/calserver-logo.webp"
                     alt=""
                     loading="eager"
                     decoding="async">
              </span>
              <span class="cs-logo__wordmark" aria-hidden="true">calServer</span>
            </a>
          </div>
        </div>
        <div class="uk-navbar-right">
          {{ menu.render_menu(menuItems, 'uk-navbar-nav uk-visible@m', 'uk-dropdown="offset: 20; delay-hide: 150; pos: bottom-left"') }}
          {% include 'components/config-menu.twig' with {
            show_help: false,
            show_language: headerConfig.show_language|default(true),
            show_theme_toggle: headerConfig.show_theme_toggle|default(true),
            show_contrast_toggle: headerConfig.show_contrast_toggle|default(true)
          } %}

        </div>
      </nav>
    </header>

    <div id="qr-offcanvas" data-uk-offcanvas="overlay: true; flip: true">
      <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close git-btn" type="button" data-uk-close aria-label="Menü schließen"></button>
        {{ menu.render_offcanvas(menuItems, 'uk-nav uk-nav-default') }}
        <a class="uk-button uk-button-default git-btn uk-width-1-1 uk-margin-top offcanvas-cta"
           href="#berichte">
          <span class="uk-margin-small-right" data-uk-icon="icon: file-text"></span>{{ heroCopy.ctaPrimary }}
        </a>
        <a class="uk-button uk-button-primary git-btn uk-width-1-1 uk-margin-top offcanvas-cta"
           href="{{ calserverContactHref }}">
          <span class="uk-margin-small-right" data-uk-icon="icon: receiver"></span>{{ heroCopy.ctaSecondary }}
        </a>
      </div>
    </div>

    <section class="metcal-hero uk-section uk-section-large" aria-labelledby="metcal-hero-title">
      <div class="uk-container">
        <div class="uk-grid uk-grid-large uk-child-width-1-2@m uk-flex-middle" data-uk-grid>
          <div>
            <span class="metcal-hero__badge">{{ heroCopy.badge }}</span>
            <h1 class="metcal-hero__title" id="metcal-hero-title">{{ heroCopy.title }}</h1>
            <p class="metcal-hero__claim">{{ heroCopy.claim }}</p>
            <p class="metcal-hero__subtitle">{{ heroCopy.subtitle }}</p>
            <ul class="metcal-hero__bullets" role="list">
              {% for bullet in heroCopy.bullets %}
                <li role="listitem">
                  <span class="metcal-hero__icon" aria-hidden="true" data-uk-icon="icon: check"></span>{{ bullet }}
                </li>
              {% endfor %}
            </ul>
            <div class="metcal-hero__actions" role="group" aria-label="Primäre Aktionen">
              <a class="uk-button uk-button-primary"
                 href="#berichte"
                 data-analytics-event="click_cta_reports"
                 data-analytics-context="page_metcal"
                 data-analytics-page="/fluke-metcal"
                 data-analytics-target="#berichte"
                 data-analytics-lang="{{ heroLocale }}">
                <span class="uk-margin-small-right" data-uk-icon="icon: file-text"></span>{{ heroCopy.ctaPrimary }}
              </a>
              <a class="uk-button uk-button-default"
                 href="{{ calserverContactHref }}"
                 data-analytics-event="click_cta_contact"
                 data-analytics-context="page_metcal"
                 data-analytics-page="/fluke-metcal"
                 data-analytics-target="/calserver#contact-us">
                <span class="uk-margin-small-right" data-uk-icon="icon: receiver"></span>{{ heroCopy.ctaSecondary }}
              </a>
            </div>
            <p class="metcal-hero__proof">{{ heroCopy.proof }}</p>
          </div>
          <div>
            <div class="metcal-hero__illustration" role="img" aria-label="{{ heroCopy.illustrationAlt }}"></div>
            <div class="metcal-hero__highlight" role="note">
              <h2 class="metcal-hero__highlight-title uk-text-white">Warum Teams wechseln</h2>
              <ul class="metcal-hero__highlight-list" role="list">
                <li role="listitem">Datenübernahme direkt von MET/TRACK</li>
                <li role="listitem">Datenmigration mit Dry-Run &amp; Delta-Regeln</li>
                <li role="listitem">Hybridbetrieb mit MET/CAL, METTEAM und calServer</li>
                <li role="listitem">DAkkS-konforme Zertifikate und Guardband-Aussagen</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div id="marketing-chat-modal" class="uk-flex-top marketing-chat-modal" data-uk-modal>
      <div class="uk-modal-dialog uk-modal-body marketing-chat__dialog" role="dialog" aria-modal="true" aria-label="{{ t('marketing_chat_title') }}">
        <button class="uk-modal-close-default" type="button" data-uk-close aria-label="{{ t('marketing_chat_close') }}"></button>
        <h2 class="uk-modal-title">{{ t('marketing_chat_title') }}</h2>
        <p class="marketing-chat__intro">{{ t('marketing_chat_intro') }}</p>
        <div class="marketing-chat__messages" data-marketing-chat-messages aria-live="polite"></div>
        <p class="marketing-chat__status" data-marketing-chat-status aria-live="assertive"></p>
        <form class="marketing-chat__form" data-marketing-chat-form>
          <label class="uk-form-label" for="marketing-chat-question">{{ t('marketing_chat_question_label') }}</label>
          <div class="marketing-chat__honeypot" aria-hidden="true">
            <label for="marketing-chat-company">Company</label>
            <input type="text"
                   id="marketing-chat-company"
                   name="company"
                   class="uk-input"
                   autocomplete="off"
                   tabindex="-1"
                   data-marketing-chat-honeypot>
          </div>
          <textarea class="uk-textarea"
                    id="marketing-chat-question"
                    name="question"
                    rows="3"
                    autocomplete="off"
                    placeholder="{{ t('marketing_chat_placeholder') }}"
                    data-marketing-chat-input
                    required></textarea>
          <div class="marketing-chat__form-actions">
            <button type="submit" class="uk-button uk-button-primary">
              <span class="uk-margin-small-right" data-uk-icon="icon: commenting"></span>{{ t('marketing_chat_submit') }}
            </button>
            <button type="button" class="uk-button uk-button-default uk-modal-close">{{ t('marketing_chat_close') }}</button>
          </div>
        </form>
      </div>
    </div>

    {% include 'marketing/partials/block-content.twig' %}

    {% include 'marketing/partials/page-modules.twig' with {
      modules: pageModules['after-content']|default([]),
      position: 'after-content'
    } %}

    {% include 'marketing/partials/cookie-consent.twig' %}
    <button class="calserver-floating-button marketing-chat-fab"
            type="button"
            data-marketing-chat-open
            aria-haspopup="dialog"
            aria-controls="marketing-chat-modal"
            aria-label="{{ t('marketing_chat_title') }}">
      <span aria-hidden="true" data-uk-icon="icon: commenting"></span>
    </button>
  </div>
{% endblock %}

{% block footer %}
  <div class="footer-columns">
    <div class="footer-section footer-about">
      <strong>calServer</strong>
      <p>{{ t('calserver_footer_tagline') }}</p>
    </div>
    <div class="footer-section footer-contact">
      <strong>Kontakt</strong>
      <p>
        René Buske<br>
        <a
          class="js-email-link"
          data-user="office"
          data-domain="calhelp.de"
          href="#"
        >office [at] calhelp.de</a><br>
        <a href="tel:+4933203609080">+49&nbsp;33203&nbsp;609080</a>
      </p>
    </div>
    <div class="footer-section footer-navigation">
      <strong>Seiten</strong>
      {% set navigationLinks = footerNavigation is not empty ? footerNavigation : menuItems %}
      {{ footerMenu.render_links(navigationLinks) }}
      <ul>
        <li><a href="{{ basePath }}/calserver">calServer Übersicht</a></li>
      </ul>
    </div>
    <div class="footer-section footer-legal">
      <strong>Rechtliches</strong>
      {{ footerMenu.render_links(legalNavigation) }}
      {% set accessibilityLocale = locale() ?: 'de' %}
      {% set accessibilityUrl = basePath ~ '/calserver-accessibility?lang=' ~ accessibilityLocale %}
      <ul>
        <li><a href="{{ accessibilityUrl }}">{{ t('accessibility') }}</a></li>
      </ul>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {% if turnstileSiteKey %}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  {% endif %}
  <script src="{{ basePath }}/js/custom-icons.js" defer></script>
  <script src="{{ basePath }}/js/storage.js"></script>
  <script>
    (function () {
      try {
        var hasStorageHelpers = typeof STORAGE_KEYS !== 'undefined' &&
          typeof getStored === 'function' &&
          typeof setStored === 'function';
        var darkKey = hasStorageHelpers ? STORAGE_KEYS.DARK_MODE : 'darkMode';
        var storedTheme = hasStorageHelpers ? getStored(darkKey) : (function () {
          try {
            return (typeof localStorage !== 'undefined') ? localStorage.getItem(darkKey) : null;
          } catch (error) {
            return null;
          }
        })();

        if (storedTheme === null) {
          if (hasStorageHelpers) {
            setStored(darkKey, 'false');
          } else if (typeof localStorage !== 'undefined') {
            localStorage.setItem(darkKey, 'false');
          }
        }
      } catch (error) {
        /* empty */
      }
    })();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.js-email-link').forEach(function (anchor) {
        var user = anchor.getAttribute('data-user');
        var domain = anchor.getAttribute('data-domain');
        if (user && domain) {
          var email = user + '@' + domain;
          anchor.href = 'mailto:' + email;
          anchor.textContent = email;
        }
      });
    });
  </script>
  <script>
    (function () {
      var sticky = document.querySelector('[data-metcal-sticky-cta]');
      if (!sticky) {
        return;
      }
      var storageKey = 'metcalStickyDismissed';
      var isDismissed = false;
      try {
        isDismissed = typeof localStorage !== 'undefined' && localStorage.getItem(storageKey) === 'true';
      } catch (error) {
        isDismissed = false;
      }

      var observer;

      function hideSticky(permanent) {
        sticky.classList.remove('metcal-sticky-cta--visible');
        sticky.classList.add('metcal-sticky-cta--dismissed');
        sticky.setAttribute('aria-hidden', 'true');
        if (observer) {
          observer.disconnect();
        }
        if (permanent) {
          try {
            if (typeof localStorage !== 'undefined') {
              localStorage.setItem(storageKey, 'true');
            }
          } catch (error) {
            /* empty */
          }
        }
      }

      if (isDismissed) {
        hideSticky(false);
        return;
      }

      var dismissButton = sticky.querySelector('[data-metcal-sticky-dismiss]');
      if (dismissButton) {
        dismissButton.addEventListener('click', function (event) {
          event.preventDefault();
          hideSticky(true);
        });
      }

      var sentinel = document.querySelector('[data-metcal-sticky-sentinel]');
      if (!sentinel) {
        return;
      }

      observer = new IntersectionObserver(function (entries) {
        if (sticky.classList.contains('metcal-sticky-cta--dismissed')) {
          return;
        }
        entries.forEach(function (entry) {
          if (!entry.isIntersecting) {
            sticky.classList.add('metcal-sticky-cta--visible');
            sticky.removeAttribute('aria-hidden');
          } else {
            sticky.classList.remove('metcal-sticky-cta--visible');
            sticky.setAttribute('aria-hidden', 'true');
          }
        });
      }, { threshold: 0, rootMargin: '-50% 0px 0px 0px' });

      observer.observe(sentinel);
    })();
  </script>
  <script>
    window.marketingChatConfig = {
      endpoint: '{{ marketingChatEndpoint|e('js') }}',
      slug: '{{ marketingSlug|e('js') }}',
      csrfToken: '{{ csrf_token|default('')|e('js') }}',
      locale: '{{ locale() }}',
      texts: {
        intro: '{{ t('marketing_chat_intro_message')|e('js') }}',
        loading: '{{ t('marketing_chat_loading')|e('js') }}',
        errorGeneric: '{{ t('marketing_chat_error_generic')|e('js') }}',
        errorValidation: '{{ t('marketing_chat_error_validation')|e('js') }}',
        errorRateLimited: '{{ t('marketing_chat_error_rate_limited')|e('js') }}',
        sources: '{{ t('marketing_chat_sources')|e('js') }}',
        sourcesToggle: '{{ t('marketing_chat_sources_toggle')|e('js') }}',
        score: '{{ t('marketing_chat_score')|e('js') }}',
        empty: '{{ t('marketing_chat_empty')|e('js') }}',
        question: '{{ t('marketing_chat_question_label')|e('js') }}'
      }
    };
  </script>
  <script>
    window.cookieConsentConfig = {{ cookieConsentConfig|default({})|json_encode|raw }};
  </script>
  <script src="{{ basePath }}/js/marketing-cookie.js" defer></script>
  <script src="{{ basePath }}/js/marketing-consent.js" defer></script>
  <script src="{{ basePath }}/js/marketing-chat.js" defer></script>
  <script src="{{ basePath }}/js/landing.js" defer></script>
{% endblock %}
