{% extends 'layout.twig' %}

{% import 'marketing/partials/menu.twig' as menu %}
{% set menuItems = marketingMenuItems|default([]) %}

{% block title %}{{ metaTitle|default('QuizRace – Das interaktive Team-Quiz für Events') }}{% endblock %}

{% block head %}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="preload" href="{{ basePath }}/css/landing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/landing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/onboarding.css">
  <link rel="stylesheet" href="{{ basePath }}/css/topbar.landing.css">
{% endblock %}

{% block body_theme %}dark{% endblock %}

{% block body_class %}qr-landing dark-mode{% endblock %}

{% block allow_config_background %}false{% endblock %}

{% block body %}
  <div class="landing-content">
    {% set headerMarkup = headerContent is defined and headerContent ? headerContent : '' %}
    <header class="qr-topbar">
      {{ headerMarkup|raw }}
    </header>
    <div id="qr-offcanvas" uk-offcanvas="overlay: true; flip: true">
      <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close git-btn" type="button" uk-close aria-label="Menü schließen"></button>
        {% if headerLogo is defined %}
          <div class="uk-margin-small-bottom">
            <a class="uk-logo" href="landing">
              {% if headerLogo.mode == 'image' and headerLogo.src %}
                <img src="{{ headerLogo.src }}" alt="{{ headerLogo.alt }}">
              {% else %}
                {{ headerLogo.label }}
              {% endif %}
            </a>
          </div>
        {% endif %}
        {{ menu.render_offcanvas(menuItems, 'uk-nav uk-nav-default') }}
        <a class="uk-button uk-button-default git-btn uk-width-1-1 uk-margin-top offcanvas-cta" href="https://quizrace.app/?event=98e5abe1-f80a-4241-8d03-a154ae2f6cb0&amp;katalog=DFB-QUIZ" target="_blank" rel="noopener">
          <span class="uk-margin-small-right" uk-icon="icon: play"></span>Jetzt Demo starten
        </a>
      </div>
    </div>

    {% include 'marketing/partials/page-modules.twig' with {
      modules: pageModules['before-content']|default([]),
      position: 'before-content'
    } %}

    <div class="landing-page-content">
      {% include 'marketing/partials/block-content.twig' %}
    </div>
    {% include 'marketing/partials/page-modules.twig' with {
      modules: pageModules['after-content']|default([]),
      position: 'after-content'
    } %}

    {% if landingNews is defined and landingNews %}
      <section id="landing-news" class="uk-section uk-section-muted landing-news">
        <div class="uk-container">
          <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-bottom">
            <h2 class="uk-heading-medium uk-margin-remove">Neuigkeiten</h2>
            {% if landingNewsIndexUrl is defined and landingNewsIndexUrl %}
              <a class="uk-button uk-button-text" href="{{ landingNewsIndexUrl }}">Alle News</a>
            {% endif %}
          </div>
          <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-3@m" uk-grid>
            {% for item in landingNews %}
              <div>
                {% include 'marketing/_news_teaser.twig' with {
                  entry: item,
                  newsBasePath: landingNewsBasePath
                } %}
              </div>
            {% endfor %}
          </div>
        </div>
      </section>
    {% endif %}
  </div>
{% endblock %}

{% block footer %}
  <div class="footer-columns">
    <div class="footer-section footer-about">
      <strong>QuizRace</strong>
      <p>Interaktive QR-Code-Rallyes für Events &ndash; schnell startklar und datensicher.</p>
    </div>
    <div class="footer-section footer-contact">
      <strong>Kontakt</strong>
      <p>
        René Buske<br>
        <a
          class="js-email-link"
          data-user="office"
          data-domain="calhelp.de"
          href="#"
        >office [at] calhelp.de</a><br>
        <a href="tel:+4933203609080">+49&nbsp;33203&nbsp;609080</a>
      </p>
    </div>
    <div class="footer-section footer-legal">
      <strong>Rechtliches</strong>
      <ul>
        <li><a href="{{ basePath }}/impressum">{{ t('imprint') }}</a></li>
        <li><a href="{{ privacyUrl }}">{{ t('privacy') }}</a></li>
        <li><a href="{{ basePath }}/lizenz">{{ t('license') }}</a></li>
      </ul>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {% if turnstileSiteKey %}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  {% endif %}
  <script src="{{ basePath }}/js/storage.js"></script>
  <script src="{{ basePath }}/js/landing.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.js-email-link').forEach(function (anchor) {
        var user = anchor.getAttribute('data-user');
        var domain = anchor.getAttribute('data-domain');
        if (user && domain) {
          var email = user + '@' + domain;
          anchor.href = 'mailto:' + email;
          anchor.textContent = email;
        }
      });
      var contactForm = document.getElementById('contact-form');
      if (contactForm && !contactForm.hasAttribute('data-contact-endpoint')) {
        contactForm.setAttribute('data-contact-endpoint', '{{ basePath }}/landing/contact');
      }
    });
  </script>
{% endblock %}
