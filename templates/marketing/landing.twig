{% extends 'layout.twig' %}

{% set links = [
    { 'href': '#innovations', 'label': 'Innovationen', 'icon': 'star' },
    { 'href': '#how-it-works', 'label': 'So funktioniert’s', 'icon': 'settings' },
  { 'href': '#scenarios', 'label': 'Szenarien', 'icon': 'thumbnails' },
  { 'href': '#pricing', 'label': 'Preise', 'icon': 'credit-card' },
  { 'href': '#faq', 'label': 'FAQ', 'icon': 'question' },
  { 'href': '#contact-us', 'label': 'Kontakt', 'icon': 'mail' }
] %}
{% if marketingWikiMenu is defined %}
  {% set links = links|merge([{ 'href': marketingWikiMenu.url, 'label': marketingWikiMenu.label, 'icon': 'file-text' }]) %}
{% endif %}

{% block title %}{{ metaTitle|default('QuizRace – Das interaktive Team-Quiz für Events') }}{% endblock %}

{% block head %}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="preload" href="{{ basePath }}/css/landing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/landing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/onboarding.css">
  <link rel="stylesheet" href="{{ basePath }}/css/topbar.landing.css">
{% endblock %}

{% block body_theme %}dark{% endblock %}

{% block body_class %}qr-landing dark-mode{% endblock %}

{% block body %}
  <div class="landing-content">
    {% set headerMarkup = headerContent is defined and headerContent ? headerContent : '' %}
    {% set wikiLinkMarkup = '' %}
    {% if marketingWikiMenu is defined %}
      {% set wikiLinkMarkup = '<li><a href="' ~ marketingWikiMenu.url ~ '"><span class="uk-margin-small-right" uk-icon="icon: file-text"></span>' ~ marketingWikiMenu.label ~ '</a></li>' %}
    {% endif %}
    {% set headerMarkup = headerMarkup|replace({'{{ marketing_wiki_link }}': wikiLinkMarkup}) %}
    <header class="qr-topbar" id="editable-header">
      {{ headerMarkup|raw }}
    </header>
    {% if isAdmin %}
      <button type="button"
              id="header-save"
              class="uk-button uk-button-primary"
              style="position: fixed; bottom: 24px; right: 24px; z-index: 1000;">
        Header speichern
      </button>
    {% endif %}
    <div id="qr-offcanvas" uk-offcanvas="overlay: true; flip: true">
      <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close git-btn" type="button" uk-close aria-label="Menü schließen"></button>
        <ul class="uk-nav uk-nav-default">
          {% for link in links %}
            <li>
              <a href="{{ link.href }}">
                <span class="uk-margin-small-right" uk-icon="icon: {{ link.icon }}"></span>{{ link.label }}
              </a>
            </li>
          {% endfor %}
        </ul>
        <a class="uk-button uk-button-default git-btn uk-width-1-1 uk-margin-top offcanvas-cta" href="https://quizrace.app/?event=98e5abe1-f80a-4241-8d03-a154ae2f6cb0&amp;katalog=DFB-QUIZ" target="_blank" rel="noopener">
          <span class="uk-margin-small-right" uk-icon="icon: play"></span>Jetzt Demo starten
        </a>
      </div>
    </div>

    <section class="qr-hero uk-section uk-section-large">
      <div class="qr-hero-bg hero-bg-quizrace" aria-hidden="true"></div>
      <div class="uk-container">
        <div class="uk-grid uk-grid-large uk-child-width-1-2@m uk-flex-middle" uk-grid>
          <div>
            <span class="qr-badge">Made in Germany</span>
            <h1 class="qr-h1">Das Team-Quiz, das Ihr Event <span id="rotating-word">unvergesslich</span> macht.</h1>
            <p class="qr-sub">Interaktive Quiz-Rallyes für jedes Event – vom Kindergeburtstag bis zur Firmenfeier.
            In Minuten startklar – live, vor Ort oder hybrid.</p>
            <div class="uk-margin-medium-top uk-flex uk-flex-left uk-flex-wrap" style="gap:16px;">
              <a class="btn btn-black cta-main" href="https://quizrace.app/?event=98e5abe1-f80a-4241-8d03-a154ae2f6cb0&amp;katalog=DFB-QUIZ" target="_blank" rel="noopener">
                <span class="uk-margin-small-right" uk-icon="icon: play"></span>Jetzt Demo starten
              </a>
              <a class="btn btn-transparent" href="#how-it-works">
                <span class="uk-margin-small-right" uk-icon="icon: info"></span>Mehr erfahren
              </a>
            </div>
            <div class="qr-proof uk-margin-top">
              <span>Vollständige Quiz-Einrichtung für Ihr Event</span>
            </div>
            {% if provenExpertRating is defined and provenExpertRating %}
              <div class="provenexpert-rating uk-margin-top" aria-label="Bewertungen">
                {{ provenExpertRating|raw }}
              </div>
            {% endif %}
          </div>
          <div>
            <div class="qr-mockup uk-card qr-card">
              <div class="qr-hero-gallery">
                <picture class="qr-hero-gallery__item">
                  <source srcset="{{ basePath }}/uploads/landing/quizrace-shot-backend.avif" type="image/avif">
                  <img src="{{ basePath }}/uploads/landing/quizrace-shot-backend.webp" width="960" height="540" loading="lazy" alt="Screenshot des QuizRace-Backends mit Aufgabenverwaltung und Teamübersicht">
                </picture>
                <picture class="qr-hero-gallery__item">
                  <source srcset="{{ basePath }}/uploads/landing/quizrace-shot-frontend.avif" type="image/avif">
                  <img src="{{ basePath }}/uploads/landing/quizrace-shot-frontend.webp" width="960" height="540" loading="lazy" alt="Screenshot der QuizRace-Frontend-Ansicht für Teilnehmende mit Live-Ranking">
                </picture>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {% set innovations = [
      {
        'title': 'KI-Teamnamen & Warm-up',
        'description': 'Automatische Vorschläge liefern sofort kreative Teamnamen und sorgen mit kleinen Warm-ups für einen motivierten Start.'
      },
      {
        'title': 'Sechs Fragetypen',
        'description': 'Von Multiple Choice über Sortieraufgaben bis zu Foto- und Wissenskarten – abwechslungsreiche Stationen für jedes Event.'
      },
      {
        'title': 'QR-Login & Dunkelmodus',
        'description': 'Ohne App starten: QR-Code scannen, losspielen und auf Wunsch automatisch in den Dunkelmodus wechseln.'
      },
      {
        'title': 'Puzzlewort & Fotoeinwilligung',
        'description': 'Bonus-Rätsel und DSGVO-konforme Foto-Uploads erweitern jede Rallye um kreative Missionen inklusive rechtssicherer Freigabe.'
      },
      {
        'title': 'Mandanten & Branding',
        'description': 'Eigene Subdomains, White-Label-Layouts und flexible Texte passen QuizRace exakt an Ihre Organisation an.'
      },
      {
        'title': 'Barrierefrei & datensicher',
        'description': 'Zugänglich für alle Nutzergruppen, in Deutschland gehostet und mit Performance-Reserven auch für große Teams.'
      }
    ] %}

    <section id="innovations" class="uk-section section section--alt">
      <div class="uk-container container-xl">
        <div class="uk-text-center">
          <span class="qr-badge">Innovationen</span>
          <h2 class="uk-heading-medium">Was QuizRace besonders macht</h2>
          <p class="uk-text-lead uk-margin-small">
            Alles, was Ihre Rallye einzigartig macht: Automatisierung, Vielfalt und Sicherheit in einem Paket.
          </p>
        </div>
        <div class="uk-grid-large uk-grid-match uk-child-width-1-2@m uk-child-width-1-3@l uk-margin-large-top" uk-grid>
          {% for innovation in innovations %}
            <div>
              <div class="uk-card uk-card-quizrace uk-card-body">
                <h3 class="uk-h5 uk-margin-remove">{{ innovation.title }}</h3>
                <p class="uk-margin-small-top">{{ innovation.description }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <div class="section-divider"></div>

    {{ content|raw }}

    {% if landingNews is defined and landingNews %}
      <section id="landing-news" class="uk-section uk-section-muted landing-news">
        <div class="uk-container">
          <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-bottom">
            <h2 class="uk-heading-medium uk-margin-remove">Neuigkeiten</h2>
            {% if landingNewsIndexUrl is defined and landingNewsIndexUrl %}
              <a class="uk-button uk-button-text" href="{{ landingNewsIndexUrl }}">Alle News</a>
            {% endif %}
          </div>
          <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-3@m" uk-grid>
            {% for item in landingNews %}
              <div>
                {% include 'marketing/_news_teaser.twig' with {
                  entry: item,
                  newsBasePath: landingNewsBasePath
                } %}
              </div>
            {% endfor %}
          </div>
        </div>
      </section>
    {% endif %}
  </div>
{% endblock %}

{% block footer %}
  <div class="footer-columns">
    <div class="footer-section footer-about">
      <strong>QuizRace</strong>
      <p>Interaktive QR-Code-Rallyes für Events &ndash; schnell startklar und datensicher.</p>
    </div>
    <div class="footer-section footer-contact">
      <strong>Kontakt</strong>
      <p>
        René Buske<br>
        <a
          class="js-email-link"
          data-user="office"
          data-domain="calhelp.de"
          href="#"
        >office [at] calhelp.de</a><br>
        <a href="tel:+4933203609080">+49&nbsp;33203&nbsp;609080</a>
      </p>
    </div>
    <div class="footer-section footer-legal">
      <strong>Rechtliches</strong>
      <ul>
        <li><a href="{{ basePath }}/impressum">{{ t('imprint') }}</a></li>
        <li><a href="{{ basePath }}/datenschutz">{{ t('privacy') }}</a></li>
        <li><a href="{{ basePath }}/lizenz">{{ t('license') }}</a></li>
      </ul>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {% if isAdmin %}
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/inline/ckeditor.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const header = document.getElementById('editable-header');
        const saveButton = document.getElementById('header-save');

        if (!header || !saveButton || typeof InlineEditor === 'undefined') {
          return;
        }

        InlineEditor.create(header, {
          toolbar: ['bold', 'italic', 'link', 'bulletedList', 'numberedList', 'undo', 'redo'],
        })
          .then(editor => {
            const basePath = window.basePath || '';
            const csrfToken = '{{ csrf_token }}';
            const defaultLabel = saveButton.textContent;

            saveButton.addEventListener('click', async () => {
              saveButton.disabled = true;
              saveButton.textContent = 'Speichern...';

              try {
                const response = await fetch(`${basePath}/api/save-header`, {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken,
                    'X-Requested-With': 'fetch',
                  },
                  body: JSON.stringify({ html: editor.getData() }),
                });

                if (!response.ok) {
                  throw new Error(`Save failed (${response.status})`);
                }

                if (window.UIkit && typeof window.UIkit.notification === 'function') {
                  window.UIkit.notification({ message: 'Header gespeichert.', status: 'success' });
                } else {
                  alert('Header gespeichert.');
                }
              } catch (error) {
                console.error(error);
                if (window.UIkit && typeof window.UIkit.notification === 'function') {
                  window.UIkit.notification({ message: 'Header konnte nicht gespeichert werden.', status: 'danger' });
                } else {
                  alert('Header konnte nicht gespeichert werden.');
                }
              } finally {
                saveButton.disabled = false;
                saveButton.textContent = defaultLabel;
              }
            });
          })
          .catch(error => {
            console.error(error);
          });
      });
    </script>
  {% endif %}
  {% if turnstileSiteKey %}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  {% endif %}
  <script src="{{ basePath }}/js/storage.js"></script>
  <script src="{{ basePath }}/js/landing.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.js-email-link').forEach(function (anchor) {
        var user = anchor.getAttribute('data-user');
        var domain = anchor.getAttribute('data-domain');
        if (user && domain) {
          var email = user + '@' + domain;
          anchor.href = 'mailto:' + email;
          anchor.textContent = email;
        }
      });
      var contactForm = document.getElementById('contact-form');
      if (contactForm && !contactForm.hasAttribute('data-contact-endpoint')) {
        contactForm.setAttribute('data-contact-endpoint', '{{ basePath }}/landing/contact');
      }
    });
  </script>
{% endblock %}
