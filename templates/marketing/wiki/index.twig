{% extends 'layout.twig' %}

{% set themeDefaults = {
  'bodyClasses': ['marketing-wiki'],
  'stylesheets': [],
  'colors': {
    'headerFrom': '#111827',
    'headerTo': '#1f2937',
    'detailHeaderFrom': '#0f172a',
    'detailHeaderTo': '#1d4ed8',
    'headerText': '#ffffff',
    'excerpt': '#4b5563',
    'calloutBorder': '#3b82f6',
    'calloutBackground': '#f9fafb',
    'calloutText': '#0f172a'
  }
} %}
{% set bodyClasses = themeDefaults.bodyClasses %}
{% set stylesheets = themeDefaults.stylesheets %}
{% set colors = themeDefaults.colors %}
{% if wikiTheme is defined %}
  {% if wikiTheme.bodyClasses is defined and wikiTheme.bodyClasses is iterable %}
    {% set bodyClasses = wikiTheme.bodyClasses %}
  {% endif %}
  {% if wikiTheme.stylesheets is defined and wikiTheme.stylesheets is iterable %}
    {% set stylesheets = wikiTheme.stylesheets %}
  {% endif %}
  {% if wikiTheme.colors is defined %}
    {% set colors = themeDefaults.colors|merge(wikiTheme.colors) %}
  {% endif %}
{% endif %}

{% block title %}{{ menuLabel }} – {{ page.getTitle() }}{% endblock %}

{% block body_class %}{{ (bodyClasses is not empty ? bodyClasses : ['marketing-wiki'])|join(' ') }}{% endblock %}

{% block head %}
  <link rel="preload" href="{{ basePath }}/css/landing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/landing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  {% for stylesheet in stylesheets %}
    <link rel="stylesheet" href="{{ basePath }}/css/{{ stylesheet }}">
  {% endfor %}
  <style>
    .marketing-wiki {
      --marketing-wiki-header-from: {{ colors.headerFrom }};
      --marketing-wiki-header-to: {{ colors.headerTo }};
      --marketing-wiki-detail-header-from: {{ colors.detailHeaderFrom }};
      --marketing-wiki-detail-header-to: {{ colors.detailHeaderTo }};
      --marketing-wiki-header-text: {{ colors.headerText }};
      --marketing-wiki-excerpt: {{ colors.excerpt }};
      --marketing-wiki-callout-border: {{ colors.calloutBorder }};
      --marketing-wiki-callout-bg: {{ colors.calloutBackground }};
      --marketing-wiki-callout-text: {{ colors.calloutText }};
    }

    .marketing-wiki__header {
      background: linear-gradient(135deg, var(--marketing-wiki-header-from), var(--marketing-wiki-header-to));
      color: var(--marketing-wiki-header-text);
    }

    .marketing-wiki__breadcrumb a { color: inherit; }

    .marketing-wiki__card { transition: transform .2s ease, box-shadow .2s ease; }

    .marketing-wiki__card:hover { transform: translateY(-2px); box-shadow: 0 18px 35px rgba(15, 23, 42, .15); }

    .marketing-wiki__search { max-width: 540px; margin: 0 auto; }

    .marketing-wiki__search-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
    }
    .marketing-wiki__search-input {
      height: 56px;
      font-size: 1.125rem;
      padding: 0 18px;
    }
    .marketing-wiki__search-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      height: 56px;
      padding: 0 24px;
      font-weight: 600;
    }
    .marketing-wiki__search-button [uk-icon] {
      margin-top: -2px;
    }
    @media (max-width: 640px) {
      .marketing-wiki__search-row {
        grid-template-columns: 1fr;
      }
      .marketing-wiki__search-button {
        width: 100%;
        height: 48px;
      }
      .marketing-wiki__search-input {
        height: 48px;
        font-size: 1rem;
      }
      .marketing-wiki__search-button-text--desktop {
        display: none;
      }
    }
    @media (min-width: 641px) {
      .marketing-wiki__search-button-text--mobile {
        display: none;
      }
    }
    
    .marketing-wiki__list { margin-top: 40px; }

    .marketing-wiki__excerpt { color: var(--marketing-wiki-excerpt); }
  </style>
{% endblock %}

{% block body %}
  <div class="marketing-wiki__header uk-section uk-section-medium">
    <div class="uk-container uk-container-small">
      <nav aria-label="Breadcrumb" class="marketing-wiki__breadcrumb uk-margin-small">
        <ul class="uk-breadcrumb">
          {% for crumb in breadcrumbs %}
            <li{% if loop.last %} class="uk-active" aria-current="page"{% endif %}>
              {% if not loop.last %}
                <a href="{{ crumb.url }}">{{ crumb.label }}</a>
              {% else %}
                <span>{{ crumb.label }}</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
      <h1 class="uk-heading-small uk-margin-remove">{{ menuLabel }}</h1>
      <p class="uk-text-lead uk-margin-small-top">Antworten, Schritt-für-Schritt-Anleitungen und Hintergrundwissen zur {{ page.getTitle() }}.</p>
      <form method="get" class="marketing-wiki__search uk-margin-top">
        <label class="uk-hidden" for="wiki-search">Suche</label>
        <div class="marketing-wiki__search-row">
          <input id="wiki-search"
                 name="q"
                 class="uk-input marketing-wiki__search-input"
                 type="search"
                 placeholder="Artikel suchen"
                 value="{{ searchTerm }}">
          <button type="submit"
                  class="uk-button uk-button-primary marketing-wiki__search-button"
                  aria-label="Suche starten">
            <span uk-icon="search" aria-hidden="true"></span>
            <span class="marketing-wiki__search-button-text--desktop">Suchen</span>
            <span class="marketing-wiki__search-button-text--mobile">Suche</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="uk-section uk-section-default">
    <div class="uk-container uk-container-small marketing-wiki__list">
      <ul class="uk-list uk-list-divider">
        {% for article in articles %}
          <li>
            <article class="marketing-wiki__card uk-card uk-card-default uk-card-body">
              <h2 class="uk-card-title uk-margin-remove">
                <a href="{{ basePath }}/pages/{{ page.getSlug() }}/wiki/{{ article.getSlug() }}" class="uk-link-heading">{{ article.getTitle() }}</a>
              </h2>
              {% if article.getExcerpt() %}
                <p class="marketing-wiki__excerpt uk-margin-small-top">{{ article.getExcerpt() }}</p>
              {% endif %}
              {% set displayDate = article.getUpdatedAt() ?? article.getPublishedAt() %}
              {% if displayDate %}
                <p class="uk-text-meta uk-margin-remove">Aktualisiert am {{ displayDate|date('d.m.Y') }}</p>
              {% endif %}
              <a class="uk-button uk-button-text uk-margin-small-top" href="{{ basePath }}/pages/{{ page.getSlug() }}/wiki/{{ article.getSlug() }}" aria-label="{{ article.getTitle() }} lesen">Weiterlesen</a>
            </article>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}
