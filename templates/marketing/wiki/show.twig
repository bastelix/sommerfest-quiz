{% extends 'layout.twig' %}

{% set themeDefaults = {
  'bodyClasses': ['marketing-wiki'],
  'stylesheets': [],
  'colors': {
    'headerFrom': '#111827',
    'headerTo': '#1f2937',
    'detailHeaderFrom': '#0f172a',
    'detailHeaderTo': '#1d4ed8',
    'headerText': '#ffffff',
    'excerpt': '#4b5563',
    'calloutBorder': '#3b82f6',
    'calloutBackground': '#f9fafb',
    'calloutText': '#0f172a'
  }
} %}
{% set bodyClasses = themeDefaults.bodyClasses %}
{% set stylesheets = themeDefaults.stylesheets %}
{% set colors = themeDefaults.colors %}
{% set logoUrl = wikiTheme.logoUrl|default(null) %}
{% if wikiTheme is defined %}
  {% if wikiTheme.bodyClasses is defined and wikiTheme.bodyClasses is iterable %}
    {% set bodyClasses = wikiTheme.bodyClasses %}
  {% endif %}
  {% if wikiTheme.stylesheets is defined and wikiTheme.stylesheets is iterable %}
    {% set stylesheets = wikiTheme.stylesheets %}
  {% endif %}
  {% if wikiTheme.colors is defined %}
    {% set colors = themeDefaults.colors|merge(wikiTheme.colors) %}
  {% endif %}
  {% if wikiTheme.logoUrl is defined %}
    {% set logoUrl = wikiTheme.logoUrl %}
  {% endif %}
{% endif %}
{% set detailClasses = bodyClasses %}
{% if 'marketing-wiki--detail' not in detailClasses %}
  {% set detailClasses = detailClasses|merge(['marketing-wiki--detail']) %}
{% endif %}

{% block title %}{{ article.getTitle() }} – {{ menuLabel }}{% endblock %}

{% block body_class %}marketing-page {{ (detailClasses is not empty ? detailClasses : ['marketing-wiki', 'marketing-wiki--detail'])|join(' ') }}{% endblock %}

{% block head %}
  <link rel="preload" href="{{ basePath }}/css/marketing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/marketing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <script type="module" src="{{ basePath }}/js/marketing-design.js"></script>
  {% for stylesheet in stylesheets %}
    {% set href = stylesheet matches '/^https?:\\/\\//i' or stylesheet starts with('//') ? stylesheet : (stylesheet starts with('/') ? stylesheet : basePath ~ '/css/' ~ stylesheet) %}
    <link rel="stylesheet" href="{{ href }}">
  {% endfor %}
  <style>
    .marketing-wiki {
      --marketing-wiki-header-from: {{ colors.detailHeaderFrom }};
      --marketing-wiki-header-to: {{ colors.detailHeaderTo }};
      --marketing-wiki-header-text: {{ colors.headerText }};
      --marketing-wiki-callout-border: {{ colors.calloutBorder }};
      --marketing-wiki-callout-bg: {{ colors.calloutBackground }};
      --marketing-wiki-callout-text: {{ colors.calloutText }};
    }

    .marketing-wiki__header {
      background: linear-gradient(135deg, var(--marketing-wiki-header-from), var(--marketing-wiki-header-to));
      color: var(--marketing-wiki-header-text);
    }

    .marketing-wiki__header a,
    .marketing-wiki__header .uk-heading-medium,
    .marketing-wiki__header .uk-text-meta {
      color: inherit;
    }

    .marketing-wiki__header .uk-breadcrumb > li:nth-child(n+2)::before,
    .marketing-wiki__header .uk-breadcrumb > li > a,
    .marketing-wiki__header .uk-breadcrumb > li > span {
      color: var(--marketing-wiki-header-text);
    }

    .marketing-wiki__content { max-width: 760px; margin: 0 auto; }

    .marketing-wiki__article img { max-width: 100%; height: auto; }

    .marketing-wiki__article table { width: 100%; border-collapse: collapse; margin: 24px 0; }

    .marketing-wiki__article table th,
    .marketing-wiki__article table td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }

    .wiki-callout {
      border-left: 4px solid var(--marketing-wiki-callout-border);
      padding: 16px;
      background: var(--marketing-wiki-callout-bg);
      color: var(--marketing-wiki-callout-text);
      margin: 24px 0;
    }

    .wiki-callout strong { display: block; margin-bottom: 8px; }

    .marketing-wiki__logo img {
      max-height: 64px;
      width: auto;
    }
  </style>
{% endblock %}

{% block body %}
  {% include 'marketing/partials/design-data.twig' %}
  <div class="marketing-wiki__header uk-section uk-section-small">
    <div class="uk-container uk-container-small">
      <nav aria-label="Breadcrumb" class="marketing-wiki__breadcrumb uk-margin-small">
        <ul class="uk-breadcrumb">
          {% for crumb in breadcrumbs %}
            <li{% if loop.last %} class="uk-active" aria-current="page"{% endif %}>
              {% if not loop.last %}
                <a href="{{ crumb.url }}">{{ crumb.label }}</a>
              {% else %}
                <span>{{ crumb.label }}</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
      {% if logoUrl %}
        <div class="marketing-wiki__logo uk-margin-small">
          <img src="{{ logoUrl }}" alt="{{ page.getTitle() }} Logo" loading="lazy">
        </div>
      {% endif %}
      <h1 class="uk-heading-medium uk-margin-remove">{{ article.getTitle() }}</h1>
      {% set displayDate = article.getUpdatedAt() ?? article.getPublishedAt() %}
      {% if displayDate %}
        <p class="uk-text-meta">Zuletzt aktualisiert am {{ displayDate|date('d.m.Y') }}</p>
      {% endif %}
    </div>
  </div>

  <div class="uk-section uk-section-default">
    <div class="uk-container marketing-wiki__content">
      <article class="marketing-wiki__article uk-article">
        {{ article.getContentHtml()|raw }}
      </article>
      <hr class="uk-margin-large">
      <div class="uk-flex uk-flex-between uk-flex-middle uk-margin">
        <a class="uk-button uk-button-text" href="{{ basePath }}/pages/{{ page.getSlug() }}/wiki">&larr; Zurück zur Übersicht</a>
        <a class="uk-button uk-button-default" href="{{ basePath }}/pages/{{ page.getSlug() }}">Zur Marketing-Seite</a>
      </div>
    </div>
  </div>
{% endblock %}
