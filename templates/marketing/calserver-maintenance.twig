{% extends 'layout.twig' %}

{% set links = [
    { 'href': '#status', 'label': t('calserver_maintenance_nav_status'), 'icon': 'warning' },
    { 'href': '#timeline', 'label': t('calserver_maintenance_nav_timeline'), 'icon': 'clock' },
    { 'href': '#support', 'label': t('calserver_maintenance_nav_support'), 'icon': 'lifesaver' }
] %}
{% if marketingWikiMenu is defined %}
  {% set links = links|merge([{ 'href': marketingWikiMenu.url, 'label': marketingWikiMenu.label, 'icon': 'file-text' }]) %}
{% endif %}

{% block title %}{{ metaTitle|default('calHelp – Wartungsmodus') }}{% endblock %}

{% block head %}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
  <link rel="preload" href="{{ basePath }}/css/landing.css" as="style">
  <link rel="stylesheet" href="{{ basePath }}/css/landing.css">
  <link rel="stylesheet" href="{{ basePath }}/css/calserver.css">
  <link rel="stylesheet" href="{{ basePath }}/css/calserver-maintenance.css">
  <link rel="stylesheet" href="{{ basePath }}/css/highcontrast.css">
  <link rel="stylesheet" href="{{ basePath }}/css/onboarding.css">
  <link rel="stylesheet" href="{{ basePath }}/css/topbar.landing.css">
  <meta name="page-name" content="calHelp – Wartungshinweis">
{% endblock %}

{% block body_theme %}light{% endblock %}
{% block body_class %}qr-landing calserver-theme calserver-maintenance-theme{% endblock %}

{% block body %}
  <div class="landing-content">
    <header class="qr-topbar">
      <nav class="uk-navbar-container" data-uk-navbar>
        <div class="uk-navbar-left">
          <div class="uk-navbar-item">
            <button id="offcanvas-toggle"
                    class="uk-navbar-toggle uk-hidden@m git-btn"
                    data-uk-navbar-toggle-icon
                    data-uk-toggle="target: #qr-offcanvas"
                    aria-controls="qr-offcanvas"
                    aria-expanded="false"
                    aria-label="Menü"></button>
            <a class="uk-logo" href="{{ basePath }}/calserver-maintenance">calHelp</a>
          </div>
        </div>
        <div class="uk-navbar-right">
          <ul class="uk-navbar-nav uk-visible@m">
            {% for link in links %}
              <li>
                <a href="{{ link.href }}">
                  <span class="uk-margin-small-right" data-uk-icon="icon: {{ link.icon }}"></span>{{ link.label }}
                </a>
              </li>
            {% endfor %}
          </ul>
          {% include 'components/config-menu.twig' with { show_help: false } %}

        </div>
      </nav>
    </header>

    <div id="qr-offcanvas" data-uk-offcanvas="overlay: true; flip: true">
      <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close git-btn" type="button" data-uk-close aria-label="Menü schließen"></button>
        <ul class="uk-nav uk-nav-default">
          {% for link in links %}
            <li>
              <a href="{{ link.href }}">
                <span class="uk-margin-small-right" data-uk-icon="icon: {{ link.icon }}"></span>{{ link.label }}
              </a>
            </li>
          {% endfor %}
        </ul>
        <a class="uk-button uk-button-default git-btn uk-width-1-1 uk-margin-top offcanvas-cta"
           href="#support">
          {{ t('calserver_maintenance_cta_secondary') }}
        </a>
      </div>
    </div>

    <section id="status" class="calserver-maintenance-hero uk-section uk-section-large">
      <div class="uk-container">
        <div class="calserver-maintenance-hero__grid" data-uk-grid>
          <div class="uk-width-2-3@m">
            <div class="calserver-maintenance-hero__copy" data-uk-scrollspy="cls: uk-animation-slide-left-small; repeat: true">
              <span class="calserver-maintenance-hero__badge" aria-hidden="true" data-uk-icon="icon: warning"></span>
              <h1 class="calserver-maintenance-hero__title">{{ t('calserver_maintenance_hero_title') }}</h1>
              <p class="calserver-maintenance-hero__subtitle">{{ t('calserver_maintenance_hero_subtitle') }}</p>
              <div class="calserver-maintenance-hero__actions" role="group" aria-label="{{ t('calserver_maintenance_actions_label') }}">
                <a class="uk-button uk-button-primary git-btn"
                   href="{{ basePath }}/calserver-maintenance/news">
                  <span class="uk-margin-small-right" data-uk-icon="icon: rss"></span>{{ t('calserver_maintenance_cta_primary') }}
                </a>
                <a class="uk-button uk-button-default git-btn"
                   href="#support">
                  <span class="uk-margin-small-right" data-uk-icon="icon: receiver"></span>{{ t('calserver_maintenance_cta_secondary') }}
                </a>
              </div>
            </div>
          </div>
          <div class="uk-width-1-3@m">
            <aside class="calserver-maintenance-status-card" data-uk-scrollspy="cls: uk-animation-slide-right-small; repeat: true">
              <dl class="calserver-maintenance-status">
                <div class="calserver-maintenance-status__item">
                  <dt>{{ t('calserver_maintenance_status_label') }}</dt>
                  <dd>{{ t('calserver_maintenance_status_value') }}</dd>
                </div>
                <div class="calserver-maintenance-status__item">
                  <dt>{{ t('calserver_maintenance_status_window') }}</dt>
                  {% if maintenanceWindowLabel is defined and maintenanceWindowLabel %}
                    {% set suffix = t('calserver_maintenance_status_window_suffix') %}
                    <dd>{{ maintenanceWindowLabel }}{% if suffix %} {{ suffix }}{% endif %}</dd>
                  {% else %}
                    <dd>{{ t('calserver_maintenance_status_window_value') }}</dd>
                  {% endif %}
                </div>
              </dl>
              <p class="calserver-maintenance-status__hint">{{ t('calserver_maintenance_status_hint') }}</p>
            </aside>
          </div>
        </div>
      </div>
    </section>

    {% if landingNews is defined and landingNews %}
      <section class="calserver-maintenance-updates uk-section uk-section-small">
        <div class="uk-container">
          <div class="uk-flex uk-flex-middle uk-flex-between uk-margin-bottom">
            <h2 class="uk-h3 uk-margin-remove">{{ t('calserver_maintenance_updates_heading') }}</h2>
            {% if landingNewsIndexUrl is defined and landingNewsIndexUrl %}
              <a class="uk-button uk-button-text" href="{{ landingNewsIndexUrl }}">{{ t('calserver_maintenance_updates_link') }}</a>
            {% endif %}
          </div>
          <div class="calserver-maintenance-updates__table-wrapper">
            <table class="calserver-maintenance-updates__table">
              <thead>
                <tr>
                  <th scope="col">{{ t('calserver_maintenance_updates_column_date') }}</th>
                  <th scope="col">{{ t('calserver_maintenance_updates_column_title') }}</th>
                  <th scope="col">{{ t('calserver_maintenance_updates_column_excerpt') }}</th>
                </tr>
              </thead>
              <tbody>
                {% for item in landingNews %}
                  {% if item.isPublished %}
                    {% set detailPath = landingNewsBasePath is defined and landingNewsBasePath ? basePath ~ landingNewsBasePath ~ '/' ~ item.slug : null %}
                    <tr>
                      <td class="calserver-maintenance-updates__date-cell">
                        {% if item.publishedAt %}
                          <span class="calserver-maintenance-updates__date">{{ item.publishedAt|date('d.m.Y') }}</span>
                        {% endif %}
                      </td>
                      <td class="calserver-maintenance-updates__title-cell">
                        {% if detailPath %}
                          <a class="calserver-maintenance-updates__link" href="{{ detailPath }}">{{ item.title }}</a>
                        {% else %}
                          <span class="calserver-maintenance-updates__title">{{ item.title }}</span>
                        {% endif %}
                      </td>
                      <td class="calserver-maintenance-updates__excerpt-cell">
                        {% if item.excerpt %}
                          <div class="calserver-maintenance-updates__excerpt">{{ item.excerpt|raw }}</div>
                        {% endif %}
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </section>
    {% endif %}

    {{ content|raw }}
  </div>
{% endblock %}

{% block footer %}
  <div class="footer-columns">
    <div class="footer-section footer-about">
      <strong>calHelp</strong>
      <p>{{ t('calserver_footer_tagline') }}</p>
    </div>
    <div class="footer-section footer-contact">
      <strong>Kontakt</strong>
      <p>
        René Buske<br>
        <a
          class="js-email-link"
          data-user="office"
          data-domain="calhelp.de"
          href="#"
        >office [at] calhelp.de</a><br>
        <a href="tel:+4933203609080">+49&nbsp;33203&nbsp;609080</a>
      </p>
    </div>
    <div class="footer-section footer-navigation">
      <strong>Seiten</strong>
      <ul>
        {% for link in links %}
          <li><a href="{{ link.href }}">{{ link.label }}</a></li>
        {% endfor %}
      </ul>
    </div>
    <div class="footer-section footer-legal">
      <strong>Rechtliches</strong>
      <ul>
        <li><a href="{{ basePath }}/impressum">{{ t('imprint') }}</a></li>
        <li><a href="{{ basePath }}/datenschutz">{{ t('privacy') }}</a></li>
        <li><a href="{{ basePath }}/lizenz">{{ t('license') }}</a></li>
        {% set accessibilityUrl = locale() == 'en' ? basePath ~ '/calserver/accessibility' : basePath ~ '/calserver/barrierefreiheit' %}
        <li><a href="{{ accessibilityUrl }}">{{ t('accessibility') }}</a></li>
      </ul>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {% if turnstileSiteKey %}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  {% endif %}
  <script src="{{ basePath }}/js/custom-icons.js" defer></script>
  <script src="{{ basePath }}/js/storage.js"></script>
  <script>
    (function () {
      try {
        var hasStorageHelpers = typeof STORAGE_KEYS !== 'undefined' &&
          typeof getStored === 'function' &&
          typeof setStored === 'function';
        var darkKey = hasStorageHelpers ? STORAGE_KEYS.DARK_MODE : 'darkMode';
        var storedTheme = hasStorageHelpers ? getStored(darkKey) : (function () {
          try {
            return (typeof localStorage !== 'undefined') ? localStorage.getItem(darkKey) : null;
          } catch (error) {
            return null;
          }
        })();

        if (storedTheme === null) {
          if (hasStorageHelpers) {
            setStored(darkKey, 'true');
          } else if (typeof localStorage !== 'undefined') {
            localStorage.setItem(darkKey, 'true');
          }
        }
      } catch (error) {
        /* empty */
      }
    })();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.js-email-link').forEach(function (anchor) {
        var user = anchor.getAttribute('data-user');
        var domain = anchor.getAttribute('data-domain');
        if (user && domain) {
          var email = user + '@' + domain;
          anchor.href = 'mailto:' + email;
          anchor.textContent = email;
        }
      });
    });
  </script>
  <script src="{{ basePath }}/js/calserver-cookie.js" defer></script>
  <script src="{{ basePath }}/js/calserver.js" defer></script>
  <script src="{{ basePath }}/js/landing.js" defer></script>
{% endblock %}
