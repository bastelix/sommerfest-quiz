{% extends 'layout.twig' %}

{% block title %}
  {% if success %}
    Newsletter bestätigt
  {% else %}
    Newsletter-Bestätigung fehlgeschlagen
  {% endif %}
{% endblock %}

{% block body %}
  <div class="uk-section uk-section-default">
    <div class="uk-container uk-container-small">
      {% set hasCtas = ctas|default([])|length > 0 %}
      {% set fallbackSlug = marketingSlug|default('landing') %}
      {% set fallbackUrl = basePath ~ '/' ~ fallbackSlug %}
      {% if mode == 'confirm' %}
        {% if success %}
          <h1 class="uk-heading-medium">Vielen Dank!</h1>
          <p class="uk-text-lead">Deine Anmeldung zum QuizRace Newsletter wurde bestätigt.</p>
          <p>Du erhältst künftig gelegentlich Neuigkeiten und Event-Tipps direkt in dein Postfach. Du kannst dich jederzeit wieder abmelden.</p>
          {% if hasCtas %}
            <div class="uk-margin-medium-top uk-flex uk-flex-wrap" style="gap: 12px;">
              {% for cta in ctas %}
                {% set href = cta.url %}
                {% if href starts with('#') %}
                  {% set href = basePath ~ '/' ~ fallbackSlug ~ href %}
                {% elseif href starts with('/') %}
                  {% set href = basePath ~ href %}
                {% endif %}
                {% set normalizedStyle = cta.style|default('primary') %}
                {% set isExternal = href starts with('http://') or href starts with('https://') %}
                {% if normalizedStyle == 'link' %}
                  <a class="uk-link-text uk-text-bold" href="{{ href }}"{% if isExternal %} target="_blank" rel="noopener noreferrer"{% endif %}>{{ cta.label }}</a>
                {% else %}
                  {% set buttonClass = normalizedStyle == 'secondary' ? 'uk-button uk-button-default' : 'uk-button uk-button-primary' %}
                  <a class="{{ buttonClass }}" href="{{ href }}"{% if isExternal %} target="_blank" rel="noopener noreferrer"{% endif %}>{{ cta.label }}</a>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <h1 class="uk-heading-medium">Bestätigung nicht möglich</h1>
          <p class="uk-text-lead">Der Bestätigungslink ist ungültig oder wurde bereits verwendet.</p>
          <p>Bitte fordere bei Bedarf eine neue Bestätigung an oder kontaktiere uns über das Formular auf der Startseite.</p>
        {% endif %}
      {% else %}
        {% if success %}
          <h1 class="uk-heading-medium">Status aktualisiert</h1>
        {% else %}
          <h1 class="uk-heading-medium">Aktion nicht möglich</h1>
        {% endif %}
      {% endif %}
      <p><a class="uk-button uk-button-default" href="{{ fallbackUrl }}">Zurück zur Startseite</a></p>
    </div>
  </div>
{% endblock %}
