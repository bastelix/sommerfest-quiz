<!DOCTYPE html>
{% set bodyThemeValue %}{% block body_theme %}light{% endblock %}{% endset %}
{% set normalizedBodyTheme = bodyThemeValue|trim|lower %}
{% set namespaceCandidate = pageNamespace|default(marketingNamespace|default(config.namespace|default('default'))) %}
{% set normalizedNamespace = namespaceCandidate|default('default')|trim|lower %}
<html lang="{{ locale() }}" data-theme="{{ normalizedBodyTheme }}" data-namespace="{{ normalizedNamespace }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  {% set defaultTitle = 'QuizRace – Das interaktive Team-Quiz für Events' %}
  {% set effectiveTitle = metaTitle|default(defaultTitle) %}
  <title>{% block title %}{{ effectiveTitle }}{% endblock %}</title>
  {% set defaultDescription = 'QuizRace macht Ihr Event einzigartig: QR-Code-Stationen, Live-Ranking & Rätselspaß – datensicher, flexibel, ohne App-Download.' %}
  {% set effectiveDescription = metaDescription|default(defaultDescription) %}
  <meta name="description" content="{{ effectiveDescription }}">
  {% set effectiveRobots = robotsMeta|default('index, follow') %}
  <meta name="robots" content="{{ effectiveRobots }}">
  {% set effectiveCanonical = canonicalUrl|default('') %}
  {% if effectiveCanonical %}
  <link rel="canonical" href="{{ effectiveCanonical }}">
  {% endif %}
  {% set effectiveOgTitle = ogTitle|default(effectiveTitle) %}
  <meta property="og:title" content="{{ effectiveOgTitle }}">
  {% set effectiveOgDescription = ogDescription|default(effectiveDescription) %}
  <meta property="og:description" content="{{ effectiveOgDescription }}">
  {% set defaultOgImage = baseUrl ~ (config.ogImagePath ?? '/uploads/seo/social-preview.jpg') %}
  {% if ogImage is defined and ogImage %}
    {% if ogImage matches '/^https?:\\/\\//i' %}
      {% set effectiveOgImage = ogImage %}
    {% else %}
      {% set effectiveOgImage = baseUrl ~ ogImage %}
    {% endif %}
  {% else %}
    {% set effectiveOgImage = defaultOgImage %}
  {% endif %}
  <meta property="og:image" content="{{ effectiveOgImage }}">
    {% if effectiveCanonical %}
    <meta property="og:url" content="{{ effectiveCanonical }}">
    {% endif %}
    <meta property="og:type" content="website">
    <meta property="og:locale" content="de_DE">
    <meta name="twitter:card" content="summary_large_image">
  {% if hreflangLinks is defined and hreflangLinks is not empty %}
    {% for link in hreflangLinks %}
      <link rel="alternate" href="{{ link.href }}" hreflang="{{ link.hreflang }}">
    {% endfor %}
  {% elseif hreflang is defined and hreflang and effectiveCanonical %}
    {% set hreflangCodes = hreflang|split(',') %}
    {% for code in hreflangCodes %}
      {% set trimmedCode = code|trim %}
      {% if trimmedCode %}
      <link rel="alternate" href="{{ effectiveCanonical }}" hreflang="{{ trimmedCode }}">
      {% endif %}
    {% endfor %}
  {% else %}
  <link rel="alternate" href="https://quizrace.app/" hreflang="de">
  {% endif %}
  {% if schemaJson is defined and schemaJson %}
  <script type="application/ld+json">
  {{ schemaJson|raw }}
  </script>
  {% else %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "QuizRace",
    "url": "https://quizrace.app/",
    "description": "QuizRace ist das interaktive Event-Quiz mit QR-Code-Stationen, Live-Ranking & Rätselspaß – datensicher, flexibel, ohne App-Download.",
    "publisher": {
      "@type": "Organization",
      "name": "QuizRace",
      "logo": {
        "@type": "ImageObject",
        "url": "https://quizrace.app/uploads/branding/logo.png"
      }
    },
    "sameAs": [
      "https://www.facebook.com/quizrace",
      "https://www.instagram.com/quizrace",
      "https://www.linkedin.com/company/quizrace"
    ]
  }
  </script>
  {% endif %}
  {% set rawFavicon = pageFavicon is defined and pageFavicon ? pageFavicon : '/favicon.svg' %}
  {% set faviconSource = rawFavicon starts with 'http' ? rawFavicon : basePath ~ rawFavicon %}
  {% set faviconExt = (rawFavicon|split('?')|first|split('#')|first|split('.')|last|lower) %}
  {% set faviconType = 'image/svg+xml' %}
  {% if faviconExt in ['png'] %}
    {% set faviconType = 'image/png' %}
  {% elseif faviconExt in ['ico', 'cur'] %}
    {% set faviconType = 'image/x-icon' %}
  {% elseif faviconExt in ['jpg', 'jpeg'] %}
    {% set faviconType = 'image/jpeg' %}
  {% elseif faviconExt == 'gif' %}
    {% set faviconType = 'image/gif' %}
  {% elseif faviconExt == 'webp' %}
    {% set faviconType = 'image/webp' %}
  {% elseif faviconExt == 'svg' %}
    {% set faviconType = 'image/svg+xml' %}
  {% endif %}
  <link rel="icon" href="{{ faviconSource }}" type="{{ faviconType }}">
  <link rel="stylesheet" href="{{ basePath }}/css/uikit.min.css">
  <link rel="stylesheet" href="{{ basePath }}/css/variables.css">
  <link rel="stylesheet" href="{{ basePath }}/css/namespace-tokens.css">
  <link rel="stylesheet" href="{{ basePath }}/css/table.css">
  <link rel="stylesheet" href="{{ basePath }}/css/topbar.css">
  {% block head %}{% endblock %}
  {% set rawConfig = config is defined and config ? config : {} %}
  {% set allowConfigBackgroundRaw %}
    {% block allow_config_background %}true{% endblock %}
  {% endset %}
  {% set allowConfigBackgroundRaw = allowConfigBackgroundRaw|trim %}
  {% set allowConfigBackground = true %}
  {% if allowConfigBackgroundRaw is same as(false) %}
    {% set allowConfigBackground = false %}
  {% elseif allowConfigBackgroundRaw is same as(true) %}
    {% set allowConfigBackground = true %}
  {% elseif allowConfigBackgroundRaw is not null %}
    {% set normalizedAllowConfigBackground = allowConfigBackgroundRaw|trim|lower %}
    {% if normalizedAllowConfigBackground in ['false', '0', 'off', 'no'] %}
      {% set allowConfigBackground = false %}
    {% endif %}
  {% endif %}
  {% set colors = rawConfig.colors is defined and rawConfig.colors ? rawConfig.colors : {} %}
  {% set primaryColor = colors.primary is defined and colors.primary ? colors.primary : (attribute(rawConfig, 'backgroundColor')|default(null)) %}
  {% set accentColor = colors.accent is defined and colors.accent ? colors.accent : (attribute(rawConfig, 'buttonColor')|default(null)) %}
  {% set backgroundColor = attribute(rawConfig, 'backgroundColor')|default(null) ?: (colors.primary is defined and colors.primary ? colors.primary : null) %}
  {% block config_color_styles %}
    {% if primaryColor or accentColor or (allowConfigBackground and backgroundColor) %}
    <style>
      :root {
        {% if primaryColor %}--primary-color: {{ primaryColor }};{% endif %}
        {% if accentColor %}--accent-color: {{ accentColor }};{% endif %}
        {% if allowConfigBackground and backgroundColor %}--color-bg: {{ backgroundColor }};{% endif %}
      }
    </style>
    {% endif %}
  {% endblock %}
</head>
<body data-theme="{{ normalizedBodyTheme }}" class="{% block body_class %}{% endblock %}">
  <div class="wrapper">
    <main class="content">
      {% block body %}{% endblock %}
    </main>
    <footer class="site-footer">
      {% block footer %}
        <div class="uk-text-center">
          <a href="{{ basePath }}/impressum">{{ t('imprint') }}</a> |
          <a href="{{ privacyUrl }}">{{ t('privacy') }}</a> |
          <a href="{{ basePath }}/lizenz">{{ t('license') }}</a>
        </div>
      {% endblock %}
    </footer>
  </div>
  <script src="{{ basePath }}/js/uikit.min.js" defer></script>
  <script src="{{ basePath }}/js/uikit-icons.min.js" defer></script>
  <script src="{{ basePath }}/js/storage.js" defer></script>
  <script src="{{ basePath }}/js/app.js" defer></script>
  <script>window.basePath = '{{ basePath }}';</script>
  <script src="{{ basePath }}/js/i18n/{{ locale() == 'en' ? 'en-us' : 'de-de' }}.js" defer></script>
  {% block scripts %}{% endblock %}
</body>
</html>
