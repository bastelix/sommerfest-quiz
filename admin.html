<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Quiz Verwaltung</title>
  <link rel="stylesheet" href="./css/uikit.min.css">
</head>
<body class="uk-background-muted uk-padding">
  <ul uk-tab>
    <li class="uk-active"><a href="#">Veranstaltung konfigurieren</a></li>
    <li><a href="#">Fragen anpassen</a></li>
  </ul>
  <ul class="uk-switcher uk-margin">
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Veranstaltung konfigurieren</h2>
        <form id="configForm" class="uk-form-stacked">
          <div class="uk-margin">
            <label class="uk-form-label" for="cfgLogoPath">Logo Pfad</label>
            <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgLogoPath"></div>
          </div>
          <div class="uk-margin">
            <label class="uk-form-label" for="cfgHeader">Überschrift</label>
            <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgHeader"></div>
          </div>
          <div class="uk-margin">
            <label class="uk-form-label" for="cfgSubheader">Untertitel</label>
            <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgSubheader"></div>
          </div>
          <div class="uk-margin">
            <label class="uk-form-label" for="cfgBackgroundColor">Hintergrundfarbe</label>
            <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgBackgroundColor"></div>
          </div>
          <div class="uk-margin">
            <label class="uk-form-label" for="cfgButtonColor">Buttonfarbe</label>
            <div class="uk-form-controls"><input class="uk-input" type="text" id="cfgButtonColor"></div>
          </div>
        </form>
        <div class="uk-margin uk-flex uk-flex-between">
          <button id="cfgResetBtn" class="uk-button uk-button-default">Zurücksetzen</button>
          <button id="cfgSaveBtn" class="uk-button uk-button-primary">Speichern</button>
        </div>
        <div class="uk-alert-primary" uk-alert>
          <p>
            Nach dem Klick auf <strong>Speichern</strong> wird eine neue
            <code>config.js</code> heruntergeladen. Kopiere diese Datei danach
            manuell in das Verzeichnis <code>js/</code> deines Projekts und
            ersetze die vorhandene Datei. Das ist n&ouml;tig, weil das Quiz
            komplett im Browser l&auml;uft und keinen direkten Schreibzugriff
            auf dieses Verzeichnis hat.
          </p>
        </div>
      </div>
    </li>
    <li>
      <div class="uk-container uk-container-large">
        <h2 class="uk-heading-bullet">Fragen bearbeiten</h2>
        <div id="questions"></div>
        <div class="uk-margin">
          <button id="addBtn" class="uk-button uk-button-default">Neue Frage</button>
        </div>
        <div class="uk-margin uk-flex uk-flex-between">
          <button id="resetBtn" class="uk-button uk-button-default">Zurücksetzen</button>
          <button id="saveBtn" class="uk-button uk-button-primary">Speichern</button>
        </div>
        <div class="uk-alert-primary" uk-alert>
          <p>
            Nach dem Klick auf <strong>Speichern</strong> wird eine neue
            <code>questions.js</code> heruntergeladen. Lege diese Datei
            anschlie&szlig;end im Ordner <code>js/</code> ab und ersetze dort die
            bestehende Datei. Die Admin-Seite kann das Verzeichnis nicht direkt
            beschreiben, daher muss dieser Schritt manuell erfolgen.
          </p>
        </div>
      </div>
    </li>
  </ul>
  <script src="./js/uikit.min.js"></script>
  <script src="./js/questions.js"></script>
  <script src="./js/config.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // config form handling
    const cfgInitial = window.quizConfig || {};
    const cfgFields = {
      logoPath: document.getElementById('cfgLogoPath'),
      header: document.getElementById('cfgHeader'),
      subheader: document.getElementById('cfgSubheader'),
      backgroundColor: document.getElementById('cfgBackgroundColor'),
      buttonColor: document.getElementById('cfgButtonColor')
    };
    function renderCfg(data){
      cfgFields.logoPath.value = data.logoPath || '';
      cfgFields.header.value = data.header || '';
      cfgFields.subheader.value = data.subheader || '';
      cfgFields.backgroundColor.value = data.backgroundColor || '';
      cfgFields.buttonColor.value = data.buttonColor || '';
    }
    renderCfg(cfgInitial);
    document.getElementById('cfgResetBtn').addEventListener('click', function(e){
      e.preventDefault();
      renderCfg(cfgInitial);
    });
    document.getElementById('cfgSaveBtn').addEventListener('click', function(e){
      e.preventDefault();
      const data = {
        logoPath: cfgFields.logoPath.value.trim(),
        header: cfgFields.header.value.trim(),
        subheader: cfgFields.subheader.value.trim(),
        backgroundColor: cfgFields.backgroundColor.value.trim(),
        buttonColor: cfgFields.buttonColor.value.trim()
      };
      const content = 'window.quizConfig = ' + JSON.stringify(data, null, 2) + ';\n';
      const blob = new Blob([content], {type: 'text/javascript'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'js/config.js';
      a.click();
      URL.revokeObjectURL(url);
    });

    // question editor handling
    const container = document.getElementById('questions');
    const addBtn = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');
    const initial = window.quizQuestions || [];

    function renderAll(data){
      container.innerHTML = '';
      data.forEach(q => container.appendChild(createCard(q)));
    }

    function createCard(q){
      const card = document.createElement('div');
      card.className = 'uk-card uk-card-default uk-card-body uk-margin question-card';
      const typeSelect = document.createElement('select');
      typeSelect.className = 'uk-select uk-margin-small-bottom type-select';
      ['sort','assign','mc'].forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        typeSelect.appendChild(opt);
      });
      typeSelect.value = q.type || 'mc';
      const typeInfo = document.createElement('div');
      typeInfo.className = 'uk-alert-primary uk-margin-small-bottom type-info';
      function updateInfo(){
        const map = {
          sort: 'Items in die richtige Reihenfolge bringen.',
          assign: 'Begriffe den passenden Definitionen zuordnen.',
          mc: 'Mehrfachauswahl (Multiple Choice).'
        };
        typeInfo.textContent = map[typeSelect.value] || '';
      }
      updateInfo();
      typeSelect.addEventListener('change', () => { renderFields(); updateInfo(); });
      const prompt = document.createElement('textarea');
      prompt.className = 'uk-textarea uk-margin-small-bottom prompt';
      prompt.placeholder = 'Fragetext';
      prompt.value = q.prompt || '';
      const fields = document.createElement('div');
      fields.className = 'fields';
      const removeBtn = document.createElement('button');
      removeBtn.className = 'uk-button uk-button-danger uk-margin-small-top uk-align-right';
      removeBtn.textContent = 'Entfernen';
      removeBtn.onclick = () => card.remove();

      function addItem(value=''){
        const div = document.createElement('div');
        div.className = 'uk-flex uk-margin-small-bottom item-row';
        const input = document.createElement('input');
        input.className = 'uk-input item';
        input.type = 'text';
        input.value = value;
        const btn = document.createElement('button');
        btn.className = 'uk-button uk-button-danger uk-button-small uk-margin-left';
        btn.textContent = '×';
        btn.onclick = () => div.remove();
        div.appendChild(input);
        div.appendChild(btn);
        return div;
      }

      function addPair(term='', def=''){
        const row = document.createElement('div');
        row.className = 'uk-grid-small uk-margin-small-bottom term-row';
        row.setAttribute('uk-grid','');
        const tInput = document.createElement('input');
        tInput.className = 'uk-input term';
        tInput.type = 'text';
        tInput.placeholder = 'Begriff';
        tInput.value = term;
        const dInput = document.createElement('input');
        dInput.className = 'uk-input definition';
        dInput.type = 'text';
        dInput.placeholder = 'Definition';
        dInput.value = def;
        const rem = document.createElement('button');
        rem.className = 'uk-button uk-button-danger uk-button-small';
        rem.textContent = '×';
        rem.onclick = () => row.remove();
        const tDiv = document.createElement('div');
        tDiv.appendChild(tInput);
        const dDiv = document.createElement('div');
        dDiv.appendChild(dInput);
        const bDiv = document.createElement('div');
        bDiv.className = 'uk-width-auto';
        bDiv.appendChild(rem);
        row.appendChild(tDiv);
        row.appendChild(dDiv);
        row.appendChild(bDiv);
        return row;
      }

      function addOption(text='', checked=false){
        const row = document.createElement('div');
        row.className = 'uk-flex uk-margin-small-bottom option-row';
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.className = 'uk-radio answer';
        radio.name = 'ans'+cardIndex;
        radio.checked = checked;
        const input = document.createElement('input');
        input.className = 'uk-input option uk-margin-small-left';
        input.type = 'text';
        input.value = text;
        const rem = document.createElement('button');
        rem.className = 'uk-button uk-button-danger uk-button-small uk-margin-left';
        rem.textContent = '×';
        rem.onclick = () => row.remove();
        row.appendChild(radio);
        row.appendChild(input);
        row.appendChild(rem);
        return row;
      }

      function renderFields(){
        fields.innerHTML = '';
        if(typeSelect.value === 'sort'){
          const list = document.createElement('div');
          (q.items || ['','']).forEach(it => list.appendChild(addItem(it)));
          const add = document.createElement('button');
          add.className = 'uk-button uk-button-small uk-margin-small-top';
          add.textContent = 'Item hinzufügen';
          add.onclick = e => {e.preventDefault(); list.appendChild(addItem(''));};
          fields.appendChild(list);
          fields.appendChild(add);
        } else if(typeSelect.value === 'assign'){
          const list = document.createElement('div');
          (q.terms || [{term:'',definition:''}]).forEach(p => list.appendChild(addPair(p.term,p.definition)));
          const add = document.createElement('button');
          add.className = 'uk-button uk-button-small uk-margin-small-top';
          add.textContent = 'Begriff hinzufügen';
          add.onclick = e => {e.preventDefault(); list.appendChild(addPair('',''));};
          fields.appendChild(list);
          fields.appendChild(add);
        } else {
          const list = document.createElement('div');
          (q.options || ['','']).forEach((opt,i) => list.appendChild(addOption(opt,i === (q.answer||0))));
          const add = document.createElement('button');
          add.className = 'uk-button uk-button-small uk-margin-small-top';
          add.textContent = 'Option hinzufügen';
          add.onclick = e => {e.preventDefault(); list.appendChild(addOption(''));};
          fields.appendChild(list);
          fields.appendChild(add);
        }
      }

      renderFields();

      card.appendChild(typeSelect);
      card.appendChild(typeInfo);
      card.appendChild(prompt);
      card.appendChild(fields);
      card.appendChild(removeBtn);
      cardIndex++;
      return card;
    }

    function collect(){
      return Array.from(container.querySelectorAll('.question-card')).map(card => {
        const type = card.querySelector('.type-select').value;
        const prompt = card.querySelector('.prompt').value.trim();
        if(type === 'sort'){
          const items = Array.from(card.querySelectorAll('.item-row .item')).map(i => i.value.trim()).filter(Boolean);
          return {type, prompt, items};
        } else if(type === 'assign'){
          const terms = Array.from(card.querySelectorAll('.term-row')).map(r => ({
            term: r.querySelector('.term').value.trim(),
            definition: r.querySelector('.definition').value.trim()
          })).filter(t => t.term || t.definition);
          return {type, prompt, terms};
        } else {
          const options = Array.from(card.querySelectorAll('.option-row .option')).map(i => i.value.trim()).filter(Boolean);
          const radios = Array.from(card.querySelectorAll('.option-row .answer'));
          const answer = radios.findIndex(r => r.checked);
          return {type, prompt, options, answer: answer < 0 ? 0 : answer};
        }
      });
    }

    saveBtn.addEventListener('click', function(e){
      e.preventDefault();
      const data = collect();
      const content = 'window.quizQuestions = ' + JSON.stringify(data, null, 2) + ';\n';
      const blob = new Blob([content], {type: 'text/javascript'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'js/questions.js';
      a.click();
      URL.revokeObjectURL(url);
    });

    resetBtn.addEventListener('click', function(e){
      e.preventDefault();
      renderAll(initial);
    });

    addBtn.addEventListener('click', function(e){
      e.preventDefault();
      container.appendChild(createCard({type:'mc',prompt:'',options:['',''],answer:0}));
    });

    let cardIndex = 0;
    renderAll(initial);
  });
  </script>
</body>
</html>
